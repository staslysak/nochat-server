(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[7],{142:function(e,t,n){"use strict";n.d(t,"h",(function(){return g})),n.d(t,"e",(function(){return h})),n.d(t,"j",(function(){return v})),n.d(t,"a",(function(){return y})),n.d(t,"b",(function(){return j})),n.d(t,"d",(function(){return O})),n.d(t,"c",(function(){return w})),n.d(t,"g",(function(){return x})),n.d(t,"f",(function(){return E})),n.d(t,"i",(function(){return I}));var a=n(144),r=n(145),c=n.n(r);function i(){var e=Object(a.a)(["\n  mutation userTyping($chatId: Int!, $username: String) {\n    userTyping(chatId: $chatId, username: $username)\n  }\n"]);return i=function(){return e},e}function s(){var e=Object(a.a)(["\n  mutation logout {\n    logout\n  }\n"]);return s=function(){return e},e}function o(){var e=Object(a.a)(["\n  mutation readMessage($id: Int!) {\n    readMessage(id: $id)\n  }\n"]);return o=function(){return e},e}function u(){var e=Object(a.a)(["\n  mutation deleteDirect($id: Int!) {\n    deleteDirect(id: $id)\n  }\n"]);return u=function(){return e},e}function l(){var e=Object(a.a)(["\n  mutation deleteMessage($id: Int!) {\n    deleteMessage(id: $id)\n  }\n"]);return l=function(){return e},e}function d(){var e=Object(a.a)(["\n  mutation createMessage($chatId: Int, $text: String!) {\n    createMessage(chatId: $chatId, text: $text)\n  }\n"]);return d=function(){return e},e}function p(){var e=Object(a.a)(["\n  mutation createDirect($userId: Int!, $text: String) {\n    createDirect(userId: $userId, text: $text) {\n      id\n    }\n  }\n"]);return p=function(){return e},e}function f(){var e=Object(a.a)(["\n  mutation verifyUser($secret: String!) {\n    verifyUser(secret: $secret) {\n      token\n      refreshToken\n    }\n  }\n"]);return f=function(){return e},e}function m(){var e=Object(a.a)(["\n  mutation login($username: String!, $password: String!) {\n    login(username: $username, password: $password) {\n      token\n      refreshToken\n    }\n  }\n"]);return m=function(){return e},e}function b(){var e=Object(a.a)(["\n  mutation register($username: String!, $email: String!, $password: String!) {\n    register(username: $username, email: $email, password: $password)\n  }\n"]);return b=function(){return e},e}var g=c()(b()),h=c()(m()),v=c()(f()),y=c()(p()),j=c()(d()),O=c()(l()),w=c()(u()),x=c()(o()),E=c()(s()),I=c()(i())},221:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(18),i=n(140),s=n.n(i),o=n(141),u=n(19),l=n(169),d=n(139),p=n(144),f=n(145),m=n.n(f);function b(){var e=Object(p.a)(["\n  subscription userTyping($chatId: Int!) {\n    userTyping(chatId: $chatId)\n  }\n"]);return b=function(){return e},e}function g(){var e=Object(p.a)(["\n  subscription onlineUser {\n    onlineUser {\n      id\n      online\n      lastSeen\n    }\n  }\n"]);return g=function(){return e},e}function h(){var e=Object(p.a)(["\n  subscription newDirect {\n    newDirect {\n      id\n      user {\n        id\n        email\n        avatar\n        online\n        username\n        lastSeen\n        createdAt\n      }\n      lastMessage {\n        id\n        text\n        userId\n        unread\n        createdAt\n      }\n      unread\n    }\n  }\n"]);return h=function(){return e},e}function v(){var e=Object(p.a)(["\n  subscription deleteDirect {\n    deleteDirect {\n      id\n    }\n  }\n"]);return v=function(){return e},e}function y(){var e=Object(p.a)(["\n  subscription deleteMessage($chatId: Int!) {\n    deleteMessage(chatId: $chatId) {\n      id\n      userId\n    }\n  }\n"]);return y=function(){return e},e}function j(){var e=Object(p.a)(["\n  subscription newMessage($chatId: Int!) {\n    newMessage(chatId: $chatId) {\n      id\n      text\n      userId\n      chatId\n      unread\n      createdAt\n    }\n  }\n"]);return j=function(){return e},e}var O=m()(j()),w=m()(y()),x=m()(v()),E=m()(h()),I=m()(g()),k=m()(b());function M(){var e=Object(p.a)(["\n  query getChatMessages($chatId: Int!, $offset: Int) {\n    messages(chatId: $chatId, offset: $offset) {\n      id\n      text\n      userId\n      unread\n      createdAt\n    }\n  }\n"]);return M=function(){return e},e}function C(){var e=Object(p.a)(["\n  query directLastMessage($chatId: Int!) {\n    directLastMessage(chatId: $chatId) {\n      id\n      text\n      userId\n      createdAt\n    }\n  }\n"]);return C=function(){return e},e}function _(){var e=Object(p.a)(["\n  query currentDirect($userId: Int!) {\n    currentDirect(userId: $userId) {\n      direct {\n        id\n      }\n      recipient {\n        id\n        email\n        avatar\n        online\n        username\n        lastSeen\n        createdAt\n      }\n    }\n  }\n"]);return _=function(){return e},e}function D(){var e=Object(p.a)(["\n  query directs {\n    directs {\n      id\n      user {\n        id\n        email\n        avatar\n        online\n        username\n        lastSeen\n        createdAt\n      }\n      lastMessage {\n        id\n        text\n        userId\n        createdAt\n      }\n      unread\n    }\n  }\n"]);return D=function(){return e},e}function S(){var e=Object(p.a)(["\n  query currentUser {\n    currentUser {\n      id\n      email\n      avatar\n      online\n      username\n      createdAt\n    }\n  }\n"]);return S=function(){return e},e}function $(){var e=Object(p.a)(["\n  query users($username: String) {\n    users(username: $username) {\n      id\n      email\n      avatar\n      online\n      username\n      lastSeen\n      createdAt\n    }\n  }\n"]);return $=function(){return e},e}var T=m()($()),N=m()(S()),A=m()(D()),z=m()(_()),W=m()(C()),L=m()(M()),R=n(142),U=n(220),H=n(47),Q=n(205),P=n(207),q=n(208),B=n(50),Z=n(201),F=n(226),J=n(45),K=n(200),Y=Object(K.a)((function(e){return{Avatar:{fontSize:e.typography.body1.fontSize,textTransform:"uppercase",color:e.palette.common.white},Avatar_small:{width:30,height:30}}})),G=n(147),V=n.n(G),X=Object(J.a)((function(e){return{badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(e.palette.background.paper),"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"$ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}}))(Z.a),ee=function(e){var t=e.alt,n=void 0===t?"":t,a=e.src,c=void 0===a?"":a,i=e.online,s=Object(B.a)(e,["alt","src","online"]),o=Y(),u=n.split(" ").slice(0,2).map((function(e){return e[0]})).join(""),l=/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/.test(c);return r.a.createElement(X,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",invisible:!i},r.a.createElement(F.a,{src:l?c:void 0,className:V()(o.Avatar,Object(H.a)({},o["Avatar_".concat(s.size)],s.size)),style:{background:l?void 0:c}},u))},te=Object(K.a)((function(e){return{ChatWindow:{height:"100%",maxHeight:"calc(100% - 64px)"},ChatWindow_content:{height:"100%",overflow:"auto",padding:"".concat(e.spacing(3),"px"),"&::-webkit-scrollbar":{width:5,background:"transparent","&-thumb":{background:e.palette.action.selected,borderRadius:3*e.shape.borderRadius,display:"none"}},"&:hover::-webkit-scrollbar-thumb":{display:"block"}},ChatWindow_empty:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},ChatWindow_input_wrapper:{minHeight:64,display:"flex",alignItems:"center",width:"100%","& .MuiInputBase-root":{fontSize:e.typography.body2.fontSize},paddingLeft:e.spacing(2)},ChatWindow_input:{height:"100%",minHeight:48,"& .MuiInputBase-inputMultiline":{"&::-webkit-scrollbar":{display:"none"}}}}})),ne=function(e){var t=te(),n=r.a.useRef(null);r.a.useEffect((function(){!function(){var t=n.current,a=t.scrollTop,r=t.scrollHeight,c=t.offsetHeight;e.messages&&e.messages.length<=20?n.current.scrollTop=r:(a+c+300<r||e.send||(n.current.scrollTop=r),e.send&&(n.current.scrollTop=r))}()}),[e.messages]);var a=function(){var t=Object(o.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.current.scrollTop<200)){t.next=4;break}return t.next=3,e.onLoadMoreMessages();case 3:e.hasMore&&(n.current.scrollTop=n.current.scrollTop+10);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return r.a.createElement("div",{className:t.ChatWindow},r.a.createElement("div",{ref:n,onScroll:a,className:t.ChatWindow_content},e.renderMessages(e.messages)))},ae=n(225),re=n(202),ce=n(177),ie=n.n(ce),se=n(17),oe=Object(se.g)((function(e){var t=te(),n=r.a.useRef(),a=r.a.useState(""),c=Object(d.a)(a,2),i=c[0],s=c[1];r.a.useEffect((function(){n.current&&n.current.focus(),s("")}),[e.location]);var o=function(){i.trim().length&&e.onSubmit(i),s("")};return r.a.createElement("div",{className:t.ChatWindow_input_wrapper},r.a.createElement(ae.a,{fullWidth:!0,multiline:!0,rowsMax:12,inputRef:n,value:i,onChange:function(t){e.onChange(),s(t.target.value)},onKeyPress:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),o())},placeholder:"Write a message...",className:t.ChatWindow_input}),r.a.createElement(re.a,{onClick:function(e){return function(){e.current&&e.current.focus(),o()}}(n),disabled:!i.trim().length},r.a.createElement(ie.a,null)))})),ue=n(228),le=Object(K.a)((function(e){return{StyledChip:{alignSelf:"center",background:e.palette.action.hover,"& .MuiChip-label":{}}}})),de=function(e){var t=le();return r.a.createElement(ue.a,Object.assign({className:t.StyledChip,size:"small"},e))},pe=n(206),fe=n(181),me=n(204),be=function(e){var t=e.anchorEl,n=e.onClose,a=e.onDelete,c=e.onCopy,i=function(e){return function(){e(),n()}};return r.a.createElement(fe.a,{anchorEl:t,open:Boolean(t),onClose:n},r.a.createElement(me.a,{dense:!0,onClick:i(a)},"Delete Message"),r.a.createElement(me.a,{dense:!0,onClick:i(c)},"Copy Text"))},ge=Object(K.a)((function(e){return{Message:{display:"flex",position:"relative",maxWidth:"70%",padding:"".concat(e.spacing(1),"px ").concat(e.spacing(1.5),"px ").concat(e.spacing(.5),"px"),borderRadius:3*e.shape.borderRadius,"&:before":{position:"absolute",bottom:-1,width:15,height:20,content:"''"},"& p":{alignSelf:"flex-end",wordWrap:"break-word",overflowWrap:"break-word",paddingBottom:e.spacing(2),minWidth:20},"& span":{alignSelf:"flex-end",opacity:.54}},Message_content:{display:"flex",margin:"".concat(e.spacing(1),"px 0")},Message_content_receiver:{justifyContent:"flex-start"},Message_content_sender:{justifyContent:"flex-end"},Message_receiver:{background:"dark"===e.palette.type?e.lighten(e.palette.background.default,.235):e.darken(e.palette.background.default,.057),"&:before":{left:-10,transform:"rotate(-15deg)",borderBottom:"15px solid ".concat("dark"===e.palette.type?e.lighten(e.palette.background.default,.235):e.darken(e.palette.background.default,.057)),borderLeft:"15px solid transparent"}},Message_sender:{background:e.palette.secondary.main,color:e.palette.getContrastText(e.palette.secondary.main),"&:before":{right:-10,transform:"rotate(15deg)",borderBottom:"15px solid ".concat(e.palette.secondary.main),borderRight:"15px solid transparent"}}}})),he=function(e){var t,n,a=ge(),i=r.a.useState(null),s=Object(d.a)(i,2),o=s[0],u=s[1];return r.a.createElement("div",{className:V()(a.Message_content,(t={},Object(H.a)(t,a.Message_content_sender,e.isOwner),Object(H.a)(t,a.Message_content_receiver,!e.isOwner),t))},r.a.createElement("div",{onContextMenu:function(e){e.preventDefault(),u(e.currentTarget)},className:V()(a.Message,(n={},Object(H.a)(n,a.Message_sender,e.isOwner),Object(H.a)(n,a.Message_receiver,!e.isOwner),n))},r.a.createElement(pe.a,{variant:"body2"},e.text),r.a.createElement(pe.a,{variant:"caption"},Object(c.c)(e.date))),r.a.createElement(be,Object.assign({anchorEl:o,onClose:function(){return u(null)}},e.menuProps,{onCopy:function(){navigator.clipboard.writeText(e.text)}})))},ve=Object(K.a)((function(e){return{DirectFallback:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}}})),ye=function(){var e=ve();return r.a.createElement("div",{className:e.DirectFallback},r.a.createElement(pe.a,{variant:"body2"},"No messages here yet..."))},je=Object(K.a)((function(e){return{Typing:{display:"inline-flex",justifyContent:"space-between",alignItems:"center",color:e.palette.text.secondary,"& span":{width:5,height:5,marginRight:4,background:e.palette.text.secondary,borderRadius:"50%","&:nth-child(1)":{animation:"$animation 1s ease-in-out infinite 0s"},"&:nth-child(2)":{animation:"$animation 1s ease-in-out infinite 0.2s"},"&:nth-child(3)":{animation:"$animation 1s ease-in-out infinite 0.4s"}}},Typing_secondary:{color:e.palette.secondary[200],"& span":{background:e.palette.secondary[200]}},"@keyframes animation":{"0%, 100%":{transform:"scale(1)",opacity:1},"50%":{transform:"scale(.8)",opacity:.5}}}})),Oe=function(e){var t=je();return r.a.createElement("span",{className:V()(t.Typing,Object(H.a)({},t.Typing_secondary,"secondary"===e.variant))},r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null),"typing")},we=Object(K.a)((function(e){return{DirectChat:{position:"relative",width:"100%",height:"100%",overflow:"hidden"},DirectChat_header:{minHeight:64,paddingLeft:e.spacing(1),paddingRight:e.spacing(1),display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid ".concat(e.palette.divider)},DirectChat_header_status:{color:e.palette.secondary[200]},DirectChat_content:{height:"100%",maxHeight:"calc(100% - 64px)",overflowY:"scroll",position:"relative","&::-webkit-scrollbar":{display:"none"}},DirectChat_messageWrapper:{display:"flex",flexDirection:"column"}}})),xe=function(e){var t=we(),n=Object(c.g)(Object(l.a)(e.messages).reverse()),a=r.a.useState(!1),i=Object(d.a)(a,2),u=i[0],p=i[1],f=function(){var t=Object(o.a)(s.a.mark((function t(n){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return p(!0),t.next=3,e.onCreateMessage(n);case 3:p(!1);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),m=r.a.useCallback((function(a){return a.length?Object(l.a)(a).reverse().map((function(a,i){var s=Object(c.b)(a.createdAt,"days"),o=i===n[s]&&r.a.createElement(de,{label:Object(c.f)(a.createdAt)});return r.a.createElement("div",{key:a.id,className:t.DirectChat_messageWrapper},o,r.a.createElement(he,{text:a.text,date:a.createdAt,isOwner:a.userId===e.user.id,menuProps:{onDelete:e.onDeleteMessage(a.id)}}))})):r.a.createElement(ye,null)}),[e.chatId,e.user.id,e.messages,e.onDeleteMessage]);return r.a.createElement("div",{className:t.DirectChat},r.a.createElement("div",{className:t.DirectChat_header},e.recipient.username&&r.a.createElement(Q.a,{dense:!0},r.a.createElement(P.a,{primary:e.recipient.username,primaryTypographyProps:{component:"div"},secondary:e.typingUser?r.a.createElement(Oe,{variant:"secondary"}):e.recipient.online?"online":"last seen at ".concat(Object(c.c)(e.recipient.lastSeen)),secondaryTypographyProps:{variant:"caption",className:V()(Object(H.a)({},t.DirectChat_header_status,e.recipient.online))}}),r.a.createElement(ee,{src:e.recipient.avatar,alt:e.recipient.username,online:e.recipient.online}))),r.a.createElement("div",{className:t.DirectChat_content},r.a.createElement(ne,{send:u,hasMore:e.hasMore,messages:e.messages,renderMessages:m,onLoadMoreMessages:e.onLoadMoreMessages}),r.a.createElement(q.a,null),r.a.createElement(oe,{onChange:function(){e.chatId&&e.onTyping()},onSubmit:f})))},Ee=n(119),Ie=n(209),ke=function(e){var t=e.userId,n=r.a.useState({hasMore:!0}),a=Object(d.a)(n,2),c=a[0],i=a[1],p=Object(Ee.c)(N),f=Object(Ee.c)(z,{variables:{userId:t},skip:!t}),m=Object(Ee.b)(R.a),b=Object(d.a)(m,1)[0],g=Object(Ee.b)(R.b),h=Object(d.a)(g,1)[0],v=Object(Ee.b)(R.d),y=Object(d.a)(v,1)[0],j=Object(Ee.b)(R.c),I=Object(d.a)(j,1)[0],M=Object(Ee.b)(R.g),C=Object(d.a)(M,1)[0],_=Object(Ee.b)(R.i),D=Object(d.a)(_,1)[0],S=Object(U.a)(p,"data.currentUser",{}),$=Object(U.a)(f,"data.currentDirect.recipient",{}),T=Object(U.a)(f,"data.currentDirect.direct.id"),A=Object(Ee.c)(L,{variables:{chatId:T},skip:!T}),W=T?Object(U.a)(A,"data.messages"):[],H=function(e,t){var n=r.a.useState(!1),a=Object(d.a)(n,2),c=a[0],i=a[1],l=r.a.useState(""),p=Object(d.a)(l,2),f=p[0],m=p[1],b=Object(Ie.a)(function(){var e=Object(o.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(!1),e.next=3,t(n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),500),g=Object(d.a)(b,1)[0];return[{user:f,setUser:m},function(){var n=Object(o.a)(s.a.mark((function n(){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i(!0),c){n.next=4;break}return n.next=4,t(e);case 4:g(Object(u.a)({},e,{username:""}));case 5:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}()]}({chatId:T,username:S.username},(function(e){return D({variables:e})})),Q=Object(d.a)(H,2),P=Q[0],q=Q[1];r.a.useEffect((function(){var e=function(){try{return A.subscribeToMore({document:O,variables:{chatId:T},updateQuery:function(e,t){var n=t.subscriptionData;return n.data?{messages:[n.data.newMessage].concat(Object(l.a)(e.messages))}:e}})}catch(e){return function(){}}}();return function(){return e()}}),[A.data,T]),r.a.useEffect((function(){var e=function(){try{return f.subscribeToMore({document:E,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.newDirect;return{currentDirect:Object(u.a)({},e.currentDirect,{direct:a})}}})}catch(e){return function(){}}}();return function(){return e()}}),[f]),r.a.useEffect((function(){var e=function(){try{return A.subscribeToMore({document:w,variables:{chatId:T},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.deleteMessage;return{messages:e.messages.filter((function(e){return e.id!==a.id}))}}})}catch(e){return function(){}}}();return function(){return e()}}),[A.data,T]),r.a.useEffect((function(){var e=function(){try{return f.subscribeToMore({document:x,variables:{chatId:T},updateQuery:function(e,t){var n=t.subscriptionData;return n.data&&n.data.deleteDirect.id===T?{currentDirect:Object(u.a)({},e.currentDirect,{direct:null})}:e}})}catch(e){return function(){}}}();return function(){return e()}}),[f,T]),r.a.useEffect((function(){var e=function(){try{return f.subscribeToMore({document:k,variables:{chatId:T},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.userTyping;return P.setUser(a),e}})}catch(e){return function(){}}}();return function(){return e()}}),[f,T]);var B=function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T){e.next=5;break}return e.next=3,b({variables:{text:t,userId:$.id}});case 3:e.next=9;break;case 5:return e.next=7,h({variables:{text:t,chatId:T}});case 7:return e.next=9,D({variables:{chatId:T,username:""}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(xe,{user:S,chatId:T,recipient:$||{},hasMore:c.hasMore,messages:W||[],typingUser:P.user===S.username?"":P.user,onTyping:q,onCreateMessage:B,onDeleteMessage:function(e){return Object(o.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!W||1!==W.length){t.next=5;break}return t.next=3,I({variables:{id:T}});case 3:t.next=7;break;case 5:return t.next=7,y({variables:{id:e}});case 7:case"end":return t.stop()}}),t)})))},onReadMessage:function(e){return C({variables:{id:e}})},onLoadMoreMessages:function(){A.data&&c.hasMore&&T&&A.fetchMore({variables:{chatId:T,offset:W.length},updateQuery:function(e,t){var n=t.fetchMoreResult;return n?(n.messages.length<20&&i({hasMore:!1}),{messages:[].concat(Object(l.a)(e.messages),Object(l.a)(n.messages))}):e}})}})},Me=n(215),Ce=n(214),_e=Object(K.a)((function(e){return{Sidebar:{position:"relative",width:"100%",maxWidth:e.props.sidebar,minWidth:e.props.sidebarMin},Sidebar_main:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"dark"===e.palette.type?e.palette.action.selected:e.palette.action.hover,borderRight:"1px solid ".concat(e.palette.divider)},Sidebar_header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"".concat(e.spacing(.5),"px ").concat(e.spacing(3),"px"),minHeight:64},Sidebar_searchbar:{background:e.palette.action.selected,padding:"0 ".concat(e.spacing(1),"px"),fontSize:e.typography.body2.fontSize,minHeight:32,marginLeft:e.spacing(1),borderRadius:e.shape.borderRadius},Sidebar_content:{height:"100%",maxHeight:"calc(100% - 64px)",overflowY:"scroll",position:"relative","&::-webkit-scrollbar":{display:"none"}}}})),De=n(211),Se=n(203),$e=n(227),Te=n(210),Ne=Object(K.a)((function(e){return{MenuDrawer:{position:"absolute",width:"95%",height:"100%",zIndex:e.zIndex.tooltip,backgroundImage:"linear-gradient(90deg, ".concat(e.palette.background.default,", ").concat(e.palette.background.paper,")"),borderRight:"1px solid ".concat(e.palette.divider)},MenuDrawer_listItem:{"& p":{width:"100%",marginLeft:e.spacing(2)},"&:last-child p":{color:e.palette.error.dark,marginLeft:0}},MenuDrawer_backdrop:{width:"100%",maxWidth:960,zIndex:1300,left:"auto",right:"auto"}}})),Ae=(Te.a,function(e){var t=e.user,n=void 0===t?{}:t,a=e.open,c=Object(B.a)(e,["user","open"]),i=Ne();return r.a.createElement(r.a.Fragment,null,r.a.createElement(De.a,{in:a,direction:"right"},r.a.createElement("div",{className:i.MenuDrawer},r.a.createElement(Se.a,null,r.a.createElement(Q.a,null,r.a.createElement(ee,{src:n.avatar,alt:n.username,online:n.online})),r.a.createElement(Q.a,null,r.a.createElement(P.a,{primary:n.username,secondary:n.email}))),r.a.createElement(Se.a,null,r.a.createElement(Q.a,{button:!0,className:i.MenuDrawer_listItem,component:"div",onClick:function(){c.onLogout(),c.onClose()}},r.a.createElement(pe.a,{variant:"body2",align:"center"},"Log Out"))))),r.a.createElement($e.a,{open:a,onClick:c.onClose,className:i.MenuDrawer_backdrop}))}),ze=n(212),We=n(48),Le=Object(K.a)((function(e){return{UserItem_primary:Object(u.a)({},e.props.classes.ellipsis),UserItem_secondary:Object(u.a)({},e.props.classes.ellipsis,{color:e.palette.secondary[200]})}})),Re=function(e){var t=Le();return r.a.createElement(Q.a,Object.assign({},e,{dense:!0,button:!0,to:e.link,component:We.b}),r.a.createElement(ze.a,null,r.a.createElement(ee,{src:e.user.avatar,alt:e.user.username,online:e.user.online})),r.a.createElement(P.a,{primary:e.user.username,primaryTypographyProps:{component:"div",className:t.UserItem_primary},secondary:"@".concat(e.user.username),secondaryTypographyProps:{variant:"caption",component:"div",className:t.UserItem_secondary}}))},Ue=Object(K.a)((function(e){return{ChatItem_badge_root:{height:15},ChatItem_badge_badge:{position:"relative",transform:"none",height:"inherit"},ChatItem_primary:{display:"flex"},ChatItem_secondary:{display:"flex",alignItems:"center"},ChatItem_primaryText:Object(u.a)({width:"100%"},e.props.classes.ellipsis),ChatItem_secondaryText:Object(u.a)({width:"100%",marginRight:e.spacing(1)},e.props.classes.ellipsis)}})),He=function(e){var t=e.link,n=e.date,a=e.avatar,i=e.online,s=e.unread,o=e.typing,u=void 0!==o&&o,l=e.selected,d=e.primary,p=e.secondary,f=e.onContextMenu,m=Object(B.a)(e,["link","date","avatar","online","unread","typing","selected","primary","secondary","onContextMenu"]),b=Ue();return r.a.createElement(Q.a,Object.assign({dense:!0,button:!0,to:t,component:We.b,selected:l,onContextMenu:f},m),r.a.createElement(ze.a,null,r.a.createElement(ee,{src:a,alt:d,online:i})),r.a.createElement(P.a,{primary:r.a.createElement(r.a.Fragment,null,r.a.createElement(pe.a,{variant:"body2",className:b.ChatItem_primaryText},d),r.a.createElement(pe.a,{variant:"caption",color:"textSecondary"},Object(c.c)(n))),primaryTypographyProps:{className:b.ChatItem_primary,component:"div"},secondary:r.a.createElement(r.a.Fragment,null,r.a.createElement(pe.a,{variant:"caption",className:b.ChatItem_secondaryText},u?r.a.createElement(Oe,null):p),r.a.createElement(Z.a,{max:50,classes:{badge:b.ChatItem_badge_badge,root:b.ChatItem_badge_root},badgeContent:s,color:"secondary"})),secondaryTypographyProps:{className:b.ChatItem_secondary,component:"div"}}))},Qe=function(e){var t,n=e.anchorEl,a=e.onClose,c=e.onDelete;return r.a.createElement(fe.a,{anchorEl:n,anchorOrigin:{vertical:"top",horizontal:"right"},open:Boolean(n),onClose:a},r.a.createElement(me.a,{dense:!0,onClick:(t=c,function(){t(),a()})},"Delete chat"))},Pe=function(e){var t=r.a.useState(null),n=Object(d.a)(t,2),a=n[0],c=n[1];r.a.useEffect((function(){var t=e.subscribtions.map((function(t){return t(e.direct.id)}));return function(){return t.map((function(t){return t(e.direct.id)}))}}),[e.direct.id,e.subscribtions]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(He,{link:e.link,typing:e.typing,selected:e.selected,avatar:e.user.avatar,online:e.user.online,unread:e.direct.unread,primary:e.user.username,secondary:e.direct.lastMessage.text,date:e.direct.lastMessage.createdAt,onClick:e.onClick,onContextMenu:function(e){e.preventDefault(),c(e.currentTarget)}}),r.a.createElement(Qe,{anchorEl:a,onClose:function(){return c(null)},onDelete:function(){e.onDelete(e.direct.id)}}))},qe=n(213),Be=Object(K.a)((function(e){return{StyledList:{},StyledList_subheader:{background:e.palette.action.selected,lineHeight:"32px",fontSize:e.typography.body2.fontSize}}})),Ze=function(e){var t=Be();return r.a.createElement(Se.a,Object.assign({},e,{subheader:e.subheader?r.a.createElement(qe.a,{component:"div",className:t.StyledList_subheader},e.subheader):null}))},Fe=function(e){var t=_e(),n=r.a.useState(!1),a=Object(d.a)(n,2),c=a[0],i=a[1],s=r.a.useState(""),o=Object(d.a)(s,2),u=o[0],l=o[1],p=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t?r.a.createElement(Ze,{disablePadding:!0},t.map((function(t){return r.a.createElement(Pe,Object.assign({key:t.id,direct:t,user:t.user,typing:e.typings[t.id]===t.user.username?e.typings[t.id]:"",link:"/me?p=".concat(t.user.id),selected:t.user.id===e.chatId,onDelete:e.onDeleteDirect,subscribtions:e.directSubscriptions},n))}))):null},f=Object(Ie.a)((function(t){return e.onSearch(t)}),200),m=Object(d.a)(f,1)[0],b=function(){return i(!c)};return r.a.createElement("div",{className:t.Sidebar},r.a.createElement(Ae,{open:c,user:e.currentUser,onClose:b,onLogout:e.onLogout}),r.a.createElement("div",{className:t.Sidebar_main},r.a.createElement("div",{className:t.Sidebar_header},r.a.createElement(re.a,{edge:"start",color:"inherit",onClick:b},r.a.createElement(Ce.a,null)),r.a.createElement(ae.a,{fullWidth:!0,size:"small",value:u,placeholder:"Search",className:t.Sidebar_searchbar,onChange:function(e){l(e.target.value),m(e.target.value)}})),r.a.createElement("div",{className:t.Sidebar_content},function(){if(u.length){var t=[];e.directs&&e.directs.length&&(t=e.directs.filter((function(e){return e.user.username.startsWith(u)})));var n=t.map((function(e){return e.user.id}));return r.a.createElement(r.a.Fragment,null,p(t,{selected:!1,onClick:function(){return l("")}}),e.users&&e.users.length?r.a.createElement(Ze,{subheader:"Global search",disablePadding:!0},e.users.map((function(e){return!n.includes(e.id)&&r.a.createElement(Re,{key:e.id,user:e,link:"/me?p=".concat(e.id),onClick:function(){return l("")}})}))):null)}return p(e.directs)}(e.directs))))},Je=n(52),Ke=function(e){var t=Object(Ee.c)(N).data,n=Object(Ee.c)(A),a=n.data,i=n.subscribeToMore,l=n.client,p=Object(Ee.a)(T),f=Object(d.a)(p,2),m=f[0],b=f[1].data,g=Object(Ee.b)(R.c),h=Object(d.a)(g,1)[0],v=Object(Ee.b)(R.f,{onCompleted:function(){var t=Object(o.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Je.b.subscriptionClient.client.onclose(),l.resetStore(),c.a.remove(),e.history.push("/login");case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}),y=Object(d.a)(v,1)[0],j=r.a.useState({}),M=Object(d.a)(j,2),C=M[0],_=M[1],D=Object(U.a)(t,"currentUser",{}),S=Object(c.e)(e.location).p;r.a.useEffect((function(){Je.b.subscriptionClient.tryReconnect()}),[]);var $=[function(e){return i({document:k,variables:{chatId:e},updateQuery:function(t,n){var a=n.subscriptionData;if(!a.data)return t;var r=a.data.userTyping;return _(Object(u.a)({},C,Object(H.a)({},e,r))),t}})},function(e){return i({document:O,variables:{chatId:e},updateQuery:function(t,n){var a=n.subscriptionData;if(!a.data)return t;var r=a.data.newMessage,c=r.userId!==D.id?1:0;return{directs:t.directs.map((function(t){return t.id===e?Object(u.a)({},t,{lastMessage:r,unread:t.unread+c}):t}))}}})},function(e){return i({document:w,variables:{chatId:e},updateQuery:function(){var t=Object(o.a)(s.a.mark((function t(n,a){var r,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=a.subscriptionData).data){t.next=3;break}return t.abrupt("return",n);case 3:return c=r.data.deleteMessage,t.next=6,l.query({query:W,variables:{chatId:e},fetchPolicy:"no-cache"}).then((function(e){var t=e.data,a=n.directs.map((function(e){var n=c.userId!==D.id?1:0;return e.lastMessage.id===c.id?Object(u.a)({},e,{lastMessage:t.directLastMessage,unread:e.unread-n}):e}));return l.writeQuery({query:A,data:{directs:a}}),{directs:a}}));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()})}],z=[function(){return i({document:x,updateQuery:function(){var e=Object(o.a)(s.a.mark((function e(t,n){var a,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=n.subscriptionData).data){e.next=3;break}return e.abrupt("return",t);case 3:return r=a.data.deleteDirect,c=t.directs.filter((function(e){return e.id!==r.id})),l.writeQuery({query:A,data:{directs:c}}),e.abrupt("return",{directs:c});case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()})},function(){return i({document:E,updateQuery:function(e,t){var n=t.subscriptionData;return n.data?{directs:e.directs.concat(n.data.newDirect)}:e}})},function(){return i({document:I})}];r.a.useEffect((function(){var e=z.map((function(e){return e()}));return function(){return e.map((function(e){return e()}))}}),[z]);return r.a.createElement(Fe,{chatId:S,typings:C,directs:Object(U.a)(a,"directs",[]).sort(c.h),users:Object(U.a)(b,"users"),currentUser:D,onLogout:y,onSearch:function(e){return m({variables:{username:e}})},onDeleteDirect:function(e){h({variables:{id:e}})},directSubscriptions:$})},Ye=Object(K.a)((function(e){return{container:{display:"flex",overflow:"hidden",padding:0,minHeight:"100vh",maxHeight:"100vh"},contentShift:{width:"100%",background:e.palette.background.paper,minWidth:e.props.sidebarMin}}})),Ge=Object(se.g)((function(e){var t=e.children,n=Object(B.a)(e,["children"]),a=Ye();return r.a.createElement(Me.a,{maxWidth:"md",className:a.container},r.a.createElement(Ke,n),r.a.createElement("div",{className:a.contentShift},t))}));t.default=function(e){var t=Object(c.e)(e.location).p;return r.a.createElement(Ge,null,t?r.a.createElement(ke,{userId:t}):null)}}}]);
//# sourceMappingURL=7.8b511511.chunk.js.map