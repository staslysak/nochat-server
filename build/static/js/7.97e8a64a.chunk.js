(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[7],{226:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),i=a(24),c=a(28),o=a.n(c),s=a(38),l=a(32),u=a(73),d=a(159),p=a(65),m=a(212),b=a(213),f=a(214),h=a(69),g=a(208),v=a(231),y=a(30),E=a(148),j=Object(E.a)((function(e){return{Avatar:{fontSize:e.typography.body1.fontSize,textTransform:"uppercase",color:e.palette.common.white},Avatar_small:{width:30,height:30}}})),O=a(162),w=a.n(O),x=Object(y.a)((function(e){return{badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(e.palette.background.paper),"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"$ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}}))(g.a),k=function(e){var t=e.alt,a=void 0===t?"":t,n=e.src,i=void 0===n?"":n,c=e.online,o=Object(h.a)(e,["alt","src","online"]),s=j(),l=a.split(" ").slice(0,2).map((function(e){return e[0]})).join(""),u=/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/.test(i);return r.a.createElement(x,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",invisible:!c},r.a.createElement(v.a,{src:u?i:void 0,className:w()(s.Avatar,Object(p.a)({},s["Avatar_".concat(o.size)],o.size)),style:{background:u?void 0:i}},l))},C=Object(E.a)((function(e){return{ChatWindow:{height:"100%",maxHeight:"calc(100% - 64px)"},ChatWindow_content:{height:"100%",overflow:"auto",padding:"".concat(e.spacing(3),"px"),"&::-webkit-scrollbar":{width:5,background:"transparent","&-thumb":{background:e.palette.action.selected,borderRadius:3*e.shape.borderRadius,display:"none"}},"&:hover::-webkit-scrollbar-thumb":{display:"block"}},ChatWindow_empty:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},ChatWindow_input_wrapper:{minHeight:64,display:"flex",alignItems:"center",width:"100%","& .MuiInputBase-root":{fontSize:e.typography.body2.fontSize},paddingLeft:e.spacing(2)},ChatWindow_input:{height:"100%",minHeight:48,"& .MuiInputBase-inputMultiline":{"&::-webkit-scrollbar":{display:"none"}}}}})),_=function(e){var t=C(),a=r.a.useRef(null);r.a.useEffect((function(){!function(){var t=a.current,n=t.scrollTop,r=t.scrollHeight,i=t.offsetHeight;e.messages&&e.messages.length<=20?a.current.scrollTop=r:(n+i+300<r||e.send||(a.current.scrollTop=r),e.send&&(a.current.scrollTop=r))}()}),[e.messages]);var n=function(){var t=Object(s.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a.current.scrollTop<200)){t.next=4;break}return t.next=3,e.onLoadMoreMessages();case 3:e.hasMore&&(a.current.scrollTop=a.current.scrollTop+10);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return r.a.createElement("div",{className:t.ChatWindow},r.a.createElement("div",{ref:a,onScroll:n,className:t.ChatWindow_content},e.renderMessages(e.messages)))},M=a(230),D=a(209),I=a(187),S=a.n(I),T=a(26),N=Object(T.h)((function(e){var t=C(),a=r.a.useRef(),n=r.a.useState(""),i=Object(d.a)(n,2),c=i[0],o=i[1];r.a.useEffect((function(){a.current&&a.current.focus(),o("")}),[e.location]);var s=function(){c.trim().length&&e.onSubmit(c),o("")};return r.a.createElement("div",{className:t.ChatWindow_input_wrapper},r.a.createElement(M.a,{fullWidth:!0,multiline:!0,rowsMax:12,inputRef:a,value:c,onChange:function(t){e.onChange(),o(t.target.value)},onKeyPress:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),s())},placeholder:"Write a message...",className:t.ChatWindow_input}),r.a.createElement(D.a,{onClick:function(e){return function(){e.current&&e.current.focus(),s()}}(a),disabled:!c.trim().length},r.a.createElement(S.a,null)))})),z=a(234),W=Object(E.a)((function(e){return{StyledChip:{alignSelf:"center",background:e.palette.action.hover,"& .MuiChip-label":{}}}})),R=function(e){var t=W();return r.a.createElement(z.a,Object.assign({className:t.StyledChip,size:"small"},e))},L=a(150),A=a(190),Q=a(211),U=function(e){var t=e.anchorEl,a=e.onClose,n=e.onDelete,i=e.onCopy,c=function(e){return function(){e(),a()}};return r.a.createElement(A.a,{anchorEl:t,open:Boolean(t),onClose:a},r.a.createElement(Q.a,{dense:!0,onClick:c(n)},"Delete Message"),r.a.createElement(Q.a,{dense:!0,onClick:c(i)},"Copy Text"))},H=Object(E.a)((function(e){return{Message:{display:"flex",position:"relative",maxWidth:"70%",padding:"".concat(e.spacing(1),"px ").concat(e.spacing(1.5),"px ").concat(e.spacing(.5),"px"),borderRadius:3*e.shape.borderRadius,"&:before":{position:"absolute",bottom:-1,width:15,height:20,content:"''"},"& p":{alignSelf:"flex-end",wordWrap:"break-word",overflowWrap:"break-word",paddingBottom:e.spacing(2),minWidth:20},"& span":{alignSelf:"flex-end",opacity:.54}},Message_content:{display:"flex",margin:"".concat(e.spacing(1),"px 0")},Message_content_receiver:{justifyContent:"flex-start"},Message_content_sender:{justifyContent:"flex-end"},Message_receiver:{background:"dark"===e.palette.type?e.lighten(e.palette.background.default,.235):e.darken(e.palette.background.default,.057),"&:before":{left:-10,transform:"rotate(-15deg)",borderBottom:"15px solid ".concat("dark"===e.palette.type?e.lighten(e.palette.background.default,.235):e.darken(e.palette.background.default,.057)),borderLeft:"15px solid transparent"}},Message_sender:{background:e.palette.secondary.main,color:e.palette.getContrastText(e.palette.secondary.main),"&:before":{right:-10,transform:"rotate(15deg)",borderBottom:"15px solid ".concat(e.palette.secondary.main),borderRight:"15px solid transparent"}}}})),P=function(e){var t,a,n=H(),c=r.a.useState(null),o=Object(d.a)(c,2),s=o[0],l=o[1];return r.a.createElement("div",{className:w()(n.Message_content,(t={},Object(p.a)(t,n.Message_content_sender,e.isOwner),Object(p.a)(t,n.Message_content_receiver,!e.isOwner),t))},r.a.createElement("div",{onContextMenu:function(e){e.preventDefault(),l(e.currentTarget)},className:w()(n.Message,(a={},Object(p.a)(a,n.Message_sender,e.isOwner),Object(p.a)(a,n.Message_receiver,!e.isOwner),a))},r.a.createElement(L.a,{variant:"body2"},e.text),r.a.createElement(L.a,{variant:"caption"},Object(i.d)(e.date))),r.a.createElement(U,Object.assign({anchorEl:s,onClose:function(){return l(null)}},e.menuProps,{onCopy:function(){navigator.clipboard.writeText(e.text)}})))},B=a(81),Z=Object(E.a)((function(e){return{Typing:{display:"inline-flex",justifyContent:"space-between",alignItems:"center",color:e.palette.text.secondary,"& span":{width:5,height:5,marginRight:4,background:e.palette.text.secondary,borderRadius:"50%","&:nth-child(1)":{animation:"$animation 1s ease-in-out infinite 0s"},"&:nth-child(2)":{animation:"$animation 1s ease-in-out infinite 0.2s"},"&:nth-child(3)":{animation:"$animation 1s ease-in-out infinite 0.4s"}}},Typing_secondary:{color:e.palette.secondary[200],"& span":{background:e.palette.secondary[200]}},"@keyframes animation":{"0%, 100%":{transform:"scale(1)",opacity:1},"50%":{transform:"scale(.8)",opacity:.5}}}})),F=function(e){var t=Z();return r.a.createElement("span",{className:w()(t.Typing,Object(p.a)({},t.Typing_secondary,"secondary"===e.variant))},r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null),"typing")},q=Object(E.a)((function(e){return{DirectChat:{position:"relative",width:"100%",height:"100%",overflow:"hidden"},DirectChat_header:{minHeight:64,paddingLeft:e.spacing(1),paddingRight:e.spacing(1),display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid ".concat(e.palette.divider)},DirectChat_header_status:{color:e.palette.secondary[200]},DirectChat_content:{height:"100%",maxHeight:"calc(100% - 64px)",overflowY:"scroll",position:"relative","&::-webkit-scrollbar":{display:"none"}},DirectChat_messageWrapper:{display:"flex",flexDirection:"column"}}})),$=function(e){var t=q(),a=Object(i.h)(Object(u.a)(e.messages).reverse()),n=r.a.useState(!1),c=Object(d.a)(n,2),l=c[0],h=c[1],g=function(){var t=Object(s.a)(o.a.mark((function t(a){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h(!0),t.next=3,e.onCreateMessage(a);case 3:h(!1);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),v=r.a.useCallback((function(n){return n.length?Object(u.a)(n).reverse().map((function(n,c){var o=Object(i.b)(n.createdAt,"days"),s=c===a[o]&&r.a.createElement(R,{label:Object(i.g)(n.createdAt)});return r.a.createElement("div",{key:n.id,className:t.DirectChat_messageWrapper},s,r.a.createElement(P,{text:n.text,date:n.createdAt,isOwner:n.userId===e.user.id,menuProps:{onDelete:e.onDeleteMessage(n.id)}}))})):r.a.createElement(B.a,null)}),[e.chatId,e.user.id,e.messages,e.onDeleteMessage]);return r.a.createElement("div",{className:t.DirectChat},r.a.createElement("div",{className:t.DirectChat_header},e.recipient.username&&r.a.createElement(m.a,{dense:!0},r.a.createElement(b.a,{primary:e.recipient.username,primaryTypographyProps:{component:"div"},secondary:e.typingUser?r.a.createElement(F,{variant:"secondary"}):e.recipient.online?"online":"last seen at ".concat(Object(i.d)(e.recipient.lastSeen)),secondaryTypographyProps:{variant:"caption",className:w()(Object(p.a)({},t.DirectChat_header_status,e.recipient.online))}}),r.a.createElement(k,{src:e.recipient.avatar,alt:e.recipient.username,online:e.recipient.online}))),r.a.createElement("div",{className:t.DirectChat_content},r.a.createElement(_,{send:l,hasMore:e.hasMore,messages:e.messages,renderMessages:v,onLoadMoreMessages:e.onLoadMoreMessages}),r.a.createElement(f.a,null),r.a.createElement(N,{onChange:function(){e.chatId&&e.onTyping()},onSubmit:g})))},J=a(215),K=a(67),Y=function(e){var t,a,n,c,p,m,b,f,h,g,v=e.userId,y=r.a.useState({hasMore:!0}),E=Object(d.a)(y,2),j=E[0],O=E[1],w=Object(K.m)({onError:i.c}),x=Object(K.l)({onError:i.c,variables:{userId:v},skip:!v}),k=Object(K.j)({onError:i.c}),C=Object(d.a)(k,2),_=C[0],M=C[1].client,D=Object(K.n)({onError:i.c}),I=Object(d.a)(D,1)[0],S=Object(K.k)({onError:i.c}),T=Object(d.a)(S,1)[0],N=Object(K.o)({onError:i.c}),z=Object(d.a)(N,1)[0],W=Object(K.t)({onError:i.c}),R=Object(d.a)(W,1)[0],L=Object(K.v)(),A=Object(d.a)(L,1)[0],Q=null!==(t=null===w||void 0===w||null===(a=w.data)||void 0===a?void 0:a.currentUser)&&void 0!==t?t:{},U=null!==(n=null===x||void 0===x||null===(c=x.data)||void 0===c||null===(p=c.currentDirect)||void 0===p?void 0:p.recipient)&&void 0!==n?n:{},H=null!==(m=null===x||void 0===x||null===(b=x.data)||void 0===b||null===(f=b.currentDirect)||void 0===f||null===(h=f.direct)||void 0===h?void 0:h.id)&&void 0!==m?m:null,P=Object(K.q)({onError:i.c,variables:{chatId:H},skip:!H}),B=P.data,Z=P.fetchMore,F=P.subscribeToMore,q=H&&null!==(g=null===B||void 0===B?void 0:B.messages)&&void 0!==g?g:[],Y=function(e,t){var a=r.a.useState(!1),n=Object(d.a)(a,2),i=n[0],c=n[1],u=r.a.useState(""),p=Object(d.a)(u,2),m=p[0],b=p[1],f=Object(J.a)(function(){var e=Object(s.a)(o.a.mark((function e(a){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(!1),e.next=3,t(a);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),500),h=Object(d.a)(f,1)[0];return[{user:m,setUser:b},function(){var a=Object(s.a)(o.a.mark((function a(){return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c(!0),i){a.next=4;break}return a.next=4,t(e);case 4:h(Object(l.a)({},e,{username:""}));case 5:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}()]}({chatId:H,username:Q.username},(function(e){return A({variables:e})})),G=Object(d.a)(Y,2),V=G[0],X=G[1];r.a.useEffect((function(){var e=function(){return F({document:K.f,variables:{chatIds:[H]},updateQuery:function(e,t){var a=t.subscriptionData;if(!a.data)return e;var n=e.messages.filter((function(e){return a.data.messageDeleted.ids!==e.id}));return M.writeQuery({query:K.d,data:{messages:n}}),{messages:n}}})},t=function(){return F({document:K.e,variables:{chatIds:[H]},updateQuery:function(e,t){var a=t.subscriptionData;return a.data&&e?{messages:[a.data.messageCreated].concat(Object(u.a)(e.messages))}:e}})}(),a=e();return function(){t(),a()}}),[F,H]),r.a.useEffect((function(){var e=function(){return x.subscribeToMore({document:K.b,updateQuery:function(e,t){var a=t.subscriptionData;return a.data&&a.data.direct.id===H?{currentDirect:Object(l.a)({},e.currentDirect,{direct:null})}:e}})},t=function(){return x.subscribeToMore({document:K.a,updateQuery:function(e,t){var a=t.subscriptionData;return a.data?{currentDirect:Object(l.a)({},e.currentDirect,{direct:a.data.direct})}:e}})}(),a=e();return function(){t(),a()}}),[x,H]),r.a.useEffect((function(){return H?x.subscribeToMore({document:K.i,variables:{chatId:H},updateQuery:function(e,t){var a=t.subscriptionData;return a.data&&V.setUser(a.data.typingUser),e}}):function(){}}),[x,H]);var ee=function(){var e=Object(s.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H){e.next=5;break}return e.next=3,_({variables:{text:t,userId:U.id}});case 3:e.next=9;break;case 5:return e.next=7,T({variables:{text:t,chatId:H}});case 7:return e.next=9,A({variables:{chatId:H,username:""}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement($,{user:Q,chatId:H,recipient:U,hasMore:j.hasMore,messages:q,typingUser:V.user===Q.username?"":V.user,onTyping:X,onCreateMessage:ee,onDeleteMessage:function(e){return Object(s.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!q||1!==q.length){t.next=5;break}return t.next=3,I({variables:{id:H}});case 3:t.next=7;break;case 5:return t.next=7,z({variables:{id:e}});case 7:case"end":return t.stop()}}),t)})))},onReadMessage:function(e){return R({variables:{id:e}})},onLoadMoreMessages:function(){B&&j.hasMore&&H&&Z({variables:{chatId:H,offset:q.length},updateQuery:function(e,t){var a=t.fetchMoreResult;return a?(a.messages.length<20&&O({hasMore:!1}),{messages:[].concat(Object(u.a)(e.messages),Object(u.a)(a.messages))}):e}})}})},G=a(221),V=a(220),X=Object(E.a)((function(e){return{Sidebar:{position:"relative",width:"100%",maxWidth:e.props.sidebar,minWidth:e.props.sidebarMin},Sidebar_main:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"dark"===e.palette.type?e.palette.action.selected:e.palette.action.hover,borderRight:"1px solid ".concat(e.palette.divider)},Sidebar_header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"".concat(e.spacing(.5),"px ").concat(e.spacing(3),"px"),minHeight:64},Sidebar_searchbar:{background:e.palette.action.selected,padding:"0 ".concat(e.spacing(1),"px"),fontSize:e.typography.body2.fontSize,minHeight:32,marginLeft:e.spacing(1),borderRadius:e.shape.borderRadius},Sidebar_content:{height:"100%",maxHeight:"calc(100% - 64px)",overflowY:"scroll",position:"relative","&::-webkit-scrollbar":{display:"none"}}}})),ee=a(217),te=a(210),ae=a(233),ne=a(216),re=Object(E.a)((function(e){return{MenuDrawer:{position:"absolute",width:"95%",height:"100%",zIndex:e.zIndex.tooltip,backgroundImage:"linear-gradient(90deg, ".concat(e.palette.background.default,", ").concat(e.palette.background.paper,")"),borderRight:"1px solid ".concat(e.palette.divider)},MenuDrawer_listItem:{"& p":{width:"100%",marginLeft:e.spacing(2)},"&:last-child p":{color:e.palette.error.dark,marginLeft:0}},MenuDrawer_backdrop:{width:"100%",maxWidth:960,zIndex:1300,left:"auto",right:"auto"}}})),ie=(ne.a,function(e){var t=e.user,a=void 0===t?{}:t,n=e.open,i=Object(h.a)(e,["user","open"]),c=re();return r.a.createElement(r.a.Fragment,null,r.a.createElement(ee.a,{in:n,direction:"right"},r.a.createElement("div",{className:c.MenuDrawer},r.a.createElement(te.a,null,r.a.createElement(m.a,null,r.a.createElement(k,{src:a.avatar,alt:a.username,online:a.online})),r.a.createElement(m.a,null,r.a.createElement(b.a,{primary:a.username,secondary:a.email}))),r.a.createElement(te.a,null,r.a.createElement(m.a,{button:!0,className:c.MenuDrawer_listItem,component:"div",onClick:function(){i.onLogout(),i.onClose()}},r.a.createElement(L.a,{variant:"body2",align:"center"},"Log Out"))))),r.a.createElement(ae.a,{open:n,onClick:i.onClose,className:c.MenuDrawer_backdrop}))}),ce=a(218),oe=a(66),se=Object(E.a)((function(e){return{UserItem_primary:Object(l.a)({},e.props.classes.ellipsis),UserItem_secondary:Object(l.a)({},e.props.classes.ellipsis,{color:e.palette.secondary[200]})}})),le=function(e){var t=se();return r.a.createElement(m.a,Object.assign({},e,{dense:!0,button:!0,to:e.link,component:oe.b}),r.a.createElement(ce.a,null,r.a.createElement(k,{src:e.user.avatar,alt:e.user.username,online:e.user.online})),r.a.createElement(b.a,{primary:e.user.username,primaryTypographyProps:{component:"div",className:t.UserItem_primary},secondary:"@".concat(e.user.username),secondaryTypographyProps:{variant:"caption",component:"div",className:t.UserItem_secondary}}))},ue=Object(E.a)((function(e){return{ChatItem_badge_root:{height:15},ChatItem_badge_badge:{position:"relative",transform:"none",height:"inherit"},ChatItem_primary:{display:"flex"},ChatItem_secondary:{display:"flex",alignItems:"center"},ChatItem_primaryText:Object(l.a)({width:"100%"},e.props.classes.ellipsis),ChatItem_secondaryText:Object(l.a)({width:"100%",marginRight:e.spacing(1)},e.props.classes.ellipsis)}})),de=function(e){var t=e.link,a=e.date,n=e.avatar,c=e.online,o=e.unread,s=e.typing,l=void 0!==s&&s,u=e.selected,d=e.primary,p=e.secondary,f=e.onContextMenu,v=Object(h.a)(e,["link","date","avatar","online","unread","typing","selected","primary","secondary","onContextMenu"]),y=ue();return r.a.createElement(m.a,Object.assign({dense:!0,button:!0,to:t,component:oe.b,selected:u,onContextMenu:f},v),r.a.createElement(ce.a,null,r.a.createElement(k,{src:n,alt:d,online:c})),r.a.createElement(b.a,{primary:r.a.createElement(r.a.Fragment,null,r.a.createElement(L.a,{variant:"body2",className:y.ChatItem_primaryText},d),r.a.createElement(L.a,{variant:"caption",color:"textSecondary"},Object(i.d)(a))),primaryTypographyProps:{className:y.ChatItem_primary,component:"div"},secondary:r.a.createElement(r.a.Fragment,null,r.a.createElement(L.a,{variant:"caption",className:y.ChatItem_secondaryText},l?r.a.createElement(F,null):p),r.a.createElement(g.a,{max:50,classes:{badge:y.ChatItem_badge_badge,root:y.ChatItem_badge_root},badgeContent:o,color:"secondary"})),secondaryTypographyProps:{className:y.ChatItem_secondary,component:"div"}}))},pe=function(e){var t,a=e.anchorEl,n=e.onClose,i=e.onDelete;return r.a.createElement(A.a,{anchorEl:a,anchorOrigin:{vertical:"top",horizontal:"right"},open:Boolean(a),onClose:n},r.a.createElement(Q.a,{dense:!0,onClick:(t=i,function(){t(),n()})},"Delete chat"))},me=function(e){var t=r.a.useState(null),a=Object(d.a)(t,2),n=a[0],i=a[1];r.a.useEffect((function(){var t=e.subscribtions.map((function(t){return t(e.direct.id)}));return function(){return t.map((function(t){return t(e.direct.id)}))}}),[e.direct.id,e.subscribtions]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(de,{link:e.link,typing:e.typing,selected:e.selected,avatar:e.user.avatar,online:e.user.online,unread:e.direct.unread,primary:e.user.username,secondary:e.direct.lastMessage.text,date:e.direct.lastMessage.createdAt,onClick:e.onClick,onContextMenu:function(e){e.preventDefault(),i(e.currentTarget)}}),r.a.createElement(pe,{anchorEl:n,onClose:function(){return i(null)},onDelete:function(){e.onDelete(e.direct.id)}}))},be=a(219),fe=Object(E.a)((function(e){return{StyledList:{},StyledList_subheader:{background:e.palette.action.selected,lineHeight:"32px",fontSize:e.typography.body2.fontSize}}})),he=function(e){var t=fe();return r.a.createElement(te.a,Object.assign({},e,{subheader:e.subheader?r.a.createElement(be.a,{component:"div",className:t.StyledList_subheader},e.subheader):null}))},ge=function(e){var t=X(),a=r.a.useState(!1),n=Object(d.a)(a,2),i=n[0],c=n[1],o=r.a.useState(""),s=Object(d.a)(o,2),l=s[0],u=s[1],p=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t?r.a.createElement(he,{disablePadding:!0},t.map((function(t){return r.a.createElement(me,Object.assign({key:t.id,direct:t,user:t.user,typing:e.typings[t.id]===t.user.username?e.typings[t.id]:"",link:"/me?p=".concat(t.user.id),selected:t.user.id===e.chatId,onDelete:e.onDeleteDirect,subscribtions:e.directSubscriptions},a))}))):null},m=Object(J.a)((function(t){return e.onSearch(t)}),200),b=Object(d.a)(m,1)[0],f=function(){return c(!i)};return r.a.createElement("div",{className:t.Sidebar},r.a.createElement(ie,{open:i,user:e.currentUser,onClose:f,onLogout:e.onLogout}),r.a.createElement("div",{className:t.Sidebar_main},r.a.createElement("div",{className:t.Sidebar_header},r.a.createElement(D.a,{edge:"start",color:"inherit",onClick:f},r.a.createElement(V.a,null)),r.a.createElement(M.a,{fullWidth:!0,size:"small",value:l,placeholder:"Search",className:t.Sidebar_searchbar,onChange:function(e){u(e.target.value),b(e.target.value)}})),r.a.createElement("div",{className:t.Sidebar_content},function(){if(l.length){var t=[];e.directs&&e.directs.length&&(t=e.directs.filter((function(e){return e.user.username.startsWith(l)})));var a=t.map((function(e){return e.user.id}));return r.a.createElement(r.a.Fragment,null,p(t,{selected:!1,onClick:function(){return u("")}}),e.users&&e.users.length?r.a.createElement(he,{subheader:"Global search",disablePadding:!0},e.users.map((function(e){return!a.includes(e.id)&&r.a.createElement(le,{key:e.id,user:e,link:"/me?p=".concat(e.id),onClick:function(){return u("")}})}))):null)}return p(e.directs)}(e.directs))))},ve=a(70),ye=function(){var e,t,a,n=Object(T.g)(),c=Object(K.m)().data,u=Object(K.p)(),m=u.data,b=u.subscribeToMore,f=u.client,h=Object(K.w)(),g=Object(d.a)(h,2),v=g[0],y=g[1].data,E=Object(K.n)({onError:i.c}),j=Object(d.a)(E,1)[0],O=Object(K.s)({onCompleted:function(){i.a.remove(),ve.b.subscriptionClient.client.onclose(),f.resetStore(),n.push("/login")}}),w=Object(d.a)(O,1)[0],x=r.a.useState({}),k=Object(d.a)(x,2),C=k[0],_=k[1],M=null!==(e=null===c||void 0===c?void 0:c.currentUser)&&void 0!==e?e:{},D=Object(i.f)(n.location).p,I=[function(e){return b({document:K.i,variables:{chatId:e},updateQuery:function(t,a){var n=a.subscriptionData;if(!n.data)return t;var r=n.data.typingUser;return _(Object(l.a)({},C,Object(p.a)({},e,r))),t}})}];r.a.useEffect((function(){var e,t=(null!==(e=null===m||void 0===m?void 0:m.directs)&&void 0!==e?e:[]).map((function(e){return e.id})),a=function(e){return b({document:K.e,variables:{chatIds:e},updateQuery:function(e,t){var a=t.subscriptionData;if(!a.data)return e;var n=a.data.messageCreated,r=n.userId!==M.id?1:0;return{directs:e.directs.map((function(e){return e.id===n.chatId?Object(l.a)({},e,{lastMessage:n,unread:e.unread+r}):e}))}}})},n=function(){return b({document:K.a,updateQuery:function(e,t){var a=t.subscriptionData;return a.data?{directs:e.directs.concat(a.data.direct)}:e}})},r=function(){return b({document:K.b,updateQuery:function(){var e=Object(s.a)(o.a.mark((function e(t,a){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=a.subscriptionData).data){e.next=3;break}return e.abrupt("return",t);case 3:return r=t.directs.filter((function(e){return e.id!==n.data.direct.id})),f.writeQuery({query:K.c,data:{directs:r}}),e.abrupt("return",{directs:r});case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()})},i=function(){return b({document:K.g})},c=function(){return b({document:K.f,variables:{chatIds:t},updateQuery:function(){var e=Object(s.a)(o.a.mark((function e(t,a){var n,r,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=a.subscriptionData).data){e.next=3;break}return e.abrupt("return",t);case 3:return r=n.data.messageDeleted,i=t.directs.map((function(e){return e.id===r.chat.id||r.ids===e.lastMessage.id?r.chat:e})),f.writeQuery({query:K.c,data:{directs:i}}),e.abrupt("return",{directs:i});case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()})}(t),u=a(t),d=n(),p=r(),h=i();return function(){c(),u(),d(),p(),h()}}),[(null!==(t=null===m||void 0===m?void 0:m.directs)&&void 0!==t?t:[]).length],b);return r.a.createElement(ge,{chatId:D,typings:C,directs:(null!==(a=null===m||void 0===m?void 0:m.directs)&&void 0!==a?a:[]).sort(i.i),users:null===y||void 0===y?void 0:y.users,currentUser:M,onLogout:w,onSearch:function(e){v({variables:{username:e}})},onDeleteDirect:function(e){j({variables:{id:e}})},directSubscriptions:I})},Ee=Object(E.a)((function(e){return{container:{display:"flex",overflow:"hidden",padding:0,minHeight:"100vh",maxHeight:"100vh"},contentShift:{width:"100%",background:e.palette.background.paper,minWidth:e.props.sidebarMin}}})),je=function(e){var t=Ee();return r.a.createElement(G.a,{maxWidth:"md",className:t.container},r.a.createElement(ye,null),r.a.createElement("div",{className:t.contentShift},e.children))};t.default=function(e){var t=Object(i.f)(e.location).p;return r.a.createElement(je,null,t?r.a.createElement(Y,{userId:t}):null)}}}]);
//# sourceMappingURL=7.97e8a64a.chunk.js.map