{"version":3,"sources":["components/Avatar/styles.js","components/Avatar/index.js","components/ChatWindow/styles.js","components/ChatWindow/index.js","components/ChatWindow/ChatInput.js","components/StyledChip/styles.js","components/StyledChip/index.js","components/Message/MessageMenu.js","components/Message/styles.js","components/Message/index.js","components/Typing/styles.js","components/Typing/index.js","components/DirectChat/styles.js","components/DirectChat/index.js","containers/DirectChatContainer.js","hooks/index.js","components/Sidebar/styles.js","components/MenuDrawer/styles.js","components/MenuDrawer/index.js","components/UserItem/styles.js","components/UserItem/index.js","components/ChatItem/styles.js","components/ChatItem/index.js","components/DirectItem/DirectItemMenu.js","components/DirectItem/index.js","components/StylesList/styles.js","components/StylesList/index.js","components/Sidebar/index.js","containers/SidebarContainer.js","components/Layout/index.js","pages/Home/index.js"],"names":["useStyles","makeStyles","theme","Avatar","fontSize","typography","body1","textTransform","color","palette","common","white","Avatar_small","width","height","StyledBadge","withStyles","badge","backgroundColor","boxShadow","background","paper","position","top","left","borderRadius","animation","border","content","transform","opacity","Badge","alt","src","online","props","classes","name","split","slice","map","x","join","isUrl","test","overlap","anchorOrigin","vertical","horizontal","variant","invisible","undefined","className","cx","size","style","ChatWindow","maxHeight","ChatWindow_content","overflow","padding","spacing","action","selected","shape","display","ChatWindow_empty","alignItems","justifyContent","ChatWindow_input_wrapper","minHeight","body2","paddingLeft","ChatWindow_input","chatWindowRef","React","useRef","useEffect","current","scrollTop","scrollHeight","offsetHeight","messages","length","send","handleUpdateView","onScroll","a","onLoadMoreMessages","hasMore","ref","renderMessages","withRouter","inputRef","useState","message","setMessage","focus","location","handleOnSubmit","trim","onSubmit","InputBase","fullWidth","multiline","rowsMax","value","onChange","e","target","onKeyPress","key","shiftKey","preventDefault","placeholder","IconButton","onClick","handleOnClick","disabled","StyledChip","alignSelf","hover","Chip","MessageMenu","anchorEl","onClose","onDelete","onCopy","handleActions","callback","Menu","open","Boolean","MenuItem","dense","Message","maxWidth","bottom","wordWrap","overflowWrap","paddingBottom","minWidth","Message_content","margin","Message_content_receiver","Message_content_sender","Message_receiver","type","lighten","default","darken","borderBottom","borderLeft","Message_sender","secondary","main","getContrastText","right","borderRight","contextMenu","setContextMenu","isOwner","onContextMenu","currentTarget","Typography","text","formatDate","date","menuProps","navigator","clipboard","writeText","Typing","marginRight","Typing_secondary","DirectChat","DirectChat_header","paddingRight","divider","DirectChat_header_status","DirectChat_content","overflowY","DirectChat_messageWrapper","flexDirection","timeline","renderTimeline","reverse","setSend","handleCreateMessage","onCreateMessage","useCallback","idx","timeDiff","diffTime","createdAt","timelineChip","label","renderDiffTimeLabel","id","userId","user","onDeleteMessage","chatId","recipient","username","ListItem","ListItemText","primary","primaryTypographyProps","component","typingUser","lastSeen","secondaryTypographyProps","avatar","Divider","onTyping","DirectChatContainer","state","setstate","currentUser","useCurrentUserQuery","onError","errorHandler","currentDirect","useCurrentDirectQuery","variables","skip","useCreateDirectMutation","createDirect","client","useDeleteDirectMutation","deleteDirect","useCreateMessageMutation","createMessage","useDeleteMessageMutation","deleteMessage","useReadMessageMutation","readMessage","useTypeMessageMutation","typeMessage","self","data","direct","useGetMessagesQuery","messagesData","fetchMore","subscribeToMoreMessages","subscribeToMore","typing","setTyping","setUser","useDebouncedCallback","debounce","useTyping","subscribtions","document","MessageDeletedDocument","chatIds","updateQuery","prev","subscriptionData","filter","messageDeleted","ids","writeQuery","query","GetMessagesDocument","messageCreated","MessageCreatedDocument","DirectDeletedDocument","directCreated","DirectCreatedDocument","directDeleted","TypingUserDocument","onReadMessage","offset","fetchMoreResult","Sidebar","sidebar","sidebarMin","Sidebar_main","Sidebar_header","Sidebar_searchbar","marginLeft","Sidebar_content","MenuDrawer","zIndex","tooltip","backgroundImage","MenuDrawer_listItem","error","dark","MenuDrawer_backdrop","Settings","Slide","in","direction","List","email","button","onLogout","align","Backdrop","UserItem_primary","ellipsis","UserItem_secondary","UserItem","to","link","Link","ListItemAvatar","ChatItem_badge_root","ChatItem_badge_badge","ChatItem_primary","ChatItem_secondary","ChatItem_primaryText","ChatItem_secondaryText","ChatItem","unread","max","root","badgeContent","DirectItemMenu","DirectItem","unsubscribes","subscribe","unsubscribe","lastMessage","StyledList","StyledList_subheader","lineHeight","subheader","ListSubheader","setOpen","search","setSearch","renderDirectsList","restProps","disablePadding","typings","onDeleteDirect","directSubscriptions","onSearch","handleMenuToggle","edge","directsMatch","directs","startsWith","directsMatchIds","users","includes","renderDirects","SidebarContainer","history","useHistory","useDirectsQuery","useUsersLazyQuery","searchUsers","useLogoutMutation","onCompleted","authTokens","remove","wsLink","subscriptionClient","onclose","resetStore","push","logout","setTypings","pasreQuery","p","concat","DirectsDocument","OnlineUserDocument","chat","onlineUser","sort","sortByLastMessage","container","contentShift","Layout","Container","children","Home"],"mappings":"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","file":"static/js/7.97e8a64a.chunk.js","sourcesContent":["import { makeStyles } from \"@material-ui/core/styles\";\r\n\r\nexport const useStyles = makeStyles((theme) => ({\r\n  Avatar: {\r\n    fontSize: theme.typography.body1.fontSize,\r\n    // width: 44,\r\n    // height: 44,\r\n    textTransform: \"uppercase\",\r\n    color: theme.palette.common.white,\r\n  },\r\n  Avatar_small: {\r\n    width: 30,\r\n    height: 30,\r\n  },\r\n}));\r\n","import React from \"react\";\r\nimport { Avatar as MuiAvarat, Badge } from \"@material-ui/core\";\r\nimport { withStyles } from \"@material-ui/core/styles\";\r\nimport { useStyles } from \"./styles\";\r\nimport cx from \"classnames\";\r\n\r\nconst StyledBadge = withStyles((theme) => ({\r\n  badge: {\r\n    backgroundColor: \"#44b700\",\r\n    color: \"#44b700\",\r\n    boxShadow: `0 0 0 2px ${theme.palette.background.paper}`,\r\n    \"&::after\": {\r\n      position: \"absolute\",\r\n      top: 0,\r\n      left: 0,\r\n      width: \"100%\",\r\n      height: \"100%\",\r\n      borderRadius: \"50%\",\r\n      animation: \"$ripple 1.2s infinite ease-in-out\",\r\n      border: \"1px solid currentColor\",\r\n      content: '\"\"',\r\n    },\r\n  },\r\n  \"@keyframes ripple\": {\r\n    \"0%\": {\r\n      transform: \"scale(.8)\",\r\n      opacity: 1,\r\n    },\r\n    \"100%\": {\r\n      transform: \"scale(2.4)\",\r\n      opacity: 0,\r\n    },\r\n  },\r\n}))(Badge);\r\n\r\nconst Avatar = ({ alt = \"\", src = \"\", online, ...props }) => {\r\n  const classes = useStyles();\r\n  const name = alt\r\n    .split(\" \")\r\n    .slice(0, 2)\r\n    .map((x) => x[0])\r\n    .join(\"\");\r\n\r\n  const urlRegex = /(https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|www\\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9]+\\.[^\\s]{2,}|www\\.[a-zA-Z0-9]+\\.[^\\s]{2,})/;\r\n  const isUrl = urlRegex.test(src);\r\n\r\n  return (\r\n    <StyledBadge\r\n      overlap=\"circle\"\r\n      anchorOrigin={{\r\n        vertical: \"bottom\",\r\n        horizontal: \"right\",\r\n      }}\r\n      variant=\"dot\"\r\n      invisible={!online}\r\n    >\r\n      <MuiAvarat\r\n        src={isUrl ? src : undefined}\r\n        // alt={alt}\r\n        className={cx(classes.Avatar, {\r\n          [classes[`Avatar_${props.size}`]]: props.size,\r\n        })}\r\n        style={{ background: !isUrl ? src : undefined }}\r\n      >\r\n        {name}\r\n      </MuiAvarat>\r\n    </StyledBadge>\r\n  );\r\n};\r\n\r\nexport default Avatar;\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  ChatWindow: {\r\n    height: \"100%\",\r\n    maxHeight: \"calc(100% - 64px)\",\r\n  },\r\n  ChatWindow_content: {\r\n    height: \"100%\",\r\n    overflow: \"auto\",\r\n    padding: `${theme.spacing(3)}px`,\r\n    \"&::-webkit-scrollbar\": {\r\n      width: 5,\r\n      background: \"transparent\",\r\n      \"&-thumb\": {\r\n        background: theme.palette.action.selected,\r\n        borderRadius: theme.shape.borderRadius * 3,\r\n        display: \"none\",\r\n      },\r\n    },\r\n    \"&:hover::-webkit-scrollbar-thumb\": { display: \"block\" },\r\n  },\r\n  ChatWindow_empty: {\r\n    height: \"100%\",\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  },\r\n  ChatWindow_input_wrapper: {\r\n    minHeight: 64,\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n    width: \"100%\",\r\n    \"& .MuiInputBase-root\": {\r\n      fontSize: theme.typography.body2.fontSize,\r\n    },\r\n    paddingLeft: theme.spacing(2),\r\n  },\r\n  ChatWindow_input: {\r\n    height: \"100%\",\r\n    minHeight: 48,\r\n    \"& .MuiInputBase-inputMultiline\": {\r\n      \"&::-webkit-scrollbar\": { display: \"none\" },\r\n    },\r\n  },\r\n}));\r\n\r\nexport default useStyles;\r\n","import React from \"react\";\r\nimport useStyles from \"./styles\";\r\n\r\nconst ChatWindow = (props) => {\r\n  const classes = useStyles();\r\n  const chatWindowRef = React.useRef(null);\r\n\r\n  React.useEffect(() => {\r\n    const handleUpdateView = () => {\r\n      const { scrollTop, scrollHeight, offsetHeight } = chatWindowRef.current;\r\n      if (props.messages && props.messages.length <= 20) {\r\n        chatWindowRef.current.scrollTop = scrollHeight;\r\n      } else {\r\n        if (!(scrollTop + offsetHeight + 300 < scrollHeight) && !props.send) {\r\n          chatWindowRef.current.scrollTop = scrollHeight;\r\n        }\r\n\r\n        if (props.send) {\r\n          chatWindowRef.current.scrollTop = scrollHeight;\r\n        }\r\n      }\r\n    };\r\n\r\n    handleUpdateView();\r\n  }, [props.messages]);\r\n\r\n  const onScroll = async () => {\r\n    if (chatWindowRef.current.scrollTop < 200) {\r\n      await props.onLoadMoreMessages();\r\n      if (props.hasMore) {\r\n        chatWindowRef.current.scrollTop = chatWindowRef.current.scrollTop + 10;\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={classes.ChatWindow}>\r\n      <div\r\n        ref={chatWindowRef}\r\n        onScroll={onScroll}\r\n        className={classes.ChatWindow_content}\r\n      >\r\n        {/* {props.children} */}\r\n        {props.renderMessages(props.messages)}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatWindow;\r\n","import React from \"react\";\r\nimport { InputBase, IconButton } from \"@material-ui/core\";\r\nimport SendIcon from \"@material-ui/icons/Send\";\r\nimport useStyles from \"./styles\";\r\nimport { withRouter } from \"react-router-dom\";\r\n\r\nconst ChatInput = (props) => {\r\n  const classes = useStyles();\r\n  const inputRef = React.useRef();\r\n  const [message, setMessage] = React.useState(\"\");\r\n\r\n  React.useEffect(() => {\r\n    if (inputRef.current) {\r\n      inputRef.current.focus();\r\n    }\r\n\r\n    setMessage(\"\");\r\n  }, [props.location]);\r\n\r\n  const handleOnSubmit = () => {\r\n    if (message.trim().length) {\r\n      props.onSubmit(message);\r\n    }\r\n\r\n    setMessage(\"\");\r\n  };\r\n\r\n  const handleOnClick = (inputRef) => () => {\r\n    if (inputRef.current) {\r\n      inputRef.current.focus();\r\n    }\r\n    handleOnSubmit();\r\n  };\r\n\r\n  const handleKeyPress = (e) => {\r\n    if (e.key === \"Enter\" && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleOnSubmit();\r\n    }\r\n  };\r\n\r\n  const handleOnChange = (e) => {\r\n    props.onChange();\r\n    setMessage(e.target.value);\r\n  };\r\n\r\n  return (\r\n    <div className={classes.ChatWindow_input_wrapper}>\r\n      <InputBase\r\n        fullWidth\r\n        multiline\r\n        rowsMax={12}\r\n        inputRef={inputRef}\r\n        value={message}\r\n        onChange={handleOnChange}\r\n        onKeyPress={handleKeyPress}\r\n        placeholder=\"Write a message...\"\r\n        className={classes.ChatWindow_input}\r\n      />\r\n      <IconButton\r\n        onClick={handleOnClick(inputRef)}\r\n        disabled={!message.trim().length}\r\n      >\r\n        <SendIcon />\r\n      </IconButton>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default withRouter(ChatInput);\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\n\r\nexport const useStyles = makeStyles((theme) => ({\r\n  StyledChip: {\r\n    // background: \"none\",\r\n    alignSelf: \"center\",\r\n    background: theme.palette.action.hover,\r\n\r\n    \"& .MuiChip-label\": {\r\n      // borderRadius: \"inherit\",\r\n    },\r\n  },\r\n}));\r\n","import React from \"react\";\r\nimport { Chip } from \"@material-ui/core\";\r\nimport { useStyles } from \"./styles\";\r\n\r\nconst StyledChip = (props) => {\r\n  const classes = useStyles();\r\n  return <Chip className={classes.StyledChip} size=\"small\" {...props} />;\r\n};\r\n\r\nexport default StyledChip;\r\n","import React from \"react\";\r\nimport { Menu, MenuItem } from \"@material-ui/core\";\r\n\r\nconst MessageMenu = ({ anchorEl, onClose, onDelete, onCopy }) => {\r\n  const handleActions = (callback) => () => {\r\n    callback();\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Menu\r\n      // keepMounted\r\n      // anchorOrigin={{ vertical: \"bottom\", horizontal: \"left\" }}\r\n      anchorEl={anchorEl}\r\n      open={Boolean(anchorEl)}\r\n      onClose={onClose}\r\n    >\r\n      <MenuItem dense onClick={handleActions(onDelete)}>\r\n        Delete Message\r\n      </MenuItem>\r\n      <MenuItem dense onClick={handleActions(onCopy)}>\r\n        Copy Text\r\n      </MenuItem>\r\n    </Menu>\r\n  );\r\n};\r\n\r\nexport default MessageMenu;\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\n\r\nexport const useStyles = makeStyles((theme) => ({\r\n  Message: {\r\n    display: \"flex\",\r\n    position: \"relative\",\r\n    maxWidth: \"70%\",\r\n    padding: `${theme.spacing(1)}px ${theme.spacing(1.5)}px ${theme.spacing(\r\n      0.5\r\n    )}px`,\r\n    borderRadius: theme.shape.borderRadius * 3,\r\n    \"&:before\": {\r\n      position: \"absolute\",\r\n      bottom: -1,\r\n      width: 15,\r\n      height: 20,\r\n      content: \"''\",\r\n    },\r\n    \"& p\": {\r\n      alignSelf: \"flex-end\",\r\n      wordWrap: \"break-word\",\r\n      overflowWrap: \"break-word\",\r\n      paddingBottom: theme.spacing(2),\r\n      minWidth: 20,\r\n    },\r\n    \"& span\": {\r\n      alignSelf: \"flex-end\",\r\n      opacity: 0.54,\r\n    },\r\n  },\r\n  Message_content: {\r\n    display: \"flex\",\r\n    margin: `${theme.spacing(1)}px 0`,\r\n  },\r\n  Message_content_receiver: {\r\n    justifyContent: \"flex-start\",\r\n  },\r\n  Message_content_sender: {\r\n    justifyContent: \"flex-end\",\r\n  },\r\n  Message_receiver: {\r\n    background:\r\n      theme.palette.type === \"dark\"\r\n        ? theme.lighten(theme.palette.background.default, 0.235)\r\n        : theme.darken(theme.palette.background.default, 0.057),\r\n    \"&:before\": {\r\n      left: -10,\r\n      transform: \"rotate(-15deg)\",\r\n      borderBottom: `15px solid ${\r\n        theme.palette.type === \"dark\"\r\n          ? theme.lighten(theme.palette.background.default, 0.235)\r\n          : theme.darken(theme.palette.background.default, 0.057)\r\n      }`,\r\n      borderLeft: \"15px solid transparent\",\r\n    },\r\n  },\r\n  Message_sender: {\r\n    background: theme.palette.secondary.main,\r\n    color: theme.palette.getContrastText(theme.palette.secondary.main),\r\n    \"&:before\": {\r\n      right: -10,\r\n      transform: \"rotate(15deg)\",\r\n      borderBottom: `15px solid ${theme.palette.secondary.main}`,\r\n      borderRight: \"15px solid transparent\",\r\n    },\r\n  },\r\n}));\r\n","import React from \"react\";\r\nimport { Typography } from \"@material-ui/core\"; // Link\r\nimport cx from \"classnames\";\r\nimport { formatDate } from \"utils/index\";\r\nimport MessageMenu from \"./MessageMenu\";\r\nimport { useStyles } from \"./styles\";\r\n\r\nconst Message = (props) => {\r\n  const classes = useStyles();\r\n  const [contextMenu, setContextMenu] = React.useState(null);\r\n\r\n  const handleClose = () => setContextMenu(null);\r\n\r\n  const handleOpen = (e) => {\r\n    e.preventDefault();\r\n    setContextMenu(e.currentTarget);\r\n  };\r\n\r\n  const handleCopyMessage = () => {\r\n    navigator.clipboard.writeText(props.text);\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={cx(classes.Message_content, {\r\n        [classes.Message_content_sender]: props.isOwner,\r\n        [classes.Message_content_receiver]: !props.isOwner,\r\n      })}\r\n    >\r\n      <div\r\n        onContextMenu={handleOpen}\r\n        className={cx(classes.Message, {\r\n          [classes.Message_sender]: props.isOwner,\r\n          [classes.Message_receiver]: !props.isOwner,\r\n        })}\r\n      >\r\n        <Typography variant=\"body2\">\r\n          {props.text}\r\n          {/* <Link href=\"#\" color=\"inherit\" underline=\"always\">\r\n            some@gmail.com\r\n          </Link> */}\r\n        </Typography>\r\n        <Typography variant=\"caption\">{formatDate(props.date)}</Typography>\r\n      </div>\r\n      <MessageMenu\r\n        anchorEl={contextMenu}\r\n        onClose={handleClose}\r\n        {...props.menuProps}\r\n        onCopy={handleCopyMessage}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Message;\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\n\r\nexport const useStyles = makeStyles((theme) => ({\r\n  Typing: {\r\n    display: \"inline-flex\",\r\n    justifyContent: \"space-between\",\r\n    alignItems: \"center\",\r\n    color: theme.palette.text.secondary,\r\n    \"& span\": {\r\n      width: 5,\r\n      height: 5,\r\n      marginRight: 4,\r\n      background: theme.palette.text.secondary,\r\n      borderRadius: \"50%\",\r\n      \"&:nth-child(1)\": {\r\n        animation: \"$animation 1s ease-in-out infinite 0s\",\r\n      },\r\n      \"&:nth-child(2)\": {\r\n        animation: \"$animation 1s ease-in-out infinite 0.2s\",\r\n      },\r\n      \"&:nth-child(3)\": {\r\n        animation: \"$animation 1s ease-in-out infinite 0.4s\",\r\n      },\r\n    },\r\n  },\r\n  Typing_secondary: {\r\n    color: theme.palette.secondary[200],\r\n    \"& span\": {\r\n      background: theme.palette.secondary[200],\r\n    },\r\n  },\r\n  \"@keyframes animation\": {\r\n    \"0%, 100%\": {\r\n      transform: \"scale(1)\",\r\n      opacity: 1,\r\n    },\r\n    \"50%\": {\r\n      transform: \"scale(.8)\",\r\n      opacity: 0.5,\r\n    },\r\n  },\r\n}));\r\n","import React from \"react\";\r\nimport { useStyles } from \"./styles\";\r\nimport cx from \"classnames\";\r\n\r\nconst Typing = (props) => {\r\n  const classes = useStyles();\r\n  return (\r\n    <span\r\n      className={cx(classes.Typing, {\r\n        [classes.Typing_secondary]: props.variant === \"secondary\",\r\n      })}\r\n    >\r\n      <span />\r\n      <span />\r\n      <span />\r\n      typing\r\n    </span>\r\n  );\r\n};\r\n\r\nexport default Typing;\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\n\r\nexport const useStyles = makeStyles((theme) => ({\r\n  DirectChat: {\r\n    position: \"relative\",\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n    overflow: \"hidden\",\r\n    // borderRight: `1px solid ${theme.palette.divider}`,\r\n  },\r\n  DirectChat_header: {\r\n    minHeight: 64,\r\n    paddingLeft: theme.spacing(1),\r\n    paddingRight: theme.spacing(1),\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n    borderBottom: `1px solid ${theme.palette.divider}`,\r\n  },\r\n  DirectChat_header_status: {\r\n    color: theme.palette.secondary[200],\r\n  },\r\n  DirectChat_content: {\r\n    height: \"100%\",\r\n    maxHeight: \"calc(100% - 64px)\",\r\n    overflowY: \"scroll\",\r\n    position: \"relative\",\r\n    \"&::-webkit-scrollbar\": {\r\n      display: \"none\",\r\n    },\r\n    // borderBottom: `1px solid ${theme.palette.divider}`,\r\n  },\r\n  DirectChat_messageWrapper: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n  },\r\n}));\r\n","import React from \"react\";\r\nimport { ListItem, ListItemText, Divider } from \"@material-ui/core\";\r\nimport {\r\n  formatDate,\r\n  diffTime,\r\n  renderDiffTimeLabel,\r\n  renderTimeline,\r\n} from \"utils/index\";\r\nimport Avatar from \"components/Avatar\";\r\nimport ChatWindow from \"components/ChatWindow\";\r\nimport ChatInput from \"components/ChatWindow/ChatInput\";\r\nimport StyledChip from \"components/StyledChip\";\r\nimport Message from \"components/Message\";\r\nimport { DirectFallback } from \"components/Fallback\";\r\nimport Typing from \"components/Typing\";\r\nimport { useStyles } from \"./styles\";\r\nimport cx from \"classnames\";\r\n\r\n// import VisibilitySenson from \"react-visibility-sensor\";\r\n// <VisibilitySenson\r\n//   offset={{ top: 32, bottom: 32 }}\r\n//   onChange={handleOnReadMessage}\r\n// >\r\n\r\n// const handleOnReadMessage = (isVisible) => {\r\n//   console.log(isVisible, message.text, message);\r\n//   console.log(isVisible && message.unread);\r\n//   if (isVisible && message.unread) props.onReadMessage(message.id);\r\n// };\r\n\r\nconst DirectChat = (props) => {\r\n  const classes = useStyles();\r\n  const timeline = renderTimeline([...props.messages].reverse());\r\n  const [send, setSend] = React.useState(false);\r\n\r\n  const handleChange = () => {\r\n    if (props.chatId) {\r\n      props.onTyping();\r\n    }\r\n  };\r\n\r\n  const handleCreateMessage = async (message) => {\r\n    setSend(true);\r\n    await props.onCreateMessage(message);\r\n    setSend(false);\r\n  };\r\n\r\n  const renderStatus = () => {\r\n    if (props.typingUser) return <Typing variant=\"secondary\" />;\r\n    if (props.recipient.online) return \"online\";\r\n    return `last seen at ${formatDate(props.recipient.lastSeen)}`;\r\n  };\r\n\r\n  const renderMessages = React.useCallback(\r\n    (messages) =>\r\n      messages.length ? (\r\n        [...messages].reverse().map((message, idx) => {\r\n          const timeDiff = diffTime(message.createdAt, \"days\");\r\n\r\n          const timelineChip = idx === timeline[timeDiff] && (\r\n            <StyledChip label={renderDiffTimeLabel(message.createdAt)} />\r\n          );\r\n\r\n          return (\r\n            <div key={message.id} className={classes.DirectChat_messageWrapper}>\r\n              {timelineChip}\r\n              <Message\r\n                text={message.text}\r\n                date={message.createdAt}\r\n                isOwner={message.userId === props.user.id}\r\n                menuProps={{\r\n                  onDelete: props.onDeleteMessage(message.id),\r\n                }}\r\n              />\r\n            </div>\r\n          );\r\n        })\r\n      ) : (\r\n        <DirectFallback />\r\n      ),\r\n    [props.chatId, props.user.id, props.messages, props.onDeleteMessage]\r\n  );\r\n\r\n  return (\r\n    <div className={classes.DirectChat}>\r\n      <div className={classes.DirectChat_header}>\r\n        {props.recipient.username && (\r\n          <ListItem dense>\r\n            <ListItemText\r\n              primary={props.recipient.username}\r\n              primaryTypographyProps={{ component: \"div\" }}\r\n              secondary={renderStatus()}\r\n              secondaryTypographyProps={{\r\n                variant: \"caption\",\r\n                className: cx({\r\n                  [classes.DirectChat_header_status]: props.recipient.online,\r\n                }),\r\n              }}\r\n            />\r\n            <Avatar\r\n              src={props.recipient.avatar}\r\n              alt={props.recipient.username}\r\n              online={props.recipient.online}\r\n            />\r\n          </ListItem>\r\n        )}\r\n      </div>\r\n      <div className={classes.DirectChat_content}>\r\n        <ChatWindow\r\n          send={send}\r\n          hasMore={props.hasMore}\r\n          messages={props.messages}\r\n          renderMessages={renderMessages}\r\n          onLoadMoreMessages={props.onLoadMoreMessages}\r\n        />\r\n        <Divider />\r\n        <ChatInput onChange={handleChange} onSubmit={handleCreateMessage} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DirectChat;\r\n","import React from \"react\";\r\nimport DirectChat from \"components/DirectChat\";\r\nimport { useTyping } from \"hooks/index\";\r\nimport {\r\n  DirectCreatedDocument,\r\n  GetMessagesDocument,\r\n  TypingUserDocument,\r\n  DirectDeletedDocument,\r\n  MessageCreatedDocument,\r\n  MessageDeletedDocument,\r\n  useCreateDirectMutation,\r\n  useDeleteDirectMutation,\r\n  useCreateMessageMutation,\r\n  useDeleteMessageMutation,\r\n  useReadMessageMutation,\r\n  useTypeMessageMutation,\r\n  useCurrentUserQuery,\r\n  useCurrentDirectQuery,\r\n  useGetMessagesQuery,\r\n} from \"graphql/generated.tsx\";\r\nimport { errorHandler } from \"utils/index\";\r\n\r\nconst DirectChatContainer = ({ userId }) => {\r\n  const [state, setstate] = React.useState({\r\n    hasMore: true,\r\n  });\r\n\r\n  const currentUser = useCurrentUserQuery({ onError: errorHandler });\r\n  const currentDirect = useCurrentDirectQuery({\r\n    onError: errorHandler,\r\n    variables: { userId },\r\n    skip: !userId,\r\n  });\r\n  const [createDirect, { client }] = useCreateDirectMutation({\r\n    onError: errorHandler,\r\n  });\r\n  const [deleteDirect] = useDeleteDirectMutation({ onError: errorHandler });\r\n  const [createMessage] = useCreateMessageMutation({ onError: errorHandler });\r\n  const [deleteMessage] = useDeleteMessageMutation({ onError: errorHandler });\r\n  const [readMessage] = useReadMessageMutation({ onError: errorHandler });\r\n  const [typeMessage] = useTypeMessageMutation();\r\n\r\n  const self = currentUser?.data?.currentUser ?? {};\r\n  const recipient = currentDirect?.data?.currentDirect?.recipient ?? {};\r\n  const chatId = currentDirect?.data?.currentDirect?.direct?.id ?? null;\r\n\r\n  const {\r\n    data: messagesData,\r\n    fetchMore,\r\n    subscribeToMore: subscribeToMoreMessages,\r\n  } = useGetMessagesQuery({\r\n    onError: errorHandler,\r\n    variables: { chatId },\r\n    skip: !chatId,\r\n  });\r\n\r\n  const messages = chatId ? messagesData?.messages ?? [] : [];\r\n\r\n  const [typingUser, onTyping] = useTyping(\r\n    { chatId, username: self.username },\r\n    (variables) => typeMessage({ variables })\r\n  );\r\n\r\n  const loadMoreMessages = () => {\r\n    if (messagesData && state.hasMore && chatId) {\r\n      fetchMore({\r\n        variables: { chatId, offset: messages.length },\r\n        updateQuery: (prev, { fetchMoreResult }) => {\r\n          const limit = 20;\r\n\r\n          if (!fetchMoreResult) return prev;\r\n\r\n          if (fetchMoreResult.messages.length < limit) {\r\n            setstate({ hasMore: false });\r\n          }\r\n\r\n          return {\r\n            messages: [...prev.messages, ...fetchMoreResult.messages],\r\n          };\r\n        },\r\n      });\r\n    }\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    const subscribtions = {\r\n      messageCreated: () => {\r\n        return subscribeToMoreMessages({\r\n          document: MessageCreatedDocument,\r\n          variables: { chatIds: [chatId] },\r\n          updateQuery: (prev, { subscriptionData }) => {\r\n            if (!subscriptionData.data || !prev) return prev;\r\n            return {\r\n              messages: [\r\n                subscriptionData.data.messageCreated,\r\n                ...prev.messages,\r\n              ],\r\n            };\r\n          },\r\n        });\r\n      },\r\n      messagesDeleted: () => {\r\n        return subscribeToMoreMessages({\r\n          document: MessageDeletedDocument,\r\n          variables: { chatIds: [chatId] },\r\n          updateQuery: (prev, { subscriptionData }) => {\r\n            if (!subscriptionData.data) return prev;\r\n            const messages = prev.messages.filter(\r\n              (message) =>\r\n                subscriptionData.data.messageDeleted.ids !== message.id\r\n            );\r\n\r\n            client.writeQuery({\r\n              query: GetMessagesDocument,\r\n              data: { messages },\r\n            });\r\n\r\n            return { messages };\r\n          },\r\n        });\r\n      },\r\n    };\r\n\r\n    const messageCreated = subscribtions.messageCreated();\r\n    const messageDeleted = subscribtions.messagesDeleted();\r\n\r\n    return () => {\r\n      messageCreated();\r\n      messageDeleted();\r\n    };\r\n  }, [subscribeToMoreMessages, chatId]);\r\n\r\n  React.useEffect(() => {\r\n    const subscribtions = {\r\n      directCreated: () =>\r\n        currentDirect.subscribeToMore({\r\n          document: DirectCreatedDocument,\r\n          updateQuery: (prev, { subscriptionData }) => {\r\n            if (!subscriptionData.data) return prev;\r\n\r\n            return {\r\n              currentDirect: {\r\n                ...prev.currentDirect,\r\n                direct: subscriptionData.data.direct,\r\n              },\r\n            };\r\n          },\r\n        }),\r\n      directDeleted: () =>\r\n        currentDirect.subscribeToMore({\r\n          document: DirectDeletedDocument,\r\n          updateQuery: (prev, { subscriptionData }) => {\r\n            if (\r\n              !subscriptionData.data ||\r\n              subscriptionData.data.direct.id !== chatId\r\n            ) {\r\n              return prev;\r\n            }\r\n\r\n            return { currentDirect: { ...prev.currentDirect, direct: null } };\r\n          },\r\n        }),\r\n    };\r\n\r\n    const directCreated = subscribtions.directCreated();\r\n    const directDeleted = subscribtions.directDeleted();\r\n    return () => {\r\n      directCreated();\r\n      directDeleted();\r\n    };\r\n  }, [currentDirect, chatId]);\r\n\r\n  React.useEffect(() => {\r\n    const subscribe = () => {\r\n      if (chatId) {\r\n        return currentDirect.subscribeToMore({\r\n          document: TypingUserDocument,\r\n          variables: { chatId },\r\n          updateQuery: (prev, { subscriptionData }) => {\r\n            if (subscriptionData.data) {\r\n              typingUser.setUser(subscriptionData.data.typingUser);\r\n            }\r\n\r\n            return prev;\r\n          },\r\n        });\r\n      }\r\n      return () => {};\r\n    };\r\n    const unsubscribe = subscribe();\r\n    return unsubscribe;\r\n  }, [currentDirect, chatId]);\r\n\r\n  const onCreateMessage = async (text) => {\r\n    if (!chatId) {\r\n      await createDirect({ variables: { text, userId: recipient.id } });\r\n    } else {\r\n      await createMessage({ variables: { text, chatId } });\r\n      await typeMessage({ variables: { chatId, username: \"\" } });\r\n    }\r\n  };\r\n\r\n  const onDeleteMessage = (id) => async () => {\r\n    if (messages && messages.length === 1) {\r\n      await deleteDirect({ variables: { id: chatId } });\r\n    } else {\r\n      await deleteMessage({ variables: { id } });\r\n    }\r\n  };\r\n\r\n  const onReadMessage = (id) => readMessage({ variables: { id } });\r\n\r\n  return (\r\n    <DirectChat\r\n      user={self}\r\n      chatId={chatId}\r\n      recipient={recipient}\r\n      hasMore={state.hasMore}\r\n      messages={messages}\r\n      typingUser={typingUser.user === self.username ? \"\" : typingUser.user}\r\n      onTyping={onTyping}\r\n      onCreateMessage={onCreateMessage}\r\n      onDeleteMessage={onDeleteMessage}\r\n      onReadMessage={onReadMessage}\r\n      onLoadMoreMessages={loadMoreMessages}\r\n    />\r\n  );\r\n};\r\n\r\nexport default DirectChatContainer;\r\n","import React from \"react\";\r\nimport { useDebouncedCallback } from \"use-debounce\";\r\n\r\nexport const useTyping = (data, callback) => {\r\n  const [typing, setTyping] = React.useState(false);\r\n  const [user, setUser] = React.useState(\"\");\r\n  const [debounce] = useDebouncedCallback(async (value) => {\r\n    setTyping(false);\r\n    await callback(value);\r\n  }, 500);\r\n\r\n  const onTyping = async () => {\r\n    setTyping(true);\r\n\r\n    if (!typing) await callback(data);\r\n\r\n    debounce({ ...data, username: \"\" });\r\n  };\r\n\r\n  return [{ user, setUser }, onTyping];\r\n};\r\n\r\nexport const usePrev = (values) => {\r\n  const ref = React.useRef();\r\n\r\n  React.useEffect(() => {\r\n    ref.current = values;\r\n  }, [values]);\r\n\r\n  return ref.current;\r\n};\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\n\r\nexport const useStyles = makeStyles((theme) => ({\r\n  Sidebar: {\r\n    position: \"relative\",\r\n    width: \"100%\",\r\n    maxWidth: theme.props.sidebar,\r\n    minWidth: theme.props.sidebarMin,\r\n    // borderRight: `1px solid ${theme.palette.divider}`,\r\n  },\r\n  Sidebar_main: {\r\n    position: \"relative\",\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n    overflow: \"hidden\",\r\n    background:\r\n      theme.palette.type === \"dark\"\r\n        ? theme.palette.action.selected\r\n        : theme.palette.action.hover,\r\n    borderRight: `1px solid ${theme.palette.divider}`,\r\n  },\r\n  Sidebar_header: {\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-between\",\r\n    padding: `${theme.spacing(0.5)}px ${theme.spacing(3)}px`,\r\n    minHeight: 64,\r\n  },\r\n  Sidebar_searchbar: {\r\n    background: theme.palette.action.selected,\r\n    padding: `0 ${theme.spacing(1)}px`,\r\n    fontSize: theme.typography.body2.fontSize,\r\n    minHeight: 32,\r\n    marginLeft: theme.spacing(1),\r\n    borderRadius: theme.shape.borderRadius,\r\n  },\r\n  Sidebar_content: {\r\n    height: \"100%\",\r\n    maxHeight: \"calc(100% - 64px)\",\r\n    overflowY: \"scroll\",\r\n    position: \"relative\",\r\n    \"&::-webkit-scrollbar\": {\r\n      display: \"none\",\r\n    },\r\n    // borderTop: `1px solid ${theme.palette.divider}`\r\n  },\r\n}));\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\n\r\nexport const useStyles = makeStyles((theme) => ({\r\n  MenuDrawer: {\r\n    position: \"absolute\",\r\n    width: \"95%\",\r\n    height: \"100%\",\r\n    zIndex: theme.zIndex.tooltip,\r\n    // background: theme.palette.background.paper,\r\n    backgroundImage: `linear-gradient(90deg, ${theme.palette.background.default}, ${theme.palette.background.paper})`,\r\n    borderRight: `1px solid ${theme.palette.divider}`,\r\n  },\r\n  MenuDrawer_listItem: {\r\n    \"& p\": {\r\n      width: \"100%\",\r\n      marginLeft: theme.spacing(2),\r\n    },\r\n    \"&:last-child p\": {\r\n      color: theme.palette.error.dark,\r\n      marginLeft: 0,\r\n    },\r\n  },\r\n  MenuDrawer_backdrop: {\r\n    width: \"100%\",\r\n    maxWidth: 960,\r\n    zIndex: 1300,\r\n    left: \"auto\",\r\n    right: \"auto\",\r\n  },\r\n}));\r\n","import React from \"react\";\r\nimport {\r\n  List,\r\n  ListItem,\r\n  ListItemText,\r\n  Typography,\r\n  Slide,\r\n  Backdrop,\r\n} from \"@material-ui/core\";\r\nimport Avatar from \"components/Avatar\";\r\nimport { Settings as SettingsIcon } from \"@material-ui/icons\";\r\nimport { useStyles } from \"./styles\";\r\n\r\nexport const menuSchema = [\r\n  {\r\n    title: \"Settings\",\r\n    link: \"/settings\",\r\n    icon: <SettingsIcon />,\r\n  },\r\n];\r\n\r\nconst MenuDrawer = ({ user = {}, open, ...props }) => {\r\n  const classes = useStyles();\r\n  // const open = false;\r\n\r\n  // const [open, setOpen] = React.useState(false);\r\n\r\n  // const handleMenuToggle = () => setOpen(!open);\r\n\r\n  return (\r\n    <>\r\n      <Slide in={open} direction=\"right\">\r\n        <div className={classes.MenuDrawer}>\r\n          <List>\r\n            <ListItem>\r\n              <Avatar\r\n                src={user.avatar}\r\n                alt={user.username}\r\n                online={user.online}\r\n              />\r\n            </ListItem>\r\n            <ListItem>\r\n              <ListItemText primary={user.username} secondary={user.email} />\r\n            </ListItem>\r\n          </List>\r\n          <List>\r\n            {/* {menuSchema.map(({ title, link, icon }) => (\r\n              <ListItem\r\n                key={title}\r\n                button\r\n                to={link}\r\n                className={classes.MenuDrawer_listItem}\r\n                component={link ? Link : \"div\"}\r\n                onClick={props.onClose}\r\n              >\r\n                {icon}\r\n                <Typography variant=\"body2\">{title}</Typography>\r\n              </ListItem>\r\n            ))} */}\r\n            <ListItem\r\n              button\r\n              className={classes.MenuDrawer_listItem}\r\n              component=\"div\"\r\n              onClick={() => {\r\n                props.onLogout();\r\n                props.onClose();\r\n              }}\r\n            >\r\n              <Typography variant=\"body2\" align=\"center\">\r\n                Log Out\r\n              </Typography>\r\n            </ListItem>\r\n          </List>\r\n        </div>\r\n      </Slide>\r\n      <Backdrop\r\n        open={open}\r\n        onClick={props.onClose}\r\n        className={classes.MenuDrawer_backdrop}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MenuDrawer;\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\n\r\nexport const useStyles = makeStyles(theme => ({\r\n  UserItem_primary: {\r\n    ...theme.props.classes.ellipsis\r\n  },\r\n  UserItem_secondary: {\r\n    ...theme.props.classes.ellipsis,\r\n    color: theme.palette.secondary[200]\r\n  }\r\n}));\r\n","import React from \"react\";\r\nimport { ListItem, ListItemAvatar, ListItemText } from \"@material-ui/core\";\r\nimport { Link } from \"react-router-dom\";\r\nimport Avatar from \"components/Avatar\";\r\nimport { useStyles } from \"./styles\";\r\n\r\nconst UserItem = (props) => {\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <ListItem {...props} dense button to={props.link} component={Link}>\r\n      <ListItemAvatar>\r\n        <Avatar\r\n          src={props.user.avatar}\r\n          alt={props.user.username}\r\n          online={props.user.online}\r\n        />\r\n      </ListItemAvatar>\r\n      <ListItemText\r\n        primary={props.user.username}\r\n        primaryTypographyProps={{\r\n          component: \"div\",\r\n          className: classes.UserItem_primary,\r\n        }}\r\n        secondary={`@${props.user.username}`}\r\n        secondaryTypographyProps={{\r\n          variant: \"caption\",\r\n          component: \"div\",\r\n          className: classes.UserItem_secondary,\r\n        }}\r\n      />\r\n    </ListItem>\r\n  );\r\n};\r\n\r\nexport default UserItem;\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\n\r\nexport const useStyles = makeStyles((theme) => ({\r\n  ChatItem_badge_root: {\r\n    height: 15,\r\n  },\r\n  ChatItem_badge_badge: {\r\n    position: \"relative\",\r\n    transform: \"none\",\r\n    height: \"inherit\",\r\n  },\r\n  ChatItem_primary: {\r\n    display: \"flex\",\r\n  },\r\n  ChatItem_secondary: {\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n  },\r\n  ChatItem_primaryText: {\r\n    width: \"100%\",\r\n    ...theme.props.classes.ellipsis,\r\n  },\r\n  ChatItem_secondaryText: {\r\n    width: \"100%\",\r\n    marginRight: theme.spacing(1),\r\n    ...theme.props.classes.ellipsis,\r\n  },\r\n}));\r\n","import React from \"react\";\r\nimport {\r\n  ListItem,\r\n  ListItemAvatar,\r\n  ListItemText,\r\n  Typography,\r\n  Badge,\r\n} from \"@material-ui/core\";\r\nimport { Link } from \"react-router-dom\";\r\nimport Avatar from \"components/Avatar\";\r\nimport { useStyles } from \"./styles\";\r\nimport { formatDate } from \"utils/index\";\r\nimport Typing from \"components/Typing\";\r\n\r\nconst ChatItem = ({\r\n  link,\r\n  date,\r\n  avatar,\r\n  online,\r\n  unread,\r\n  typing = false,\r\n  selected,\r\n  primary,\r\n  secondary,\r\n\r\n  onContextMenu,\r\n  ...props\r\n}) => {\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <ListItem\r\n      dense\r\n      button\r\n      // disableRipple\r\n      to={link}\r\n      component={Link}\r\n      selected={selected}\r\n      onContextMenu={onContextMenu}\r\n      {...props}\r\n    >\r\n      <ListItemAvatar>\r\n        <Avatar src={avatar} alt={primary} online={online} />\r\n      </ListItemAvatar>\r\n      <ListItemText\r\n        primary={\r\n          <>\r\n            <Typography\r\n              variant=\"body2\"\r\n              className={classes.ChatItem_primaryText}\r\n            >\r\n              {primary}\r\n            </Typography>\r\n            <Typography variant=\"caption\" color=\"textSecondary\">\r\n              {formatDate(date)}\r\n            </Typography>\r\n          </>\r\n        }\r\n        primaryTypographyProps={{\r\n          className: classes.ChatItem_primary,\r\n          component: \"div\",\r\n        }}\r\n        secondary={\r\n          <>\r\n            <Typography\r\n              variant=\"caption\"\r\n              className={classes.ChatItem_secondaryText}\r\n            >\r\n              {typing ? <Typing /> : secondary}\r\n            </Typography>\r\n            <Badge\r\n              max={50}\r\n              classes={{\r\n                badge: classes.ChatItem_badge_badge,\r\n                root: classes.ChatItem_badge_root,\r\n              }}\r\n              badgeContent={unread}\r\n              color=\"secondary\"\r\n            />\r\n          </>\r\n        }\r\n        secondaryTypographyProps={{\r\n          className: classes.ChatItem_secondary,\r\n          component: \"div\",\r\n        }}\r\n      />\r\n    </ListItem>\r\n  );\r\n};\r\n\r\nexport default ChatItem;\r\n","import React from \"react\";\r\nimport { Menu, MenuItem } from \"@material-ui/core\";\r\n\r\nconst DirectItemMenu = ({ anchorEl, onClose, onDelete }) => {\r\n  const handleActions = (callback) => () => {\r\n    callback();\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Menu\r\n      anchorEl={anchorEl}\r\n      anchorOrigin={{ vertical: \"top\", horizontal: \"right\" }}\r\n      open={Boolean(anchorEl)}\r\n      onClose={onClose}\r\n    >\r\n      <MenuItem dense onClick={handleActions(onDelete)}>\r\n        Delete chat\r\n      </MenuItem>\r\n    </Menu>\r\n  );\r\n};\r\n\r\nexport default DirectItemMenu;\r\n","import React from \"react\";\r\nimport ChatItem from \"components/ChatItem\";\r\nimport DirectItemMenu from \"./DirectItemMenu\";\r\n\r\nconst DirectItem = (props) => {\r\n  const [contextMenu, setContextMenu] = React.useState(null);\r\n\r\n  React.useEffect(() => {\r\n    const unsubscribes = props.subscribtions.map((subscribe) =>\r\n      subscribe(props.direct.id)\r\n    );\r\n    return () =>\r\n      unsubscribes.map((unsubscribe) => unsubscribe(props.direct.id));\r\n  }, [props.direct.id, props.subscribtions]);\r\n\r\n  const handleOpen = (e) => {\r\n    e.preventDefault();\r\n    setContextMenu(e.currentTarget);\r\n  };\r\n\r\n  const handleClose = () => setContextMenu(null);\r\n\r\n  const handleDelete = () => {\r\n    props.onDelete(props.direct.id);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <ChatItem\r\n        link={props.link}\r\n        typing={props.typing}\r\n        selected={props.selected}\r\n        avatar={props.user.avatar}\r\n        online={props.user.online}\r\n        unread={props.direct.unread}\r\n        primary={props.user.username}\r\n        secondary={props.direct.lastMessage.text}\r\n        date={props.direct.lastMessage.createdAt}\r\n        onClick={props.onClick}\r\n        onContextMenu={handleOpen}\r\n      />\r\n      <DirectItemMenu\r\n        anchorEl={contextMenu}\r\n        onClose={handleClose}\r\n        onDelete={handleDelete}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default DirectItem;\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\n\r\nexport const useStyles = makeStyles((theme) => ({\r\n  StyledList: {},\r\n  StyledList_subheader: {\r\n    background: theme.palette.action.selected,\r\n    // background:\r\n    //   theme.palette.type === \"dark\"\r\n    //     ? theme.lighten(theme.palette.background.default, 0.235)\r\n    //     : theme.darken(theme.palette.background.default, 0.057),\r\n    lineHeight: \"32px\",\r\n    fontSize: theme.typography.body2.fontSize,\r\n  },\r\n}));\r\n","import React from \"react\";\r\nimport { ListSubheader, List } from \"@material-ui/core\";\r\nimport { useStyles } from \"./styles\";\r\n\r\nconst StyledList = (props) => {\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <List\r\n      {...props}\r\n      subheader={\r\n        props.subheader ? (\r\n          <ListSubheader\r\n            component=\"div\"\r\n            className={classes.StyledList_subheader}\r\n          >\r\n            {props.subheader}\r\n          </ListSubheader>\r\n        ) : null\r\n      }\r\n    />\r\n  );\r\n};\r\n\r\nexport default StyledList;\r\n","import React from \"react\";\r\nimport { IconButton, InputBase } from \"@material-ui/core\";\r\nimport { Menu as MenuIcon } from \"@material-ui/icons\";\r\nimport { useDebouncedCallback } from \"use-debounce\";\r\nimport { useStyles } from \"./styles\";\r\nimport MenuDrawer from \"components/MenuDrawer\";\r\nimport UserItem from \"components/UserItem\";\r\nimport DirectItem from \"components/DirectItem\";\r\nimport StyledList from \"components/StylesList\";\r\n\r\nconst Sidebar = (props) => {\r\n  const classes = useStyles();\r\n  const [open, setOpen] = React.useState(false);\r\n  const [search, setSearch] = React.useState(\"\");\r\n\r\n  const renderDirectsList = (data, restProps = {}) => {\r\n    return data ? (\r\n      <StyledList disablePadding>\r\n        {data.map((direct) => (\r\n          <DirectItem\r\n            key={direct.id}\r\n            direct={direct}\r\n            user={direct.user}\r\n            typing={\r\n              props.typings[direct.id] === direct.user.username\r\n                ? props.typings[direct.id]\r\n                : \"\"\r\n            }\r\n            link={`/me?p=${direct.user.id}`}\r\n            selected={direct.user.id === props.chatId}\r\n            onDelete={props.onDeleteDirect}\r\n            subscribtions={props.directSubscriptions}\r\n            {...restProps}\r\n          />\r\n        ))}\r\n      </StyledList>\r\n    ) : null;\r\n  };\r\n\r\n  const renderDirects = () => {\r\n    if (search.length) {\r\n      let directsMatch = [];\r\n\r\n      if (props.directs && props.directs.length) {\r\n        directsMatch = props.directs.filter(({ user }) =>\r\n          user.username.startsWith(search)\r\n        );\r\n      }\r\n\r\n      const directsMatchIds = directsMatch.map(({ user }) => user.id);\r\n\r\n      return (\r\n        <>\r\n          {renderDirectsList(directsMatch, {\r\n            selected: false,\r\n            onClick: () => setSearch(\"\"),\r\n          })}\r\n          {props.users && props.users.length ? (\r\n            <StyledList subheader=\"Global search\" disablePadding>\r\n              {props.users.map(\r\n                (user) =>\r\n                  !directsMatchIds.includes(user.id) && (\r\n                    <UserItem\r\n                      key={user.id}\r\n                      user={user}\r\n                      link={`/me?p=${user.id}`}\r\n                      onClick={() => setSearch(\"\")}\r\n                    />\r\n                  )\r\n              )}\r\n            </StyledList>\r\n          ) : null}\r\n        </>\r\n      );\r\n    }\r\n\r\n    return renderDirectsList(props.directs);\r\n  };\r\n\r\n  const [debounce] = useDebouncedCallback(\r\n    (value) => props.onSearch(value),\r\n    200\r\n  );\r\n\r\n  const handleChange = (e) => {\r\n    setSearch(e.target.value);\r\n    debounce(e.target.value);\r\n  };\r\n\r\n  const handleMenuToggle = () => setOpen(!open);\r\n\r\n  return (\r\n    <div className={classes.Sidebar}>\r\n      <MenuDrawer\r\n        open={open}\r\n        user={props.currentUser}\r\n        onClose={handleMenuToggle}\r\n        onLogout={props.onLogout}\r\n      />\r\n      <div className={classes.Sidebar_main}>\r\n        <div className={classes.Sidebar_header}>\r\n          <IconButton edge=\"start\" color=\"inherit\" onClick={handleMenuToggle}>\r\n            <MenuIcon />\r\n          </IconButton>\r\n          <InputBase\r\n            fullWidth\r\n            size=\"small\"\r\n            value={search}\r\n            placeholder=\"Search\"\r\n            className={classes.Sidebar_searchbar}\r\n            onChange={handleChange}\r\n          />\r\n        </div>\r\n        <div className={classes.Sidebar_content}>\r\n          {renderDirects(props.directs)}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Sidebar;\r\n","import React from \"react\";\r\nimport { pasreQuery } from \"utils/index\";\r\nimport Sidebar from \"components/Sidebar\";\r\nimport { sortByLastMessage, authTokens, errorHandler } from \"utils/index\";\r\nimport { wsLink } from \"client\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport {\r\n  DirectCreatedDocument,\r\n  DirectDeletedDocument,\r\n  MessageCreatedDocument,\r\n  MessageDeletedDocument,\r\n  OnlineUserDocument,\r\n  TypingUserDocument,\r\n  DirectsDocument,\r\n  useUsersLazyQuery,\r\n  useDirectsQuery,\r\n  useDeleteDirectMutation,\r\n  useLogoutMutation,\r\n  useCurrentUserQuery,\r\n} from \"graphql/generated.tsx\";\r\n\r\nconst SidebarContainer = () => {\r\n  const history = useHistory();\r\n  const onLogout = () => {\r\n    authTokens.remove();\r\n    wsLink.subscriptionClient.client.onclose();\r\n    client.resetStore();\r\n    history.push(\"/login\");\r\n  };\r\n  const { data: user } = useCurrentUserQuery();\r\n  const { data: directs, subscribeToMore, client } = useDirectsQuery();\r\n  const [searchUsers, { data: users }] = useUsersLazyQuery();\r\n  const [deleteDirect] = useDeleteDirectMutation({ onError: errorHandler });\r\n  const [logout] = useLogoutMutation({ onCompleted: onLogout });\r\n\r\n  const [typings, setTypings] = React.useState({});\r\n  const currentUser = user?.currentUser ?? {};\r\n  const { p: chatId } = pasreQuery(history.location);\r\n\r\n  const directSubscriptions = [\r\n    (chatId) =>\r\n      subscribeToMore({\r\n        document: TypingUserDocument,\r\n        variables: { chatId },\r\n        updateQuery: (prev, { subscriptionData }) => {\r\n          if (!subscriptionData.data) return prev;\r\n          const { typingUser } = subscriptionData.data;\r\n          setTypings({ ...typings, [chatId]: typingUser });\r\n          return prev;\r\n        },\r\n      }),\r\n  ];\r\n\r\n  React.useEffect(\r\n    () => {\r\n      const chatIds = (directs?.directs ?? []).map(({ id }) => id);\r\n      const subscribtions = {\r\n        messageCreated: (chatIds) =>\r\n          subscribeToMore({\r\n            document: MessageCreatedDocument,\r\n            variables: { chatIds },\r\n            updateQuery: (prev, { subscriptionData }) => {\r\n              if (!subscriptionData.data) return prev;\r\n              const { messageCreated } = subscriptionData.data;\r\n              const unread = messageCreated.userId !== currentUser.id ? 1 : 0;\r\n              const directs = prev.directs.map((direct) => {\r\n                if (direct.id === messageCreated.chatId) {\r\n                  return {\r\n                    ...direct,\r\n                    lastMessage: messageCreated,\r\n                    unread: direct.unread + unread,\r\n                  };\r\n                }\r\n                return direct;\r\n              });\r\n              return { directs };\r\n            },\r\n          }),\r\n        messageDeleted: () =>\r\n          subscribeToMore({\r\n            document: MessageDeletedDocument,\r\n            variables: { chatIds },\r\n            updateQuery: async (prev, { subscriptionData }) => {\r\n              if (!subscriptionData.data) return prev;\r\n              const { messageDeleted } = subscriptionData.data;\r\n\r\n              const directs = prev.directs.map((direct) =>\r\n                direct.id === messageDeleted.chat.id ||\r\n                messageDeleted.ids === direct.lastMessage.id\r\n                  ? messageDeleted.chat\r\n                  : direct\r\n              );\r\n\r\n              client.writeQuery({ query: DirectsDocument, data: { directs } });\r\n              return { directs };\r\n            },\r\n          }),\r\n        directCreated: () =>\r\n          subscribeToMore({\r\n            document: DirectCreatedDocument,\r\n            updateQuery: (prev, { subscriptionData }) => {\r\n              if (!subscriptionData.data) return prev;\r\n              const directs = prev.directs.concat(subscriptionData.data.direct);\r\n              return { directs };\r\n            },\r\n          }),\r\n        directDeleted: () =>\r\n          subscribeToMore({\r\n            document: DirectDeletedDocument,\r\n            updateQuery: async (prev, { subscriptionData }) => {\r\n              if (!subscriptionData.data) return prev;\r\n              const directs = prev.directs.filter(\r\n                ({ id }) => id !== subscriptionData.data.direct.id\r\n              );\r\n\r\n              client.writeQuery({ query: DirectsDocument, data: { directs } });\r\n\r\n              return { directs };\r\n            },\r\n          }),\r\n        onlineUser: () => subscribeToMore({ document: OnlineUserDocument }),\r\n      };\r\n\r\n      const messageDeleted = subscribtions.messageDeleted(chatIds);\r\n      const messageCreated = subscribtions.messageCreated(chatIds);\r\n      const directCreated = subscribtions.directCreated();\r\n      const directDeleted = subscribtions.directDeleted();\r\n      const onlineUser = subscribtions.onlineUser();\r\n      return () => {\r\n        messageDeleted();\r\n        messageCreated();\r\n        directCreated();\r\n        directDeleted();\r\n        onlineUser();\r\n      };\r\n    },\r\n    [(directs?.directs ?? []).length],\r\n    subscribeToMore\r\n  );\r\n\r\n  const onSearch = (username) => {\r\n    searchUsers({ variables: { username } });\r\n  };\r\n\r\n  const onDeleteDirect = (id) => {\r\n    deleteDirect({ variables: { id } });\r\n  };\r\n\r\n  return (\r\n    <Sidebar\r\n      chatId={chatId}\r\n      typings={typings}\r\n      directs={(directs?.directs ?? []).sort(sortByLastMessage)}\r\n      users={users?.users}\r\n      currentUser={currentUser}\r\n      onLogout={logout}\r\n      onSearch={onSearch}\r\n      onDeleteDirect={onDeleteDirect}\r\n      directSubscriptions={directSubscriptions}\r\n    />\r\n  );\r\n};\r\n\r\nexport default SidebarContainer;\r\n","import React from \"react\";\r\nimport { Container } from \"@material-ui/core\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport SidebarContainer from \"containers/SidebarContainer\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  container: {\r\n    display: \"flex\",\r\n    overflow: \"hidden\",\r\n    padding: 0,\r\n    minHeight: \"100vh\",\r\n    maxHeight: \"100vh\",\r\n  },\r\n  contentShift: {\r\n    width: \"100%\",\r\n    background: theme.palette.background.paper,\r\n    minWidth: theme.props.sidebarMin,\r\n  },\r\n}));\r\n\r\nconst Layout = (props) => {\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <Container maxWidth=\"md\" className={classes.container}>\r\n      <SidebarContainer />\r\n      <div className={classes.contentShift}>{props.children}</div>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default Layout;\r\n","import React from \"react\";\r\nimport { pasreQuery } from \"utils/index\";\r\nimport DirectChatContainer from \"containers/DirectChatContainer\";\r\nimport Layout from \"components/Layout\";\r\n\r\nconst Home = (props) => {\r\n  const { p: userId } = pasreQuery(props.location);\r\n\r\n  return (\r\n    <Layout>{userId ? <DirectChatContainer userId={userId} /> : null}</Layout>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"],"sourceRoot":""}