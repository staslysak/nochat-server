(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[7],{162:function(e,t,n){"use strict";n.d(t,"h",(function(){return g})),n.d(t,"e",(function(){return h})),n.d(t,"j",(function(){return v})),n.d(t,"a",(function(){return y})),n.d(t,"b",(function(){return j})),n.d(t,"d",(function(){return O})),n.d(t,"c",(function(){return x})),n.d(t,"g",(function(){return E})),n.d(t,"f",(function(){return I})),n.d(t,"i",(function(){return w}));var a=n(164),r=n(165),c=n.n(r);function i(){var e=Object(a.a)(["\n  mutation userTyping($chatId: Int!, $username: String) {\n    userTyping(chatId: $chatId, username: $username)\n  }\n"]);return i=function(){return e},e}function s(){var e=Object(a.a)(["\n  mutation logout {\n    logout\n  }\n"]);return s=function(){return e},e}function o(){var e=Object(a.a)(["\n  mutation readMessage($id: Int!) {\n    readMessage(id: $id)\n  }\n"]);return o=function(){return e},e}function u(){var e=Object(a.a)(["\n  mutation deleteDirect($id: Int!) {\n    deleteDirect(id: $id)\n  }\n"]);return u=function(){return e},e}function l(){var e=Object(a.a)(["\n  mutation deleteMessage($id: Int!) {\n    deleteMessage(id: $id)\n  }\n"]);return l=function(){return e},e}function d(){var e=Object(a.a)(["\n  mutation createMessage($chatId: Int, $text: String!) {\n    createMessage(chatId: $chatId, text: $text)\n  }\n"]);return d=function(){return e},e}function p(){var e=Object(a.a)(["\n  mutation createDirect($userId: Int!, $text: String) {\n    createDirect(userId: $userId, text: $text) {\n      id\n    }\n  }\n"]);return p=function(){return e},e}function f(){var e=Object(a.a)(["\n  mutation verifyUser($secret: String!) {\n    verifyUser(secret: $secret) {\n      token\n      refreshToken\n    }\n  }\n"]);return f=function(){return e},e}function b(){var e=Object(a.a)(["\n  mutation login($username: String!, $password: String!) {\n    login(username: $username, password: $password) {\n      token\n      refreshToken\n    }\n  }\n"]);return b=function(){return e},e}function m(){var e=Object(a.a)(["\n  mutation register($username: String!, $email: String!, $password: String!) {\n    register(username: $username, email: $email, password: $password)\n  }\n"]);return m=function(){return e},e}var g=c()(m()),h=c()(b()),v=c()(f()),y=c()(p()),j=c()(d()),O=c()(l()),x=c()(u()),E=c()(o()),I=c()(s()),w=c()(i())},242:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(20),i=n(160),s=n.n(i),o=n(161),u=n(23),l=n(190),d=n(159),p=n(164),f=n(165),b=n.n(f);function m(){var e=Object(p.a)(["\n  subscription userTyping($chatId: Int!) {\n    userTyping(chatId: $chatId)\n  }\n"]);return m=function(){return e},e}function g(){var e=Object(p.a)(["\n  subscription onlineUser {\n    onlineUser {\n      id\n      online\n      lastSeen\n    }\n  }\n"]);return g=function(){return e},e}function h(){var e=Object(p.a)(["\n  subscription newDirect {\n    newDirect {\n      id\n      user {\n        id\n        email\n        avatar\n        online\n        username\n        lastSeen\n        createdAt\n      }\n      lastMessage {\n        id\n        text\n        userId\n        unread\n        createdAt\n      }\n      unread\n    }\n  }\n"]);return h=function(){return e},e}function v(){var e=Object(p.a)(["\n  subscription deleteDirect {\n    deleteDirect {\n      id\n    }\n  }\n"]);return v=function(){return e},e}function y(){var e=Object(p.a)(["\n  subscription deleteMessage($chatId: Int!) {\n    deleteMessage(chatId: $chatId) {\n      id\n      userId\n    }\n  }\n"]);return y=function(){return e},e}function j(){var e=Object(p.a)(["\n  subscription newMessage($chatId: Int!) {\n    newMessage(chatId: $chatId) {\n      id\n      text\n      userId\n      unread\n      createdAt\n    }\n  }\n"]);return j=function(){return e},e}var O=b()(j()),x=b()(y()),E=b()(v()),I=b()(h()),w=b()(g()),M=b()(m());function k(){var e=Object(p.a)(["\n  query getChatMessages($chatId: Int!, $offset: Int) {\n    messages(chatId: $chatId, offset: $offset) {\n      id\n      text\n      userId\n      unread\n      createdAt\n    }\n  }\n"]);return k=function(){return e},e}function C(){var e=Object(p.a)(["\n  query directLastMessage($chatId: Int!) {\n    directLastMessage(chatId: $chatId) {\n      id\n      text\n      userId\n      createdAt\n    }\n  }\n"]);return C=function(){return e},e}function D(){var e=Object(p.a)(["\n  query currentDirect($userId: Int!) {\n    currentDirect(userId: $userId) {\n      direct {\n        id\n      }\n      recipient {\n        id\n        email\n        avatar\n        online\n        username\n        lastSeen\n        createdAt\n      }\n    }\n  }\n"]);return D=function(){return e},e}function _(){var e=Object(p.a)(["\n  query directs {\n    directs {\n      id\n      user {\n        id\n        email\n        avatar\n        online\n        username\n        lastSeen\n        createdAt\n      }\n      lastMessage {\n        id\n        text\n        userId\n        createdAt\n      }\n      unread\n    }\n  }\n"]);return _=function(){return e},e}function S(){var e=Object(p.a)(["\n  query currentUser {\n    currentUser {\n      id\n      email\n      avatar\n      online\n      username\n      createdAt\n    }\n  }\n"]);return S=function(){return e},e}function T(){var e=Object(p.a)(["\n  query users($username: String) {\n    users(username: $username) {\n      id\n      email\n      avatar\n      online\n      username\n      lastSeen\n      createdAt\n    }\n  }\n"]);return T=function(){return e},e}var $=b()(T()),N=b()(S()),W=b()(_()),U=b()(D()),L=b()(C()),R=b()(k()),A=n(162),z=n(241),Q=n(30),H=n(226),P=n(228),q=n(229),B=n(169),F=n(222),J=n(247),K=n(61),Y=n(221),G=Object(Y.a)((function(e){return{Avatar:{fontSize:e.typography.body1.fontSize,textTransform:"uppercase",color:e.palette.common.white},Avatar_small:{width:30,height:30}}})),V=n(167),X=n.n(V),Z=Object(K.a)((function(e){return{badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(e.palette.background.paper),"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"$ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}}))(F.a),ee=function(e){var t=e.alt,n=void 0===t?"":t,a=e.src,c=e.online,i=Object(B.a)(e,["alt","src","online"]),s=G(),o=n.split(" ").slice(0,2).map((function(e){return e[0]})).join("");return r.a.createElement(Z,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",invisible:!c},r.a.createElement(J.a,{src:a,className:X()(s.Avatar,Object(Q.a)({},s["Avatar_".concat(i.size)],i.size)),style:{background:a}},o))},te=Object(Y.a)((function(e){return{ChatWindow:{height:"100%",maxHeight:"calc(100% - 64px)"},ChatWindow_content:{height:"100%",overflow:"auto",padding:"".concat(e.spacing(3),"px"),"&::-webkit-scrollbar":{width:5,background:"transparent","&-thumb":{background:e.palette.action.selected,borderRadius:3*e.shape.borderRadius,display:"none"}},"&:hover::-webkit-scrollbar-thumb":{display:"block"}},ChatWindow_empty:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},ChatWindow_input_wrapper:{minHeight:64,display:"flex",alignItems:"center",width:"100%","& .MuiInputBase-root":{fontSize:e.typography.body2.fontSize}},ChatWindow_input:{height:"100%",padding:"".concat(e.spacing(1),"px ").concat(e.spacing(1),"px ").concat(e.spacing(.5),"px ").concat(e.spacing(2),"px"),"& .MuiInputBase-inputMultiline":{"&::-webkit-scrollbar":{display:"none"}}}}})),ne=function(e){var t=te(),n=r.a.useRef(null);r.a.useEffect((function(){!function(){var t=n.current,a=t.scrollTop,r=t.scrollHeight,c=t.offsetHeight;e.messages&&e.messages.length<=20?n.current.scrollTop=r:(a+c+300<r||e.send||(n.current.scrollTop=r),e.send&&(n.current.scrollTop=r))}()}),[e.messages]);var a=function(){var t=Object(o.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.current.scrollTop<200)){t.next=4;break}return t.next=3,e.onLoadMoreMessages();case 3:e.hasMore&&(n.current.scrollTop=n.current.scrollTop+10);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return r.a.createElement("div",{className:t.ChatWindow},r.a.createElement("div",{ref:n,onScroll:a,className:t.ChatWindow_content},e.renderMessages(e.messages)))},ae=n(250),re=n(223),ce=n(198),ie=n.n(ce),se=n(26),oe=Object(se.g)((function(e){var t=te(),n=r.a.useRef(),a=r.a.useState(""),c=Object(d.a)(a,2),i=c[0],s=c[1];r.a.useEffect((function(){n.current&&n.current.focus(),s("")}),[e.location]);var o=function(){i.trim().length&&e.onSubmit(i),s("")};return r.a.createElement("div",{className:t.ChatWindow_input_wrapper},r.a.createElement(ae.a,{fullWidth:!0,multiline:!0,rowsMax:12,inputRef:n,value:i,onChange:function(t){e.onChange(),s(t.target.value)},onKeyPress:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),o())},placeholder:"Write a message...",className:t.ChatWindow_input}),r.a.createElement(re.a,{onClick:function(e){return function(){e.current&&e.current.focus(),o()}}(n),disabled:!i.trim().length},r.a.createElement(ie.a,null)))})),ue=n(246),le=Object(Y.a)((function(e){return{StyledChip:{alignSelf:"center",background:e.palette.action.hover,"& .MuiChip-label":{}}}})),de=function(e){var t=le();return r.a.createElement(ue.a,Object.assign({className:t.StyledChip,size:"small"},e))},pe=n(227),fe=n(202),be=n(225),me=function(e){var t=e.anchorEl,n=e.onClose,a=e.onDelete,c=e.onCopy,i=function(e){return function(){e(),n()}};return r.a.createElement(fe.a,{anchorEl:t,open:Boolean(t),onClose:n},r.a.createElement(be.a,{dense:!0,onClick:i(a)},"Delete Message"),r.a.createElement(be.a,{dense:!0,onClick:i(c)},"Copy Text"))},ge=Object(Y.a)((function(e){return{Message:{display:"flex",position:"relative",maxWidth:"70%",padding:"".concat(e.spacing(1),"px ").concat(e.spacing(1.5),"px ").concat(e.spacing(.5),"px"),borderRadius:3*e.shape.borderRadius,"&:before":{position:"absolute",bottom:-1,width:15,height:20,content:"''"},"& p":{alignSelf:"flex-end",wordWrap:"break-word",overflowWrap:"break-word",paddingBottom:e.spacing(2),minWidth:20},"& span":{alignSelf:"flex-end",opacity:.54}},Message_content:{display:"flex",margin:"".concat(e.spacing(1),"px 0")},Message_content_receiver:{justifyContent:"flex-start"},Message_content_sender:{justifyContent:"flex-end"},Message_receiver:{background:"dark"===e.palette.type?e.lighten(e.palette.background.default,.235):e.darken(e.palette.background.default,.057),"&:before":{left:-10,transform:"rotate(-15deg)",borderBottom:"15px solid ".concat("dark"===e.palette.type?e.lighten(e.palette.background.default,.235):e.darken(e.palette.background.default,.057)),borderLeft:"15px solid transparent"}},Message_sender:{background:e.palette.secondary.main,color:e.palette.getContrastText(e.palette.secondary.main),"&:before":{right:-10,transform:"rotate(15deg)",borderBottom:"15px solid ".concat(e.palette.secondary.main),borderRight:"15px solid transparent"}}}})),he=function(e){var t,n,a=ge(),i=r.a.useState(null),s=Object(d.a)(i,2),o=s[0],u=s[1];return r.a.createElement("div",{className:X()(a.Message_content,(t={},Object(Q.a)(t,a.Message_content_sender,e.isOwner),Object(Q.a)(t,a.Message_content_receiver,!e.isOwner),t))},r.a.createElement("div",{onContextMenu:function(e){e.preventDefault(),u(e.currentTarget)},className:X()(a.Message,(n={},Object(Q.a)(n,a.Message_sender,e.isOwner),Object(Q.a)(n,a.Message_receiver,!e.isOwner),n))},r.a.createElement(pe.a,{variant:"body2"},e.text),r.a.createElement(pe.a,{variant:"caption"},Object(c.c)(e.date))),r.a.createElement(me,Object.assign({anchorEl:o,onClose:function(){return u(null)}},e.menuProps,{onCopy:function(){navigator.clipboard.writeText(e.text)}})))},ve=Object(Y.a)((function(e){return{DirectFallback:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}}})),ye=function(){var e=ve();return r.a.createElement("div",{className:e.DirectFallback},r.a.createElement(pe.a,{variant:"body2"},"No messages here yet..."))},je=Object(Y.a)((function(e){return{Typing:{display:"inline-flex",justifyContent:"space-between",alignItems:"center",color:e.palette.text.secondary,"& span":{width:5,height:5,marginRight:4,background:e.palette.text.secondary,borderRadius:"50%","&:nth-child(1)":{animation:"$animation 1s ease-in-out infinite 0s"},"&:nth-child(2)":{animation:"$animation 1s ease-in-out infinite 0.2s"},"&:nth-child(3)":{animation:"$animation 1s ease-in-out infinite 0.4s"}}},Typing_secondary:{color:e.palette.secondary[200],"& span":{background:e.palette.secondary[200]}},"@keyframes animation":{"0%, 100%":{transform:"scale(1)",opacity:1},"50%":{transform:"scale(.8)",opacity:.5}}}})),Oe=function(e){var t=je();return r.a.createElement("span",{className:X()(t.Typing,Object(Q.a)({},t.Typing_secondary,"secondary"===e.variant))},r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null),"typing")},xe=Object(Y.a)((function(e){return{DirectChat:{position:"relative",width:"100%",height:"100%",overflow:"hidden"},DirectChat_header:{minHeight:64,paddingLeft:e.spacing(1),paddingRight:e.spacing(1),display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid ".concat(e.palette.divider)},DirectChat_header_status:{color:e.palette.secondary[200]},DirectChat_content:{height:"100%",maxHeight:"calc(100% - 64px)",overflowY:"scroll",position:"relative","&::-webkit-scrollbar":{display:"none"}},DirectChat_messageWrapper:{display:"flex",flexDirection:"column"}}})),Ee=function(e){var t=xe(),n=Object(c.g)(Object(l.a)(e.messages).reverse()),a=r.a.useState(!1),i=Object(d.a)(a,2),u=i[0],p=i[1],f=function(){var t=Object(o.a)(s.a.mark((function t(n){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return p(!0),t.next=3,e.onCreateMessage(n);case 3:p(!1);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),b=r.a.useCallback((function(a){return a.length?Object(l.a)(a).reverse().map((function(a,i){var s=Object(c.b)(a.createdAt,"days"),o=i===n[s]&&r.a.createElement(de,{label:Object(c.f)(a.createdAt)});return r.a.createElement("div",{key:a.id,className:t.DirectChat_messageWrapper},o,r.a.createElement(he,{text:a.text,date:a.createdAt,isOwner:a.userId===e.user.id,menuProps:{onDelete:e.onDeleteMessage(a.id)}}))})):r.a.createElement(ye,null)}),[e.chatId,e.user.id,e.messages,e.onDeleteMessage]);return r.a.createElement("div",{className:t.DirectChat},r.a.createElement("div",{className:t.DirectChat_header},e.recipient.username&&r.a.createElement(H.a,{dense:!0},r.a.createElement(P.a,{primary:e.recipient.username,primaryTypographyProps:{component:"div"},secondary:e.typingUser?r.a.createElement(Oe,{variant:"secondary"}):e.recipient.online?"online":"last seen at ".concat(Object(c.c)(e.recipient.lastSeen)),secondaryTypographyProps:{variant:"caption",className:X()(Object(Q.a)({},t.DirectChat_header_status,e.recipient.online))}}),r.a.createElement(ee,{src:e.recipient.avatar,alt:e.recipient.username,online:e.recipient.online}))),r.a.createElement("div",{className:t.DirectChat_content},r.a.createElement(ne,{send:u,hasMore:e.hasMore,messages:e.messages,renderMessages:b,onLoadMoreMessages:e.onLoadMoreMessages}),r.a.createElement(q.a,null),r.a.createElement(oe,{onChange:function(){e.chatId&&e.onTyping()},onSubmit:f})))},Ie=n(138),we=n(230),Me=function(e){var t=e.userId,n=r.a.useState({hasMore:!0}),a=Object(d.a)(n,2),c=a[0],i=a[1],p=Object(Ie.c)(N),f=Object(Ie.c)(U,{variables:{userId:t}}),b=Object(Ie.a)(R,{}),m=Object(d.a)(b,2),g=m[0],h=m[1],v=Object(Ie.b)(A.a),y=Object(d.a)(v,1)[0],j=Object(Ie.b)(A.b),w=Object(d.a)(j,1)[0],k=Object(Ie.b)(A.d),C=Object(d.a)(k,1)[0],D=Object(Ie.b)(A.c),_=Object(d.a)(D,1)[0],S=Object(Ie.b)(A.g),T=Object(d.a)(S,1)[0],$=Object(Ie.b)(A.i),W=Object(d.a)($,1)[0],L=Object(z.a)(p,"data.currentUser",{}),Q=Object(z.a)(f,"data.currentDirect.recipient",{}),H=Object(z.a)(f,"data.currentDirect.direct.id"),P=H?Object(z.a)(h,"data.messages"):null,q=function(e,t){var n=r.a.useState(!1),a=Object(d.a)(n,2),c=a[0],i=a[1],l=r.a.useState(""),p=Object(d.a)(l,2),f=p[0],b=p[1],m=Object(we.a)(function(){var e=Object(o.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(!1),e.next=3,t(n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),500),g=Object(d.a)(m,1)[0];return[{user:f,setUser:b},function(){var n=Object(o.a)(s.a.mark((function n(){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i(!0),c){n.next=4;break}return n.next=4,t(e);case 4:g(Object(u.a)({},e,{username:""}));case 5:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}()]}({chatId:H,username:L.username},(function(e){return W({variables:e})})),B=Object(d.a)(q,2),F=B[0],J=B[1];r.a.useEffect((function(){H&&t&&g({variables:{chatId:H}})}),[t,H,g]);r.a.useEffect((function(){var e=function(){try{return h.subscribeToMore({document:O,variables:{chatId:H},updateQuery:function(e,t){var n=t.subscriptionData;return n.data?{messages:[n.data.newMessage].concat(Object(l.a)(e.messages))}:e}})}catch(e){return function(){}}}();return function(){return e()}}),[h.data,H]),r.a.useEffect((function(){var e=function(){try{return f.subscribeToMore({document:I,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.newDirect;return{currentDirect:Object(u.a)({},e.currentDirect,{direct:a})}}})}catch(e){return function(){}}}();return function(){return e()}}),[f]),r.a.useEffect((function(){var e=function(){try{return h.subscribeToMore({document:x,variables:{chatId:H},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.deleteMessage;return{messages:e.messages.filter((function(e){return e.id!==a.id}))}}})}catch(e){return function(){}}}();return function(){return e()}}),[h.data,H]),r.a.useEffect((function(){var e=function(){try{return f.subscribeToMore({document:E,variables:{chatId:H},updateQuery:function(e,t){var n=t.subscriptionData;return n.data&&n.data.deleteDirect.id===H?{currentDirect:Object(u.a)({},e.currentDirect,{direct:null})}:e}})}catch(e){return function(){}}}();return function(){return e()}}),[f,H]),r.a.useEffect((function(){var e=function(){try{return f.subscribeToMore({document:M,variables:{chatId:H},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.userTyping;return F.setUser(a),e}})}catch(e){return function(){}}}();return function(){return e()}}),[f,H]);var K=function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H){e.next=5;break}return e.next=3,y({variables:{text:t,userId:Q.id}});case 3:e.next=9;break;case 5:return e.next=7,w({variables:{text:t,chatId:H}});case 7:return e.next=9,W({variables:{chatId:H,username:""}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(Ee,{user:L,chatId:H,recipient:Q||{},hasMore:c.hasMore,messages:P||[],typingUser:F.user===L.username?"":F.user,onTyping:J,onCreateMessage:K,onDeleteMessage:function(e){return Object(o.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!P||1!==P.length){t.next=5;break}return t.next=3,_({variables:{id:H}});case 3:t.next=7;break;case 5:return t.next=7,C({variables:{id:e}});case 7:case"end":return t.stop()}}),t)})))},onReadMessage:function(e){return T({variables:{id:e}})},onLoadMoreMessages:function(){h.data&&H&&c.hasMore&&h.fetchMore({variables:{chatId:H,offset:P.length},updateQuery:function(e,t){var n=t.fetchMoreResult;return n?(n.messages.length<20&&i({hasMore:!1}),{messages:[].concat(Object(l.a)(e.messages),Object(l.a)(n.messages))}):e}})}})},ke=n(236),Ce=n(235),De=Object(Y.a)((function(e){return{Sidebar:{position:"relative",width:"100%",maxWidth:e.props.sidebar,minWidth:e.props.sidebarMin},Sidebar_main:{position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"dark"===e.palette.type?e.palette.action.selected:e.palette.action.hover,borderRight:"1px solid ".concat(e.palette.divider)},Sidebar_header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"".concat(e.spacing(.5),"px ").concat(e.spacing(3),"px"),minHeight:64},Sidebar_searchbar:{background:e.palette.action.selected,padding:"0 ".concat(e.spacing(1),"px"),fontSize:e.typography.body2.fontSize,minHeight:32,marginLeft:e.spacing(1),borderRadius:e.shape.borderRadius},Sidebar_content:{height:"100%",maxHeight:"calc(100% - 64px)",overflowY:"scroll",position:"relative","&::-webkit-scrollbar":{display:"none"}}}})),_e=n(232),Se=n(224),Te=n(248),$e=n(231),Ne=Object(Y.a)((function(e){return{MenuDrawer:{position:"absolute",width:"95%",height:"100%",zIndex:e.zIndex.tooltip,backgroundImage:"linear-gradient(90deg, ".concat(e.palette.background.default,", ").concat(e.palette.background.paper,")"),borderRight:"1px solid ".concat(e.palette.divider)},MenuDrawer_listItem:{"& p":{width:"100%",marginLeft:e.spacing(2)},"&:last-child p":{color:e.palette.error.dark,marginLeft:0}},MenuDrawer_backdrop:{width:"100%",maxWidth:960,zIndex:1300,left:"auto",right:"auto"}}})),We=($e.a,function(e){var t=e.user,n=void 0===t?{}:t,a=e.open,c=Object(B.a)(e,["user","open"]),i=Ne();return r.a.createElement(r.a.Fragment,null,r.a.createElement(_e.a,{in:a,direction:"right"},r.a.createElement("div",{className:i.MenuDrawer},r.a.createElement(Se.a,null,r.a.createElement(H.a,null,r.a.createElement(ee,{src:n.avatar,alt:n.username,online:n.online})),r.a.createElement(H.a,null,r.a.createElement(P.a,{primary:n.username,secondary:n.email}))),r.a.createElement(Se.a,null,r.a.createElement(H.a,{button:!0,className:i.MenuDrawer_listItem,component:"div",onClick:function(){c.onLogout(),c.onClose()}},r.a.createElement(pe.a,{variant:"body2",align:"center"},"Log Out"))))),r.a.createElement(Te.a,{open:a,onClick:c.onClose,className:i.MenuDrawer_backdrop}))}),Ue=n(233),Le=n(62),Re=Object(Y.a)((function(e){return{UserItem_primary:Object(u.a)({},e.props.classes.ellipsis),UserItem_secondary:Object(u.a)({},e.props.classes.ellipsis,{color:e.palette.secondary[200]})}})),Ae=function(e){var t=Re();return r.a.createElement(H.a,Object.assign({},e,{dense:!0,button:!0,to:e.link,component:Le.b}),r.a.createElement(Ue.a,null,r.a.createElement(ee,{src:e.user.avatar,alt:e.user.username,online:e.user.online})),r.a.createElement(P.a,{primary:e.user.username,primaryTypographyProps:{component:"div",className:t.UserItem_primary},secondary:"@".concat(e.user.username),secondaryTypographyProps:{variant:"caption",component:"div",className:t.UserItem_secondary}}))},ze=Object(Y.a)((function(e){return{ChatItem_badge_root:{height:15},ChatItem_badge_badge:{position:"relative",transform:"none",height:"inherit"},ChatItem_primary:{display:"flex"},ChatItem_secondary:{display:"flex",alignItems:"center"},ChatItem_primaryText:Object(u.a)({width:"100%"},e.props.classes.ellipsis),ChatItem_secondaryText:Object(u.a)({width:"100%",marginRight:e.spacing(1)},e.props.classes.ellipsis)}})),Qe=function(e){var t=e.link,n=e.date,a=e.avatar,i=e.online,s=e.unread,o=e.typing,u=void 0!==o&&o,l=e.selected,d=e.primary,p=e.secondary,f=e.onContextMenu,b=Object(B.a)(e,["link","date","avatar","online","unread","typing","selected","primary","secondary","onContextMenu"]),m=ze();return r.a.createElement(H.a,Object.assign({dense:!0,button:!0,to:t,component:Le.b,selected:l,onContextMenu:f},b),r.a.createElement(Ue.a,null,r.a.createElement(ee,{src:a,alt:d,online:i})),r.a.createElement(P.a,{primary:r.a.createElement(r.a.Fragment,null,r.a.createElement(pe.a,{variant:"body2",className:m.ChatItem_primaryText},d),r.a.createElement(pe.a,{variant:"caption",color:"textSecondary"},Object(c.c)(n))),primaryTypographyProps:{className:m.ChatItem_primary,component:"div"},secondary:r.a.createElement(r.a.Fragment,null,r.a.createElement(pe.a,{variant:"caption",className:m.ChatItem_secondaryText},u?r.a.createElement(Oe,null):p),r.a.createElement(F.a,{max:50,classes:{badge:m.ChatItem_badge_badge,root:m.ChatItem_badge_root},badgeContent:s,color:"secondary"})),secondaryTypographyProps:{className:m.ChatItem_secondary,component:"div"}}))},He=function(e){var t,n=e.anchorEl,a=e.onClose,c=e.onDelete;return r.a.createElement(fe.a,{anchorEl:n,anchorOrigin:{vertical:"top",horizontal:"right"},open:Boolean(n),onClose:a},r.a.createElement(be.a,{dense:!0,onClick:(t=c,function(){t(),a()})},"Delete chat"))},Pe=function(e){r.a.useEffect((function(){var t=e.subscribeToUserTyping(e.direct.id);return function(){return t()}}),[]),r.a.useEffect((function(){var t=e.subscribeToDeleteMessage(e.direct.id);return function(){return t()}}),[]),r.a.useEffect((function(){var t=e.subscribeToNewMessage(e.direct.id);return function(){return t()}}),[]);var t=r.a.useState(null),n=Object(d.a)(t,2),a=n[0],c=n[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe,{link:e.link,typing:e.typing,selected:e.selected,avatar:e.user.avatar,online:e.user.online,unread:e.direct.unread,primary:e.user.username,secondary:e.direct.lastMessage.text,date:e.direct.lastMessage.createdAt,onClick:e.onClick,onContextMenu:function(e){e.preventDefault(),c(e.currentTarget)}}),r.a.createElement(He,{anchorEl:a,onClose:function(){return c(null)},onDelete:function(){e.onDelete(e.direct.id)}}))},qe=n(234),Be=Object(Y.a)((function(e){return{StyledList:{},StyledList_subheader:{background:e.palette.action.selected,lineHeight:"32px",fontSize:e.typography.body2.fontSize}}})),Fe=function(e){var t=Be();return r.a.createElement(Se.a,Object.assign({},e,{subheader:e.subheader?r.a.createElement(qe.a,{component:"div",className:t.StyledList_subheader},e.subheader):null}))},Je=function(e){var t=De(),n=r.a.useState(!1),a=Object(d.a)(n,2),c=a[0],i=a[1],s=r.a.useState(""),o=Object(d.a)(s,2),u=o[0],l=o[1],p=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t?r.a.createElement(Fe,{disablePadding:!0},t.map((function(t){return r.a.createElement(Pe,Object.assign({key:t.id,direct:t,user:t.user,typing:e.typings[t.id]===t.user.username?e.typings[t.id]:"",link:"/me?p=".concat(t.user.id),selected:t.user.id===e.chatId,onDelete:e.onDeleteDirect,subscribeToUserTyping:e.subscribeToUserTyping,subscribeToNewMessage:e.subscribeToNewMessage,subscribeToDeleteMessage:e.subscribeToDeleteMessage},n))}))):null},f=Object(we.a)((function(t){return e.onSearch(t)}),200),b=Object(d.a)(f,1)[0],m=function(){return i(!c)};return r.a.createElement("div",{className:t.Sidebar},r.a.createElement(We,{open:c,user:e.currentUser,onClose:m,onLogout:e.onLogout}),r.a.createElement("div",{className:t.Sidebar_main},r.a.createElement("div",{className:t.Sidebar_header},r.a.createElement(re.a,{edge:"start",color:"inherit",onClick:m},r.a.createElement(Ce.a,null)),r.a.createElement(ae.a,{fullWidth:!0,size:"small",value:u,placeholder:"Search",className:t.Sidebar_searchbar,onChange:function(e){l(e.target.value),b(e.target.value)}})),r.a.createElement("div",{className:t.Sidebar_content},function(){if(u.length){var t=[];e.directs&&e.directs.length&&(t=e.directs.filter((function(e){return e.user.username.startsWith(u)})));var n=t.map((function(e){return e.user.id}));return r.a.createElement(r.a.Fragment,null,p(t,{selected:!1,onClick:function(){return l("")}}),e.users&&e.users.length?r.a.createElement(Fe,{subheader:"Global search",disablePadding:!0},e.users.map((function(e){return!n.includes(e.id)&&r.a.createElement(Ae,{key:e.id,user:e,link:"/me?p=".concat(e.id),onClick:function(){return l("")}})}))):null)}return p(e.directs)}(e.directs))))},Ke=n(77),Ye=n(63),Ge=n(65),Ve=function(e){var t=Object(Ie.c)(N).data,n=Object(Ie.c)(W),a=n.data,i=n.subscribeToMore,l=n.client,p=Object(Ie.a)($),f=Object(d.a)(p,2),b=f[0],m=f[1].data,g=Object(Ie.b)(A.f,{onCompleted:function(){var t=Object(o.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Ge.b.subscriptionClient.client.onclose(),Ke.a.dispatch(Object(Ye.c)()),e.history.push("/login");case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}),h=Object(d.a)(g,1)[0],v=Object(Ie.b)(A.c),y=Object(d.a)(v,1)[0],j=Object(z.a)(t,"currentUser",{}),k=Object(c.e)(e.location).p,C=r.a.useState({}),D=Object(d.a)(C,2),_=D[0],S=D[1];r.a.useEffect((function(){Ge.b.subscriptionClient.tryReconnect()}),[]);r.a.useEffect((function(){var e=i({document:E,updateQuery:function(){var e=Object(o.a)(s.a.mark((function e(t,n){var a,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=n.subscriptionData).data){e.next=3;break}return e.abrupt("return",t);case 3:return r=a.data.deleteDirect,c=t.directs.filter((function(e){return e.id!==r.id})),l.writeQuery({query:W,data:{directs:c}}),e.abrupt("return",{directs:c});case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()});return function(){return e()}}),[]),r.a.useEffect((function(){var e=i({document:I,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.newDirect;return{directs:e.directs.concat(a).sort(c.h)}}});return function(){return e()}}),[]),r.a.useEffect((function(){var e=i({document:w});return function(){return e()}}),[]);return r.a.createElement(Je,{chatId:k,typings:_,directs:Object(z.a)(a,"directs",[]).sort(c.h),users:Object(z.a)(m,"users"),currentUser:j,onLogout:h,onSearch:function(e){return b({variables:{username:e}})},onDeleteDirect:function(e){y({variables:{id:e}})},subscribeToNewMessage:function(e){return i({document:O,variables:{chatId:e},updateQuery:function(t,n){var a=n.subscriptionData;if(!a.data)return t;var r=a.data.newMessage,i=r.userId!==j.id?1:0;return{directs:t.directs.map((function(t){return t.id===e&&(t=Object(u.a)({},t,{lastMessage:r,unread:t.unread+i})),t})).sort(c.h)}}})},subscribeToDeleteMessage:function(e){return i({document:x,variables:{chatId:e},updateQuery:function(){var t=Object(o.a)(s.a.mark((function t(n,a){var r,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=a.subscriptionData).data){t.next=3;break}return t.abrupt("return",n);case 3:return c=r.data.deleteMessage,t.next=6,l.query({query:L,variables:{chatId:e},fetchPolicy:"no-cache"}).then((function(e){var t=e.data,a=n.directs.map((function(e){var n=c.userId!==j.id?1:0;return e.lastMessage.id===c.id&&(e=Object(u.a)({},e,{lastMessage:t.directLastMessage,unread:e.unread-n})),e}));return l.writeQuery({query:W,data:{directs:a}}),{directs:a}}));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()})},subscribeToUserTyping:function(e){return i({document:M,variables:{chatId:e},updateQuery:function(t,n){var a=n.subscriptionData;if(!a.data)return t;var r=a.data.userTyping;return S(Object(u.a)({},_,Object(Q.a)({},e,r))),t}})}})},Xe=Object(Y.a)((function(e){return{container:{display:"flex",overflow:"hidden",padding:0,minHeight:"100vh",maxHeight:"100vh"},contentShift:{width:"100%",background:e.palette.background.paper,minWidth:e.props.sidebarMin}}})),Ze=Object(se.g)((function(e){var t=e.children,n=Object(B.a)(e,["children"]),a=Xe();return r.a.createElement(ke.a,{maxWidth:"md",className:a.container},r.a.createElement(Ve,n),r.a.createElement("div",{className:a.contentShift},t))}));t.default=function(e){var t=Object(c.e)(e.location).p;return r.a.createElement(Ze,null,t?r.a.createElement(Me,{userId:t}):null)}}}]);
//# sourceMappingURL=7.c2902e63.chunk.js.map