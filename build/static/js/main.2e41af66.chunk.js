(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[3],{113:function(e,t,n){e.exports=n(144)},144:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(23),c=n(19),i=n(16),u=n(40),s=n(106),l=n(92),d=n(12),m=n(105),p=n(94),h=n(3),f=new s.a({uri:"http://localhost:8081/graphql"}),g=new l.a({uri:"ws://localhost:8081/graphql",options:{reconnect:!0,connectionParams:function(){return{headers:{"x-token":localStorage.getItem("token"),"x-refresh-token":localStorage.getItem("refreshToken")}}}}}),b=new d.a((function(e,t){return t(e).map((function(t){var n=e.getContext().response.headers,a=n.get("x-token"),r=n.get("x-refresh-token");return a&&r&&(localStorage.setItem("token",a),localStorage.setItem("refreshToken",r)),t}))})),v=new d.a((function(e,t){return e.setContext((function(e){var t=e.headers;return{headers:Object(i.a)({},t,{"x-token":localStorage.getItem("token"),"x-refresh-token":localStorage.getItem("refreshToken")})}})),t(e)})),y=Object(p.a)((function(e){var t=e.graphQLErrors,n=e.networkError;t&&t.forEach((function(e){var t=e.message,n=e.locations,a=e.path,r=e.extensions;console.log("[GraphQL error]: \n          Message: ".concat(t,", \n          Location: ").concat(n,", \n          Path: ").concat(a)),"UNAUTHENTICATED"===r.code&&console.log(r.code,"UNAUTHENTICATED"===r.code)})),n&&console.log("[Network error]: ".concat(n))})).concat(b.concat(v.concat(f))),k=Object(d.d)((function(e){var t=e.query,n=Object(h.l)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),g,y),O=new u.a({link:k,cache:new m.a}),E=n(183),I=n(104),j=n(63),w=n(64),x=n(74),S=window.matchMedia("(prefers-color-scheme: dark)").matches,T=Object(I.a)({palette:{type:S?"dark":"light",primary:j.a,secondary:w.a},props:{sidebar:280,sidebarMin:150,classes:{ellipsis:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}}},lighten:x.lighten,darken:x.darken});console.log("customTheme",T);var _=n(45),M=n(35),N=n(95),C=n(96),A=n(28),$={isAuthorized:!!localStorage.getItem("token"),chatId:null,text:""},L=Object(M.combineReducers)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case A.a.auth.LOGIN:return localStorage.setItem("token",a.token),localStorage.setItem("refreshToken",a.refreshToken),Object(i.a)({},e,{isAuthorized:!0});case A.a.auth.LOGOUT:return localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),Object(i.a)({},e,{isAuthorized:!1});case A.a.auth.TYPE_MESSAGE:return Object(i.a)({},e,{text:a});case A.a.auth.CHAT_ID:return Object(i.a)({},e,{chatId:a});default:return Object(i.a)({},e)}}}),z=[N.a],D=Object(M.createStore)(L,{},Object(C.composeWithDevTools)(M.applyMiddleware.apply(void 0,z))),U=n(39),B=n(30),G=n(182),P=n(97),W=n.n(P),H=n(5),R=n(181),q=n(164),Y=n(29),F=n(69),J=n(32),Q=n(46),K=n(79),V=n(67),X=n(167),Z=n(168),ee=n(169),te=n(66),ne=n(170),ae=n(48),re=Object(q.a)((function(e){return{ChatItem_badge:{height:15,"& .MuiBadge-badge":{position:"relative",transform:"none",height:"inherit"}},ChatItem_primary:{display:"flex"},ChatItem_secondary:{display:"flex",alignItems:"center"},ChatItem_primaryText:Object(i.a)({width:"100%"},e.props.classes.ellipsis),ChatItem_secondaryText:Object(i.a)({width:"100%",marginRight:e.spacing(1)},e.props.classes.ellipsis)}})),oe=function(e){var t=e.link,n=e.selected,a=e.avatar,o=e.name,c=e.updatedAt,i=e.lastMessage,u=e.unread,s=Object(H.a)(e,["link","selected","avatar","name","updatedAt","lastMessage","unread"]),l=re();return r.a.createElement(X.a,Object.assign({dense:!0,button:!0,disableRipple:!0,to:t,component:B.b,selected:n},s),r.a.createElement(Z.a,null,r.a.createElement(ae.a,{src:a,alt:o})),r.a.createElement(ee.a,{primary:r.a.createElement(r.a.Fragment,null,r.a.createElement(te.a,{variant:"body2",className:l.ChatItem_primaryText},o),r.a.createElement(te.a,{variant:"caption",color:"textSecondary"},c)),primaryTypographyProps:{className:l.ChatItem_primary,component:"div"},secondary:r.a.createElement(r.a.Fragment,null,r.a.createElement(te.a,{variant:"caption",className:l.ChatItem_secondaryText},i),r.a.createElement(ne.a,{className:l.ChatItem_badge,badgeContent:u,color:"secondary"})),secondaryTypographyProps:{className:l.ChatItem_secondary,component:"div"}}))},ce=Object(q.a)((function(e){return{UserItem_primary:Object(i.a)({},e.props.classes.ellipsis),UserItem_secondary:Object(i.a)({},e.props.classes.ellipsis,{color:e.palette.secondary[200]})}})),ie=function(e){var t=ce();return r.a.createElement(X.a,{dense:!0,button:!0,to:e.link,component:B.b},r.a.createElement(Z.a,null,r.a.createElement(ae.a,{src:e.avatar,alt:e.name})),r.a.createElement(ee.a,{primary:e.name,primaryTypographyProps:{component:"div",className:t.UserItem_primary},secondary:"@".concat(e.username),secondaryTypographyProps:{variant:"caption",component:"div",className:t.UserItem_secondary}}))},ue=n(179),se=n(186),le=n(180),de=n(178),me=n(89),pe=n(175),he=n(176),fe=n(177),ge=n(172),be=n(173),ve=n(174),ye=Object(q.a)((function(e){return{MenuDrawer:{position:"absolute",width:"95%",height:"100%",zIndex:e.zIndex.tooltip,background:e.palette.background.paper,borderRight:"1px solid ".concat(e.palette.divider)},MenuDrawer_listItem:{"& p":{width:"100%",marginLeft:e.spacing(2)},"&:last-child p":{color:e.palette.error.dark,fontSize:e.typography.body1.fontSize,fontWeight:e.typography.fontWeightBold,marginLeft:0}},MenuDrawer_backdrop:{width:"100%",zIndex:1300,maxWidth:960,left:"auto",right:"auto"}}})),ke=n(184),Oe=[{title:"New Group",link:"/create_team",action:function(e){return e.onToggle},icon:r.a.createElement(ge.a,null)},{title:"New Channel",link:"/create_channel",action:function(e){return e.onToggle},icon:r.a.createElement(be.a,null)},{title:"Settings",link:"/settings",action:function(e){return e.onToggle},icon:r.a.createElement(ve.a,null)},{title:"Log Out",action:function(e){return e.onLogout}}],Ee=function(e){var t=e.open,n=Object(H.a)(e,["open"]),a=ye(),o=Object(J.c)(Q.e),c=Object(ke.a)(o,"data.user",{});return r.a.createElement(r.a.Fragment,null,r.a.createElement(pe.a,{in:t,direction:"right"},r.a.createElement("div",{className:a.MenuDrawer},r.a.createElement(he.a,null,r.a.createElement(X.a,null,r.a.createElement(ae.a,{src:c.avatar,alt:c.username})),r.a.createElement(X.a,null,r.a.createElement(ee.a,{primary:c.username,secondary:c.email}))),r.a.createElement(he.a,null,Oe.map((function(e){var t=e.title,o=e.link,c=e.action,i=e.icon;return r.a.createElement(X.a,{key:t,button:!0,to:o,className:a.MenuDrawer_listItem,component:o?B.b:"div",onClick:c?c(n):void 0},i,r.a.createElement(te.a,{variant:"body2",align:i?"left":"center"},t))}))))),r.a.createElement(fe.a,{open:t,onClick:n.onToggle,className:a.MenuDrawer_backdrop}))},Ie=Object(q.a)((function(e){return{Sidebar:{position:"relative",width:"100%",maxWidth:e.props.sidebar,minWidth:e.props.sidebarMin},Sidebar_header:{display:"flex",alignItems:"center",justifyContent:"space-between"},Sidebar_menuButton:{marginRight:e.spacing(1)},Sidebar_searchbar:{background:"dark"===e.palette.type?e.lighten(e.palette.background.default,.235):e.darken(e.palette.background.default,.057),padding:"0 ".concat(e.spacing(1),"px"),fontSize:e.typography.body2.fontSize,boxSizing:"border-box",borderRadius:e.shape.borderRadius}}})),je=r.a.memo((function(e){var t=e.onSearch,n=e.onLogout,a=e.renderChats,o=e.chatId,c=Ie(),i=r.a.useState(!1),u=Object(Y.a)(i,2),s=u[0],l=u[1],d=r.a.useState(""),m=Object(Y.a)(d,2),p=m[0],h=m[1];r.a.useEffect((function(){return h(""),function(){return h("")}}),[o]);var f=Object(de.a)((function(e){return t(e)}),200),g=Object(Y.a)(f,1)[0],b=function(){return l(!s)};return r.a.createElement("div",{className:c.Sidebar},r.a.createElement(Ee,{open:s,onToggle:b,onLogout:n}),r.a.createElement(me.a,{header:r.a.createElement("div",{className:c.Sidebar_header},r.a.createElement(ue.a,{edge:"start",color:"inherit",className:c.Sidebar_menuButton,onClick:b},r.a.createElement(le.a,null)),r.a.createElement(se.a,{size:"small",placeholder:"Search",className:c.Sidebar_searchbar,onChange:function(e){h(e.target.value),g(e.target.value)}}))},a(p)))})),we=r.a.memo(Object(_.b)(null,{dispatchChatId:F.a,dispatchLogout:F.c})((function(e){var t=Object(J.a)(Q.f),n=Object(Y.a)(t,2),a=n[0],o=n[1],c=Object(J.c)(Q.c),i=Object(J.c)(Q.e),u=Object(J.b)(K.f,{onCompleted:function(){d.resetStore(),e.dispatchLogout()}}),s=Object(Y.a)(u,2),l=s[0],d=s[1].client,m=Object(V.b)(e.location).p;console.log("sib");var p=r.a.useCallback((function(){var t=c.data;return t?i.loading?null:t.directs.map((function(t){var n=t.id,a=t.user,o=t.lastMessage,c=t.unread;return r.a.createElement(oe,{key:n,unread:c,name:a.username,avatar:a.avatar,link:"/?p=".concat(a.id),lastMessage:o.text,updatedAt:Object(V.a)(o.createdAt),selected:a.id===m,onClick:function(){return e.dispatchChatId(n)}})})):null}),[c,e.location]);return r.a.createElement(je,{chatId:m,renderChats:function(e){return e.length?function(){var e=o.data;return e?e.users.map((function(e){var t=e.id,n=e.username,a=e.avatar;return r.a.createElement(ie,{key:n,userId:t,name:n,avatar:a,username:n,link:"/?p=".concat(t)})})):null}():p()},onSearch:function(e){return a({variables:{username:e}})},onLogout:l})}))),xe=Object(q.a)((function(e){return{container:{display:"flex",overflow:"hidden",padding:0,maxHeight:"100vh"},contentShift:{width:"100%",minWidth:e.props.sidebarMin}}})),Se=Object(U.g)((function(e){var t=e.children,n=Object(H.a)(e,["children"]),a=xe();return r.a.createElement(R.a,{maxWidth:"md",className:a.container},r.a.createElement(we,n),r.a.createElement("div",{className:a.contentShift},t))})),Te=function(e){return W()({loader:e,loading:function(e){return e.error?console.error(e.error):null}})},_e=[{path:"/",exact:!1,component:Te((function(){return Promise.all([n.e(0),n.e(6)]).then(n.bind(null,225))}))},{path:"/create_team",exact:!0,component:Te((function(){return Promise.all([n.e(0),n.e(1),n.e(7)]).then(n.bind(null,227))}))},{path:"/verify",exact:!0,component:Te((function(){return n.e(2).then(n.bind(null,222))}))}],Me=[{path:"/(|registration)",exact:!0,component:Te((function(){return Promise.all([n.e(0),n.e(1),n.e(8)]).then(n.bind(null,223))}))},{path:"/verify",exact:!0,component:Te((function(){return n.e(2).then(n.bind(null,222))}))},{path:"*",component:U.a}],Ne=Object(_.b)((function(e){return{isAuthorized:e.auth.isAuthorized}}))((function(e){return r.a.createElement(B.a,null,r.a.createElement(G.a,null),e.isAuthorized?r.a.createElement(Se,null,_e.map((function(e){return r.a.createElement(U.b,Object.assign({key:e.path},e))}))):r.a.createElement(U.d,null,Me.map((function(e){return r.a.createElement(U.b,Object.assign({key:e.path},e))}))))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));Object(o.render)(r.a.createElement(c.a,{client:O},r.a.createElement(_.a,{store:D},r.a.createElement(E.a,{theme:T},r.a.createElement(Ne,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},28:function(e,t,n){"use strict";t.a={auth:{LOGIN:"LOGIN",LOGOUT:"LOGOUT",TYPE_MESSAGE:"TYPE_MESSAGE",CHAT_ID:"CHAT_ID"}}},46:function(e,t,n){"use strict";n.d(t,"f",(function(){return m})),n.d(t,"e",(function(){return p})),n.d(t,"c",(function(){return h})),n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return g})),n.d(t,"d",(function(){return b}));var a=n(20),r=n(21),o=n.n(r);function c(){var e=Object(a.a)(["\n  subscription($chatId: Int!) {\n    newMessage(chatId: $chatId) {\n      id\n      text\n      user {\n        id\n      }\n      createdAt\n    }\n  }\n"]);return c=function(){return e},e}function i(){var e=Object(a.a)(["\n  query deleteMessage($messageId: Int!) {\n    deleteMessage(messageId: $messageId)\n  }\n"]);return i=function(){return e},e}function u(){var e=Object(a.a)(["\n  query direct($userId: Int!) {\n    direct(userId: $userId) {\n      direct {\n        id\n        messages {\n          id\n          text\n          user {\n            id\n          }\n          createdAt\n        }\n      }\n      recipient {\n        id\n        email\n        avatar\n        username\n        createdAt\n      }\n    }\n  }\n"]);return u=function(){return e},e}function s(){var e=Object(a.a)(["\n  {\n    directs {\n      id\n      user {\n        id\n        email\n        avatar\n        username\n        createdAt\n      }\n      lastMessage {\n        id\n        text\n        user {\n          id\n        }\n        createdAt\n      }\n      unread\n    }\n  }\n"]);return s=function(){return e},e}function l(){var e=Object(a.a)(["\n  {\n    user {\n      id\n      email\n      avatar\n      username\n      createdAt\n    }\n  }\n"]);return l=function(){return e},e}function d(){var e=Object(a.a)(["\n  query users($username: String) {\n    users(username: $username) {\n      id\n      email\n      avatar\n      username\n      createdAt\n    }\n  }\n"]);return d=function(){return e},e}var m=o()(d()),p=o()(l()),h=o()(s()),f=o()(u()),g=o()(i()),b=o()(c())},48:function(e,t,n){"use strict";var a=n(0),r=n.n(a),o=n(185),c=n(164),i=Object(c.a)((function(e){return{Avatar:{fontSize:e.typography.body1.fontSize,textTransform:"uppercase",color:e.palette.common.white}}}));t.a=function(e){var t=e.alt,n=void 0===t?"":t,a=e.src,c=i(),u=n.split(" ").map((function(e){return e[0]})).slice(0,2).join("");return r.a.createElement(o.a,{src:a,className:c.Avatar,style:{background:a}},u)}},67:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return u}));n(29),n(16);var a=n(65),r=n.n(a),o=(n(0),n(100)),c=n.n(o),i=function(e){return r.a.parse(e.search,{arrayFormat:"comma",skipNull:!0,parseNumbers:!0})},u=function(e){return c()(+e).format("DD.MM.YY")}},69:function(e,t,n){"use strict";var a=n(28),r=function(e){return{type:a.a.auth.LOGIN,payload:e}},o=function(){return{type:a.a.auth.LOGOUT}},c=function(e){return{type:a.a.auth.CHAT_ID,payload:e}};n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return c}))},79:function(e,t,n){"use strict";n.d(t,"d",(function(){return p})),n.d(t,"e",(function(){return h})),n.d(t,"g",(function(){return f})),n.d(t,"c",(function(){return g})),n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return v})),n.d(t,"f",(function(){return y}));var a=n(20),r=n(21),o=n.n(r);function c(){var e=Object(a.a)(["\n  mutation {\n    logout\n  }\n"]);return c=function(){return e},e}function i(){var e=Object(a.a)(["\n  mutation($chatId: Int, $text: String!) {\n    createMessage(chatId: $chatId, text: $text)\n  }\n"]);return i=function(){return e},e}function u(){var e=Object(a.a)(["\n  mutation($userId: Int!, $text: String!) {\n    createDirect(userId: $userId, text: $text) {\n      id\n      user {\n        id\n        email\n        avatar\n        username\n        createdAt\n      }\n    }\n  }\n"]);return u=function(){return e},e}function s(){var e=Object(a.a)(["\n  mutation($name: String!) {\n    createTeam(name: $name)\n  }\n"]);return s=function(){return e},e}function l(){var e=Object(a.a)(["\n  mutation($secret: String!) {\n    verifyUser(secret: $secret) {\n      token\n      refreshToken\n    }\n  }\n"]);return l=function(){return e},e}function d(){var e=Object(a.a)(["\n  mutation($username: String!, $password: String!) {\n    login(username: $username, password: $password) {\n      token\n      refreshToken\n    }\n  }\n"]);return d=function(){return e},e}function m(){var e=Object(a.a)(["\n  mutation($username: String!, $email: String!, $password: String!) {\n    createUser(username: $username, email: $email, password: $password)\n  }\n"]);return m=function(){return e},e}var p=o()(m()),h=o()(d()),f=o()(l()),g=o()(s()),b=o()(u()),v=o()(i()),y=o()(c())},89:function(e,t,n){"use strict";var a=n(0),r=n.n(a),o=n(171),c=n(164),i=Object(c.a)((function(e){return{MainBlock:{position:"relative",width:"100%",height:"100vh",overflow:"hidden",background:e.palette.background.paper,borderRight:"1px solid ".concat(e.palette.divider)},MainBlock_header:{background:e.palette.background.paper,borderBottom:"1px solid ".concat(e.palette.divider),color:e.palette.text.primary},MainBlock_content:{height:"100%",maxHeight:"calc(100% - 64px)",overflowY:"scroll",position:"relative","&::-webkit-scrollbar":{display:"none"}}}}));t.a=r.a.memo((function(e){var t=e.header,n=e.children,a=e.show,c=void 0===a||a,u=i();return r.a.createElement("div",{className:u.MainBlock},c&&r.a.createElement(r.a.Fragment,null,r.a.createElement(o.a,{className:u.MainBlock_header},t),r.a.createElement("div",{className:u.MainBlock_content},n)))}))}},[[113,4,5]]]);
//# sourceMappingURL=main.2e41af66.chunk.js.map