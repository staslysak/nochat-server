(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[1],{133:function(n,e,t){"use strict";t.r(e);var r=t(1),a=t.n(r),c=t(64),u=t(13),o=t(70),i=t(154),s=t(157),f=t(73),d=t(92),l=t(155),m=t(50),g=t(51),v=t(60),h=t(16),b=t(87),p=window.matchMedia("(prefers-color-scheme: dark)").matches,O=Object(d.a)({palette:{type:p?"dark":"light",primary:m.a,secondary:g.a},props:{sidebar:280,sidebarMin:150,classes:{ellipsis:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}}},lighten:v.lighten,darken:v.darken}),k=Object(h.b)({plugins:[Object(b.a)()].concat(Object(f.a)(Object(l.a)().plugins))}),I=t(69),j=t(26),y=t(66),$=t(153),w=t(24),T=t(81),E=function(n){var e=n.component,t=Object(I.a)(n,["component"]);return a.a.createElement(j.b,Object.assign({},t,{render:function(n){return Object(w.e)()?a.a.createElement(e,n):a.a.createElement(j.a,{to:"/login"})}}))},x=[{path:"/me",exact:!1,component:Object(r.lazy)((function(){return Promise.all([t.e(0),t.e(4),t.e(7)]).then(t.bind(null,226))}))}],M=[{path:"/(login|registration)",exact:!0,component:Object(r.lazy)((function(){return Promise.all([t.e(0),t.e(5),t.e(8)]).then(t.bind(null,222))}))},{path:"/verify",exact:!0,component:Object(r.lazy)((function(){return t.e(6).then(t.bind(null,225))}))}],S=function(){return a.a.createElement(r.Suspense,{fallback:a.a.createElement(T.b,null)},a.a.createElement($.a,null),a.a.createElement(y.a,null,a.a.createElement(j.d,null,x.map((function(n){return a.a.createElement(E,Object.assign({key:n.path},n))})),M.map((function(n){return a.a.createElement(j.b,Object.assign({key:n.path},n))})),a.a.createElement(j.b,{path:"*",render:function(){return a.a.createElement(j.a,{to:Object(w.e)()?"/me":"/login"})}}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));Object(c.render)(a.a.createElement(u.a,{client:o.a},a.a.createElement(i.a,{theme:O},a.a.createElement(s.b,{jss:k},a.a.createElement(S,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(n){n.unregister()})).catch((function(n){console.error(n.message)}))},24:function(n,e,t){"use strict";t.d(e,"c",(function(){return s})),t.d(e,"a",(function(){return f})),t.d(e,"f",(function(){return d})),t.d(e,"e",(function(){return l})),t.d(e,"i",(function(){return m})),t.d(e,"b",(function(){return g})),t.d(e,"d",(function(){return v})),t.d(e,"g",(function(){return h})),t.d(e,"h",(function(){return b}));t(32);var r=t(49),a=t.n(r),c=t(57),u=t.n(c),o=t(58),i=t.n(o),s=function(n){console.log(n)},f={get:function(n){return n?localStorage.getItem(n):{accessToken:localStorage.getItem("accessToken"),refreshToken:localStorage.getItem("refreshToken")}},set:function(n){localStorage.setItem("accessToken",n.accessToken),localStorage.setItem("refreshToken",n.refreshToken)},remove:function(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}},d=function(n){return a.a.parse(n.search,{arrayFormat:"comma",skipNull:!0,parseNumbers:!0})},l=function(){var n=f.get(),e=n.accessToken,t=n.refreshToken;if(!e||!t)return!1;try{i()(e);var r=i()(t).exp;if(Date.now()/1e3>r)return!1}catch(a){return!1}return!0},m=function(n,e){return e.lastMessage.createdAt-n.lastMessage.createdAt},g=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"days";return u()().diff(+n,e)},v=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"HH:mm";if(n)return u()(+n).format(e)},h=function(n){switch(g(+n)){case 0:return"Today";case 1:return"Yesterday";default:return v(n,"MMMM D")}},b=function(n){var e={};return n.length&&n.forEach((function(n,t){var r=n.createdAt,a=g(r,"days");void 0===e[a]&&(e[a]=t)})),e}},67:function(n,e,t){"use strict";t.d(e,"u",(function(){return U})),t.d(e,"r",(function(){return A})),t.d(e,"x",(function(){return z})),t.d(e,"s",(function(){return _})),t.d(e,"h",(function(){return B})),t.d(e,"j",(function(){return J})),t.d(e,"n",(function(){return Q})),t.d(e,"c",(function(){return V})),t.d(e,"p",(function(){return W})),t.d(e,"l",(function(){return Y})),t.d(e,"b",(function(){return X})),t.d(e,"a",(function(){return Z})),t.d(e,"k",(function(){return en})),t.d(e,"o",(function(){return rn})),t.d(e,"t",(function(){return cn})),t.d(e,"d",(function(){return un})),t.d(e,"q",(function(){return on})),t.d(e,"e",(function(){return sn})),t.d(e,"f",(function(){return fn})),t.d(e,"v",(function(){return ln})),t.d(e,"w",(function(){return gn})),t.d(e,"m",(function(){return hn})),t.d(e,"g",(function(){return bn})),t.d(e,"i",(function(){return pn}));var r,a=t(9),c=t(10),u=t.n(c),o=(t(1),t(11),t(7));function i(){var n=Object(a.a)(["\n    subscription typingUser($chatId: Int!) {\n  typingUser(chatId: $chatId)\n}\n    "]);return i=function(){return n},n}function s(){var n=Object(a.a)(["\n    subscription onlineUser {\n  onlineUser {\n    id\n    online\n    lastSeen\n  }\n}\n    "]);return s=function(){return n},n}function f(){var n=Object(a.a)(["\n    query currentUser {\n  currentUser {\n    ...userFragment\n  }\n}\n    ",""]);return f=function(){return n},n}function d(){var n=Object(a.a)(["\n    query users($username: String) {\n  users(username: $username) {\n    ...userFragment\n  }\n}\n    ",""]);return d=function(){return n},n}function l(){var n=Object(a.a)(["\n    mutation typeMessage($chatId: Int!, $username: String) {\n  typeMessage(chatId: $chatId, username: $username)\n}\n    "]);return l=function(){return n},n}function m(){var n=Object(a.a)(["\n    subscription messageDeleted($chatIds: [Int]) {\n  messageDeleted(chatIds: $chatIds) {\n    ids\n    chat {\n      id\n      lastMessage {\n        ...messageFragment\n      }\n      user {\n        ...userFragment\n      }\n      unread\n    }\n  }\n}\n    ","\n",""]);return m=function(){return n},n}function g(){var n=Object(a.a)(["\n    subscription messageCreated($chatIds: [Int]) {\n  messageCreated(chatIds: $chatIds) {\n    ...messageFragment\n  }\n}\n    ",""]);return g=function(){return n},n}function v(){var n=Object(a.a)(["\n    query getMessages($chatId: Int!, $offset: Int) {\n  messages(chatId: $chatId, offset: $offset) {\n    ...messageFragment\n  }\n}\n    ",""]);return v=function(){return n},n}function h(){var n=Object(a.a)(["\n    mutation readMessage($id: Int!) {\n  readMessage(id: $id)\n}\n    "]);return h=function(){return n},n}function b(){var n=Object(a.a)(["\n    mutation deleteMessage($id: Int!) {\n  deleteMessage(id: $id)\n}\n    "]);return b=function(){return n},n}function p(){var n=Object(a.a)(["\n    mutation createMessage($chatId: Int, $text: String!) {\n  createMessage(chatId: $chatId, text: $text)\n}\n    "]);return p=function(){return n},n}function O(){var n=Object(a.a)(["\n    subscription directCreated {\n  direct: directCreated {\n    id\n    user {\n      ...userFragment\n    }\n    lastMessage {\n      ...messageFragment\n    }\n    unread\n  }\n}\n    ","\n",""]);return O=function(){return n},n}function k(){var n=Object(a.a)(["\n    subscription directDeleted {\n  direct: directDeleted {\n    id\n  }\n}\n    "]);return k=function(){return n},n}function I(){var n=Object(a.a)(["\n    query currentDirect($userId: Int!) {\n  currentDirect(userId: $userId) {\n    direct {\n      id\n      user {\n        ...userFragment\n      }\n      lastMessage {\n        ...messageFragment\n      }\n      unread\n    }\n    recipient {\n      ...userFragment\n    }\n  }\n}\n    ","\n",""]);return I=function(){return n},n}function j(){var n=Object(a.a)(["\n    query direct($id: Int!) {\n  direct(id: $id) {\n    id\n    user {\n      ...userFragment\n    }\n    lastMessage {\n      ...messageFragment\n    }\n    unread\n  }\n}\n    ","\n",""]);return j=function(){return n},n}function y(){var n=Object(a.a)(["\n    query directs {\n  directs {\n    id\n    user {\n      ...userFragment\n    }\n    lastMessage {\n      ...messageFragment\n    }\n    unread\n  }\n}\n    ","\n",""]);return y=function(){return n},n}function $(){var n=Object(a.a)(["\n    mutation deleteDirect($id: Int!) {\n  deleteDirect(id: $id)\n}\n    "]);return $=function(){return n},n}function w(){var n=Object(a.a)(["\n    mutation createDirect($userId: Int!, $text: String) {\n  createDirect(userId: $userId, text: $text) {\n    id\n    user {\n      ...userFragment\n    }\n    lastMessage {\n      ...messageFragment\n    }\n    unread\n  }\n}\n    ","\n",""]);return w=function(){return n},n}function T(){var n=Object(a.a)(["\n    query refreshTokens($refreshToken: String!) {\n  tokens: refreshTokens(refreshToken: $refreshToken) {\n    accessToken\n    refreshToken\n  }\n}\n    "]);return T=function(){return n},n}function E(){var n=Object(a.a)(["\n    mutation logout {\n  logout\n}\n    "]);return E=function(){return n},n}function x(){var n=Object(a.a)(["\n    mutation verifyUser($secret: String!) {\n  tokens: verifyUser(secret: $secret) {\n    accessToken\n    refreshToken\n  }\n}\n    "]);return x=function(){return n},n}function M(){var n=Object(a.a)(["\n    mutation login($username: String!, $password: String!) {\n  login(username: $username, password: $password) {\n    accessToken\n    refreshToken\n  }\n}\n    "]);return M=function(){return n},n}function S(){var n=Object(a.a)(["\n    mutation register($username: String!, $email: String!, $password: String!) {\n  register(username: $username, email: $email, password: $password)\n}\n    "]);return S=function(){return n},n}function F(){var n=Object(a.a)(["\n    fragment userFragment on User {\n  id\n  email\n  avatar\n  online\n  username\n  lastSeen\n  createdAt\n}\n    "]);return F=function(){return n},n}function q(){var n=Object(a.a)(["\n    fragment messageFragment on Message {\n  id\n  text\n  userId\n  chatId\n  unread\n  createdAt\n}\n    "]);return q=function(){return n},n}!function(n){n.Public="PUBLIC",n.Private="PRIVATE"}(r||(r={}));var D=u()(q()),C=u()(F()),N=u()(S());function U(n){return o.b(N,n)}var R=u()(M());function A(n){return o.b(R,n)}var P=u()(x());function z(n){return o.b(P,n)}var L=u()(E());function _(n){return o.b(L,n)}var B=u()(T());var H=u()(w(),C,D);function J(n){return o.b(H,n)}var K=u()($());function Q(n){return o.b(K,n)}var V=u()(y(),C,D);function W(n){return o.c(V,n)}u()(j(),C,D);var G=u()(I(),C,D);function Y(n){return o.c(G,n)}var X=u()(k());var Z=u()(O(),C,D);var nn=u()(p());function en(n){return o.b(nn,n)}var tn=u()(b());function rn(n){return o.b(tn,n)}var an=u()(h());function cn(n){return o.b(an,n)}var un=u()(v(),D);function on(n){return o.c(un,n)}var sn=u()(g(),D);var fn=u()(m(),D,C);var dn=u()(l());function ln(n){return o.b(dn,n)}var mn=u()(d(),C);function gn(n){return o.a(mn,n)}var vn=u()(f(),C);function hn(n){return o.c(vn,n)}var bn=u()(s());var pn=u()(i())},70:function(n,e,t){"use strict";t.d(e,"b",(function(){return p})),t.d(e,"a",(function(){return $}));var r=t(32),a=t(28),c=t.n(a),u=t(38),o=t(27),i=t(94),s=t(85),f=t(14),d=t(93),l=t(86),m=t(2),g=t(24),v=t(67),h=function(){var n=Object(u.a)(c.a.mark((function n(){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,$.query({query:v.h,fetchPolicy:"no-cache",variables:{refreshToken:g.a.get("refreshToken")}}).then((function(n){var e=n.data;return g.a.set(e.tokens),e.tokens}));case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),b=new i.a({uri:"".concat("http://localhost:8081","/graphql")}),p=new s.a({uri:"".concat("ws://localhost:8081","/graphql"),options:{reconnect:!0,connectionParams:function(){return{authorization:g.a.get("accessToken")}},connectionCallback:function(){console.log("CONNECTION_TOKEN",g.a.get("accessToken"))}}}),O=function(){var n=Object(u.a)(c.a.mark((function n(e,t){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,h().then((function(n){var a=n.accessToken;console.log("ACCESS_TOKEN",a),e.setContext((function(n){var e=n.headers,t=void 0===e?{}:e;return{headers:Object(r.a)({},t,{authorization:a})}})),p.subscriptionClient.tryReconnect(),t(e).subscribe({next:function(n){var t=n.data,r=e.query,a=e.variables;(null===t||void 0===t?void 0:t.directs)&&$.query({query:r,variables:a,data:t}),(null===t||void 0===t?void 0:t.currentUser)&&$.query({query:r,variables:a,data:t}),(null===t||void 0===t?void 0:t.currentDirect)&&$.query({query:r,variables:a,data:t})}})}));case 2:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),k=new f.a((function(n,e){return n.setContext((function(n){var e=n.headers;return{headers:Object(r.a)({},e,{authorization:g.a.get("accessToken")})}})),e(n)})),I=Object(l.a)((function(n){var e=n.graphQLErrors,t=n.networkError,r=n.operation,a=n.forward;e&&e.map(function(){var n=Object(u.a)(c.a.mark((function n(e){var t,u,o;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=e.message,u=e.path,"UNAUTHENTICATED"===(o=e.extensions).code&&O(r,a),"INTERNAL_SERVER_ERROR"===o.code&&g.a.remove(),console.log("[GraphQL ERROR]:\n          CODE: ".concat(o.code,",\n          Message: ").concat(t,",\n          Path: ").concat(u,"\n      "));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),t&&console.log("[Network error]: ".concat(t))})),j=k.concat(f.a.from([I,b])),y=Object(f.d)((function(n){var e=n.query,t=Object(m.l)(e);return"OperationDefinition"===t.kind&&"subscription"===t.operation}),p,j),$=new o.a({link:y,cache:new d.a})},81:function(n,e,t){"use strict";t.d(e,"a",(function(){return s})),t.d(e,"b",(function(){return f}));var r=t(1),a=t.n(r),c=t(150),u=t(152),o=t(148),i=Object(o.a)((function(n){return{DirectFallback:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},Loader:{height:"100vh",width:"100vw",display:"flex",alignItems:"center",justifyContent:"center"}}})),s=function(){var n=i();return a.a.createElement("div",{className:n.DirectFallback},a.a.createElement(c.a,{variant:"body2"},"No messages here yet..."))},f=function(){var n=i();return a.a.createElement("div",{className:n.Loader},a.a.createElement(u.a,{size:120,thickness:2,color:"secondary"}))}},97:function(n,e,t){n.exports=t(133)}},[[97,2,3]]]);
//# sourceMappingURL=main.3d286cde.chunk.js.map