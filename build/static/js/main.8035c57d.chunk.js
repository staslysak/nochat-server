(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[1],{134:function(n,e,t){"use strict";t.r(e);var r=t(0),a=t.n(r),c=t(43),u=t(13),o=t(40),i=t(155),s=t(157),f=t(75),d=t(93),l=t(156),m=t(56),g=t(57),h=t(65),b=t(17),v=t(88),p=window.matchMedia("(prefers-color-scheme: dark)").matches,O=Object(d.a)({palette:{type:p?"dark":"light",primary:m.a,secondary:g.a},props:{sidebar:280,sidebarMin:150,classes:{ellipsis:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}}},lighten:h.lighten,darken:h.darken}),I=Object(b.b)({plugins:[Object(v.a)()].concat(Object(f.a)(Object(l.a)().plugins))}),j=t(38),k=t(29),y=t(71),$=t(27),T=t(72),E=t(154),w=t(25),S=t(82),x=function(n){var e=n.component,t=Object(y.a)(n,["component"]);return a.a.createElement($.b,Object.assign({},t,{render:function(n){return Object(w.e)()?a.a.createElement(e,n):a.a.createElement($.a,{to:"/login"})}}))},M=[{path:"/me",exact:!1,component:Object(r.lazy)((function(){return Promise.all([t.e(0),t.e(4),t.e(7)]).then(t.bind(null,226))}))}],F=[{path:"/(login|registration)",exact:!0,component:Object(r.lazy)((function(){return Promise.all([t.e(0),t.e(5),t.e(8)]).then(t.bind(null,222))}))},{path:"/verify",exact:!0,component:Object(r.lazy)((function(){return t.e(6).then(t.bind(null,225))}))}],N=function(){var n=Object(k.f)((function(n){return n.authorized}));return a.a.createElement(r.Suspense,{fallback:a.a.createElement(S.b,null)},a.a.createElement(E.a,null),a.a.createElement(T.a,null,a.a.createElement($.d,null,M.map((function(n){return a.a.createElement(x,Object.assign({key:n.path},n))})),F.map((function(n){return a.a.createElement($.b,Object.assign({key:n.path},n))})),a.a.createElement($.b,{path:"*",render:function(){return a.a.createElement($.a,{to:n?"/me":"/login"})}}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));Object(c.render)(a.a.createElement(u.a,{client:o.a},a.a.createElement(i.a,{theme:O},a.a.createElement(s.b,{jss:I},a.a.createElement(j.a,{store:k.d},a.a.createElement(N,null))))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(n){n.unregister()})).catch((function(n){console.error(n.message)}))},25:function(n,e,t){"use strict";t.d(e,"a",(function(){return u})),t.d(e,"e",(function(){return o})),t.d(e,"f",(function(){return i})),t.d(e,"b",(function(){return d})),t.d(e,"d",(function(){return l})),t.d(e,"h",(function(){return m})),t.d(e,"i",(function(){return g})),t.d(e,"c",(function(){return v})),t.d(e,"g",(function(){return p}));var r=t(62),a=t.n(r),c=t(40),u={get:function(n){return n?localStorage.getItem(n):{accessToken:localStorage.getItem("accessToken"),refreshToken:localStorage.getItem("refreshToken")}},set:function(n){localStorage.setItem("accessToken",n.accessToken),localStorage.setItem("refreshToken",n.refreshToken)},remove:function(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}},o=function(){var n=u.get(),e=n.accessToken,t=n.refreshToken;if(!e||!t)return!1;try{a()(e);var r=a()(t).exp;if(Date.now()/1e3>r)return!1}catch(c){return!1}return!0},i=function(n){u.remove(),c.b.subscriptionClient.close(),c.a.resetStore(),n&&n.push("/login")},s=t(63),f=t.n(s),d=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"days";return f()().diff(+n,e)},l=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"HH:mm";if(n)return f()(+n).format(e)},m=function(n){switch(d(+n)){case 0:return"Today";case 1:return"Yesterday";default:return l(n,"MMMM D")}},g=function(n){var e={};return n.length&&n.forEach((function(n,t){var r=n.createdAt,a=d(r,"days");void 0===e[a]&&(e[a]=t)})),e},h=(t(20),t(55)),b=t.n(h),v=function(n){console.log(n)},p=function(n){return b.a.parse(n.search,{arrayFormat:"comma",skipNull:!0,parseNumbers:!0})}},29:function(n,e,t){"use strict";t.d(e,"b",(function(){return o})),t.d(e,"a",(function(){return i})),t.d(e,"c",(function(){return s})),t.d(e,"d",(function(){return f}));var r=t(20),a=t(51),c=t(38);t.d(e,"f",(function(){return c.c})),t.d(e,"e",(function(){return c.b}));var u={authorized:localStorage.getItem("accessToken")&&localStorage.getItem("refreshToken"),user:{},typingUsers:{},menuIsOpen:!1},o=function(n){return{type:"SET_USER",payload:n}},i=function(n){return{type:"SET_TYPING",payload:n}},s=function(){return{type:"TOGGLE_MENU"}},f=Object(a.b)((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,e=arguments.length>1?arguments[1]:void 0,t=e.type,a=e.payload;switch(t){case"SET_USER":return Object(r.a)({},n,{authorized:!0,user:a});case"SET_TYPING":return Object(r.a)({},n,{typingUsers:Object(r.a)({},n.typingUsers,{},a)});case"TOGGLE_MENU":return Object(r.a)({},n,{menuIsOpen:!n.menuIsOpen});default:return n}}),u)},40:function(n,e,t){"use strict";t.d(e,"b",(function(){return O})),t.d(e,"a",(function(){return $}));var r=t(20),a=t(30),c=t.n(a),u=t(45),o=t(28),i=t(95),s=t(86),f=t(14),d=t(94),l=t(87),m=t(3),g=t(25),h=t(69),b=t(29),v=function(){var n=Object(u.a)(c.a.mark((function n(){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,$.query({query:h.h,fetchPolicy:"no-cache",variables:{refreshToken:g.a.get("refreshToken")}}).then((function(n){var e=n.data;return g.a.set(e.tokens),e.tokens}));case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),p=new i.a({uri:"".concat("http://localhost:8081","/graphql")}),O=new s.a({uri:"".concat("ws://localhost:8081","/graphql"),options:{reconnect:!!g.a.get("refreshToken"),connectionCallback:function(){console.log("CONNECTION_TOKEN",g.a.get("accessToken"))},connectionParams:function(){return{authorization:g.a.get("accessToken")}}}}),I=function(){var n=Object(u.a)(c.a.mark((function n(e,t){return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,v().then((function(n){var a=n.accessToken;console.log("ACCESS_TOKEN",a),e.setContext((function(n){var e=n.headers,t=void 0===e?{}:e;return{headers:Object(r.a)({},t,{authorization:a})}})),O.subscriptionClient.tryReconnect(),t(e).subscribe({next:function(n){var t=n.data;"self"===e.operationName?$.query(Object(r.a)({},e,{data:t})).then((function(n){var e=n.data;b.d.dispatch(Object(b.b)(e.self))})):$.query(Object(r.a)({},e,{data:t}))}})}));case 2:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),j=new f.a((function(n,e){return n.setContext((function(n){var e=n.headers;return{headers:Object(r.a)({},e,{authorization:g.a.get("accessToken")})}})),e(n)})),k=Object(l.a)((function(n){var e=n.graphQLErrors,t=n.networkError,r=n.operation,a=n.forward;e&&e.map(function(){var n=Object(u.a)(c.a.mark((function n(e){var t,u,o;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=e.message,u=e.path,"UNAUTHENTICATED"===(o=e.extensions).code&&I(r,a),"INTERNAL_SERVER_ERROR"===o.code&&g.a.remove(),console.log("[GraphQL ERROR]:\n          CODE: ".concat(o.code,",\n          Message: ").concat(t,",\n          Path: ").concat(u));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),t&&console.log("[Network error]: ".concat(t))})),y=new d.a,$=new o.a({cache:y,link:Object(f.d)((function(n){var e=n.query,t=Object(m.l)(e);return"OperationDefinition"===t.kind&&"subscription"===t.operation}),O,j.concat(f.a.from([k,p])))})},69:function(n,e,t){"use strict";t.d(e,"u",(function(){return q})),t.d(e,"r",(function(){return P})),t.d(e,"x",(function(){return _})),t.d(e,"s",(function(){return L})),t.d(e,"h",(function(){return G})),t.d(e,"j",(function(){return H})),t.d(e,"m",(function(){return J})),t.d(e,"c",(function(){return K})),t.d(e,"o",(function(){return Q})),t.d(e,"p",(function(){return W})),t.d(e,"b",(function(){return X})),t.d(e,"a",(function(){return Z})),t.d(e,"k",(function(){return en})),t.d(e,"n",(function(){return rn})),t.d(e,"t",(function(){return cn})),t.d(e,"v",(function(){return on})),t.d(e,"d",(function(){return sn})),t.d(e,"q",(function(){return fn})),t.d(e,"e",(function(){return dn})),t.d(e,"f",(function(){return ln})),t.d(e,"w",(function(){return gn})),t.d(e,"l",(function(){return bn})),t.d(e,"g",(function(){return vn})),t.d(e,"i",(function(){return pn}));var r,a=t(9),c=t(10),u=t.n(c),o=(t(0),t(11),t(7));function i(){var n=Object(a.a)(["\n    subscription typingUser($chatId: Int!) {\n  typingUser(chatId: $chatId)\n}\n    "]);return i=function(){return n},n}function s(){var n=Object(a.a)(["\n    subscription onlineUser {\n  onlineUser {\n    id\n    online\n    lastSeen\n  }\n}\n    "]);return s=function(){return n},n}function f(){var n=Object(a.a)(["\n    query currentUser {\n  self {\n    ...userFragment\n  }\n}\n    ",""]);return f=function(){return n},n}function d(){var n=Object(a.a)(["\n    query users($username: String) {\n  users(username: $username) {\n    ...userFragment\n  }\n}\n    ",""]);return d=function(){return n},n}function l(){var n=Object(a.a)(["\n    subscription messageDeleted($chatIds: [Int]) {\n  messageDeleted(chatIds: $chatIds) {\n    ids\n    chat {\n      id\n      lastMessage {\n        ...messageFragment\n      }\n      user {\n        ...userFragment\n      }\n      unread\n    }\n  }\n}\n    ","\n",""]);return l=function(){return n},n}function m(){var n=Object(a.a)(["\n    subscription messageCreated($chatIds: [Int]) {\n  messageCreated(chatIds: $chatIds) {\n    ...messageFragment\n  }\n}\n    ",""]);return m=function(){return n},n}function g(){var n=Object(a.a)(["\n    query getMessages($chatId: Int!, $offset: Int) {\n  messages(chatId: $chatId, offset: $offset) {\n    ...messageFragment\n  }\n}\n    ",""]);return g=function(){return n},n}function h(){var n=Object(a.a)(["\n    mutation typeMessage($chatId: Int!, $username: String) {\n  typeMessage(chatId: $chatId, username: $username)\n}\n    "]);return h=function(){return n},n}function b(){var n=Object(a.a)(["\n    mutation readMessage($id: Int!) {\n  readMessage(id: $id)\n}\n    "]);return b=function(){return n},n}function v(){var n=Object(a.a)(["\n    mutation deleteMessage($id: Int!) {\n  deleteMessage(id: $id)\n}\n    "]);return v=function(){return n},n}function p(){var n=Object(a.a)(["\n    mutation createMessage($chatId: Int, $text: String!) {\n  createMessage(chatId: $chatId, text: $text)\n}\n    "]);return p=function(){return n},n}function O(){var n=Object(a.a)(["\n    subscription directCreated {\n  direct: directCreated {\n    id\n    user {\n      ...userFragment\n    }\n    lastMessage {\n      ...messageFragment\n    }\n    unread\n  }\n}\n    ","\n",""]);return O=function(){return n},n}function I(){var n=Object(a.a)(["\n    subscription directDeleted {\n  direct: directDeleted {\n    id\n  }\n}\n    "]);return I=function(){return n},n}function j(){var n=Object(a.a)(["\n    query getCurrentDirect($userId: Int!) {\n  direct: direct(userId: $userId) {\n    id\n    lastMessage {\n      ...messageFragment\n    }\n    unread\n  }\n  recipient: user(id: $userId) {\n    ...userFragment\n  }\n}\n    ","\n",""]);return j=function(){return n},n}function k(){var n=Object(a.a)(["\n    query direct($id: Int!) {\n  direct(id: $id) {\n    id\n    user {\n      ...userFragment\n    }\n    lastMessage {\n      ...messageFragment\n    }\n    unread\n  }\n}\n    ","\n",""]);return k=function(){return n},n}function y(){var n=Object(a.a)(["\n    query directs {\n  directs {\n    id\n    user {\n      ...userFragment\n    }\n    lastMessage {\n      ...messageFragment\n    }\n    unread\n  }\n}\n    ","\n",""]);return y=function(){return n},n}function $(){var n=Object(a.a)(["\n    mutation deleteDirect($id: Int!) {\n  deleteDirect(id: $id)\n}\n    "]);return $=function(){return n},n}function T(){var n=Object(a.a)(["\n    mutation createDirect($userId: Int!, $text: String) {\n  createDirect(userId: $userId, text: $text) {\n    id\n    user {\n      ...userFragment\n    }\n    lastMessage {\n      ...messageFragment\n    }\n    unread\n  }\n}\n    ","\n",""]);return T=function(){return n},n}function E(){var n=Object(a.a)(["\n    query refreshTokens($refreshToken: String!) {\n  tokens: refreshTokens(refreshToken: $refreshToken) {\n    accessToken\n    refreshToken\n  }\n}\n    "]);return E=function(){return n},n}function w(){var n=Object(a.a)(["\n    mutation logout {\n  logout\n}\n    "]);return w=function(){return n},n}function S(){var n=Object(a.a)(["\n    mutation verifyUser($secret: String!) {\n  tokens: verifyUser(secret: $secret) {\n    accessToken\n    refreshToken\n  }\n}\n    "]);return S=function(){return n},n}function x(){var n=Object(a.a)(["\n    mutation login($username: String!, $password: String!) {\n  login(username: $username, password: $password) {\n    accessToken\n    refreshToken\n  }\n}\n    "]);return x=function(){return n},n}function M(){var n=Object(a.a)(["\n    mutation register($username: String!, $email: String!, $password: String!) {\n  register(username: $username, email: $email, password: $password)\n}\n    "]);return M=function(){return n},n}function F(){var n=Object(a.a)(["\n    fragment userFragment on User {\n  id\n  email\n  avatar\n  online\n  username\n  lastSeen\n  createdAt\n}\n    "]);return F=function(){return n},n}function N(){var n=Object(a.a)(["\n    fragment messageFragment on Message {\n  id\n  text\n  userId\n  chatId\n  unread\n  createdAt\n}\n    "]);return N=function(){return n},n}!function(n){n.Public="PUBLIC",n.Private="PRIVATE"}(r||(r={}));var C=u()(N()),U=u()(F()),D=u()(M());function q(n){return o.b(D,n)}var R=u()(x());function P(n){return o.b(R,n)}var z=u()(S());function _(n){return o.b(z,n)}var A=u()(w());function L(n){return o.b(A,n)}var G=u()(E());var B=u()(T(),U,C);function H(n){return o.b(B,n)}var Y=u()($());function J(n){return o.b(Y,n)}var K=u()(y(),U,C);function Q(n){return o.c(K,n)}u()(k(),U,C);var V=u()(j(),C,U);function W(n){return o.c(V,n)}var X=u()(I());var Z=u()(O(),U,C);var nn=u()(p());function en(n){return o.b(nn,n)}var tn=u()(v());function rn(n){return o.b(tn,n)}var an=u()(b());function cn(n){return o.b(an,n)}var un=u()(h());function on(n){return o.b(un,n)}var sn=u()(g(),C);function fn(n){return o.c(sn,n)}var dn=u()(m(),C);var ln=u()(l(),C,U);var mn=u()(d(),U);function gn(n){return o.a(mn,n)}var hn=u()(f(),U);function bn(n){return o.c(hn,n)}var vn=u()(s());var pn=u()(i())},82:function(n,e,t){"use strict";t.d(e,"a",(function(){return s})),t.d(e,"b",(function(){return f}));var r=t(0),a=t.n(r),c=t(151),u=t(153),o=t(149),i=Object(o.a)((function(n){return{DirectFallback:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},Loader:{height:"100vh",width:"100vw",display:"flex",alignItems:"center",justifyContent:"center"}}})),s=function(){var n=i();return a.a.createElement("div",{className:n.DirectFallback},a.a.createElement(c.a,{variant:"body2"},"No messages here yet..."))},f=function(){var n=i();return a.a.createElement("div",{className:n.Loader},a.a.createElement(u.a,{size:120,thickness:2,color:"secondary"}))}},98:function(n,e,t){n.exports=t(134)}},[[98,2,3]]]);