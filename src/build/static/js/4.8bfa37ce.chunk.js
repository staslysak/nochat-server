(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[4],{127:function(e,t,a){"use strict";a.r(t);var n=a(78);a.d(t,"default",(function(){return n.a}))},220:function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},223:function(e,t,a){"use strict";var n=a(220);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),c=(0,n(a(224)).default)(r.default.createElement("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"}),"Send");t.default=c},224:function(e,t,a){"use strict";var n=a(220);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var a=c.default.memo(c.default.forwardRef((function(t,a){return c.default.createElement(i.default,(0,r.default)({ref:a},t),e)})));0;return a.muiName=i.default.muiName,a};var r=n(a(225)),c=n(a(0)),i=n(a(127))},225:function(e,t){function a(){return e.exports=a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},a.apply(this,arguments)}e.exports=a},237:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(40),i=a(29),s=a.n(i),o=a(50),u=a(106),d=a(15),l=a(16),f=a(52),p=a(213),b=a(54),g=a(167),h=a(204),m=a(109),v=a(57),y=a(196),x=Object(y.a)((function(e){return{ChatWindow:{position:"relative",height:"100%",maxHeight:"calc(100% - 65px)",display:"flex",flexDirection:"column"},ChatWindow_input_wrapper:{alignSelf:"flex-end",display:"flex",alignItems:"center",width:"100%",borderTop:"1px solid ".concat(e.palette.divider),"& .MuiInputBase-root":{fontSize:e.typography.body2.fontSize}},ChatWindow_input:{minHeight:64,padding:"".concat(e.spacing(1),"px ").concat(e.spacing(1.5),"px ").concat(e.spacing(.5),"px ").concat(e.spacing(2),"px"),"& .MuiInputBase-inputMultiline":{"&::-webkit-scrollbar":{display:"none"}}},ChatWindow_empty:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},ChatWindow_content:{display:"flex",flexDirection:"column",height:"100%",overflow:"auto",background:"transparent",padding:e.spacing(2),"&::-webkit-scrollbar":{width:5,background:"transparent","&-thumb":{background:"dark"===e.palette.type?e.lighten(e.palette.background.default,.235):e.darken(e.palette.background.default,.057),borderRadius:3*e.shape.borderRadius,display:"none"}},"&:hover::-webkit-scrollbar-thumb":{display:"block"}}}})),w=function(e){var t=x(),a=r.a.createRef(),n=r.a.useCallback((function(){a.current&&(a.current.scrollTop=a.current.scrollHeight)}),[e.children]);return r.a.useEffect((function(){n()}),[a,n]),r.a.createElement("div",{className:t.ChatWindow},r.a.createElement("div",{className:t.ChatWindow_content,ref:a},e.children))},O=a(215),D=a(208),j=a(223),M=a.n(j),E=a(48),k=Object(E.g)((function(e){var t=x(),a=r.a.createRef();r.a.useEffect((function(){a.current&&a.current.focus()}),[e.location]);return r.a.createElement("div",{className:t.ChatWindow_input_wrapper},r.a.createElement(O.a,{fullWidth:!0,multiline:!0,rowsMax:5,inputRef:a,value:e.value,onChange:e.onChange,onKeyPress:e.onKeyPress,placeholder:"Write a message...",className:t.ChatWindow_input}),r.a.createElement(D.a,{onClick:function(t){return Object(o.a)(s.a.mark((function a(){return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:t.current&&t.current.focus(),e.onClick();case 2:case"end":return a.stop()}}),a)})))}(a),disabled:!e.value.trim().length},r.a.createElement(M.a,null)))})),C=a(83),I=a(95),_=a.n(I),T=a(176),N=a(206),W=function(e){var t=e.anchorEl,a=e.onClose,n=e.onDelete,c=e.onCopy,i=function(e){return function(){e(),a()}};return r.a.createElement(T.a,{anchorEl:t,open:Boolean(t),onClose:a},r.a.createElement(N.a,{dense:!0,onClick:i(n)},"Delete Message"),r.a.createElement(N.a,{dense:!0,onClick:i(c)},"Copy Text"))},R=Object(y.a)((function(e){return{Message:{display:"flex",position:"relative",maxWidth:"70%",padding:"".concat(e.spacing(1),"px ").concat(e.spacing(1.5),"px ").concat(e.spacing(.5),"px"),borderRadius:3*e.shape.borderRadius,"&:before":{position:"absolute",bottom:-1,width:15,height:20,content:"''"},"& p":{alignSelf:"flex-end",wordWrap:"break-word",overflowWrap:"break-word",paddingBottom:e.spacing(2),minWidth:20},"& span":{alignSelf:"flex-end",opacity:.54}},Message_content:{display:"flex",margin:"".concat(e.spacing(1),"px 0")},Message_content_receiver:{justifyContent:"flex-start"},Message_content_sender:{justifyContent:"flex-end"},Message_receiver:{background:"dark"===e.palette.type?e.lighten(e.palette.background.default,.235):e.darken(e.palette.background.default,.057),"&:before":{left:-10,transform:"rotate(-15deg)",borderBottom:"15px solid ".concat("dark"===e.palette.type?e.lighten(e.palette.background.default,.235):e.darken(e.palette.background.default,.057)),borderLeft:"15px solid transparent"}},Message_sender:{background:e.palette.secondary.main,color:e.palette.getContrastText(e.palette.secondary.main),"&:before":{right:-10,transform:"rotate(15deg)",borderBottom:"15px solid ".concat(e.palette.secondary.main),borderRight:"15px solid transparent"}}}})),P=function(e){var t,a,n=R(),i=r.a.useState(null),s=Object(l.a)(i,2),o=s[0],u=s[1];return r.a.createElement("div",{className:_()(n.Message_content,(t={},Object(b.a)(t,n.Message_content_sender,e.isOwner),Object(b.a)(t,n.Message_content_receiver,!e.isOwner),t))},r.a.createElement("div",{onContextMenu:function(e){e.preventDefault(),u(e.currentTarget)},className:_()(n.Message,(a={},Object(b.a)(a,n.Message_sender,e.isOwner),Object(b.a)(a,n.Message_receiver,!e.isOwner),a))},r.a.createElement(C.a,{variant:"body2"},e.text),r.a.createElement(C.a,{variant:"caption"},Object(c.a)(e.date))),r.a.createElement(W,Object.assign({anchorEl:o,onClose:function(){return u(null)}},e.menuProps,{onCopy:function(){navigator.clipboard.writeText(e.text)}})))},S=Object(y.a)((function(e){return{DirectFallback:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}}})),U=function(){var e=S();return r.a.createElement("div",{className:e.DirectFallback},r.a.createElement(C.a,{variant:"body2"},"No messages here yet..."))},B=a(108),Q=Object(y.a)((function(e){return{DirectChat_header:{width:"100%",paddingLeft:0,paddingRight:0},DirectChat_header_status:{color:e.palette.secondary[200]}}})),K=function(e){var t=Q(),a=r.a.useState(""),n=Object(l.a)(a,2),i=n[0],s=n[1];r.a.useEffect((function(){var t=function(){};return e.chatId&&(t=e.subscribeToUserTyping(e.chatId)),function(){return t(e.chatId)}}),[e.chatId]),r.a.useEffect((function(){var t=function(){};return e.chatId&&(t=e.subscribeToNewMessage(e.chatId)),function(){return t(e.chatId)}}),[e.chatId]),r.a.useEffect((function(){var t=function(){};return e.chatId&&(t=e.subscribeToDeleteMessage(e.chatId)),function(){return t(e.chatId)}}),[e.chatId]),r.a.useEffect((function(){var t=function(){};return e.chatId&&(t=e.subscribeToDeleteDirect(e.chatId)),function(){return t(e.chatId)}}),[e.chatId]),r.a.useEffect((function(){var t=e.subscribeToNewDirect();return function(){return t()}}),[]);var o=function(){i.trim().length&&e.onCreateMessage(i),s("")},u=r.a.useMemo((function(){return e.messages&&e.messages.map((function(t){return r.a.createElement(P,{key:t.id,text:t.text,date:t.createdAt,isOwner:t.userId===e.user.id,menuProps:{onDelete:e.onDeleteMessage(t.id)}})}))}),[e.messages]);return r.a.createElement(m.a,{show:e.show,header:e.recipient.username&&r.a.createElement(g.a,{dense:!0,className:t.DirectChat_header},r.a.createElement(h.a,{primary:e.recipient.username,primaryTypographyProps:{component:"div"},secondary:e.typingUser?r.a.createElement(B.a,{variant:"secondary"}):e.recipient.online?"online":Object(c.a)(e.recipient.lastSeen,"last seen "),secondaryTypographyProps:{variant:"caption",className:_()(Object(b.a)({},t.DirectChat_header_status,e.recipient.online))}}),r.a.createElement(v.a,{src:e.recipient.avatar,alt:e.recipient.username,online:e.recipient.online}))},r.a.createElement(w,null,e.messages?u:r.a.createElement(U,null)),r.a.createElement(k,{value:i,onChange:function(t){e.chatId&&e.onTyping(),s(t.target.value)},onKeyPress:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),o())},onClick:o}))},z=a(105),H=function(e){var t=e.userId,a=Object(z.a)({userId:t}),n=a.queries,c=n.currentUser,i=n.currentDirect,b=a.mutations,g=b.createDirect,h=b.createMessage,m=b.deleteMessage,v=b.readMessage,y=b.userTyping,x=Object(p.a)(i,"data.currentDirect.direct",{}),w=Object(p.a)(i,"data.currentDirect.recipient",{}),O=Object(z.c)({chatId:Object(p.a)(x,"id"),username:Object(p.a)(c,"data.currentUser",{}).username},(function(e){return y({variables:e})})),D=Object(l.a)(O,2),j=D[0],M=D[1],E=function(){var e=Object(o.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x){e.next=5;break}return e.next=3,g({variables:{text:t,userId:w.id}});case 3:e.next=9;break;case 5:return e.next=7,h({variables:{text:t,chatId:x.id}});case 7:return e.next=9,y({variables:{chatId:Object(p.a)(x,"id"),username:""}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(K,{user:Object(p.a)(c,"data.currentUser",{}),show:!!t,chatId:Object(p.a)(x,"id"),recipient:w,messages:Object(p.a)(x,"messages"),typingUser:j.user===Object(p.a)(c,"data.currentUser",{}).username?"":j.user,onTyping:M,onCreateMessage:E,onDeleteMessage:function(e){return function(){m({variables:{id:e}})}},onReadMessage:function(e){return v({variables:{id:e}})},subscribeToNewDirect:function(){return i.subscribeToMore({document:f.c,updateQuery:function(e,t){var a=t.subscriptionData;if(!a.data)return e;var n=a.data.newDirect;return{currentDirect:Object(d.a)({},e.currentDirect,{direct:n})}}})},subscribeToNewMessage:function(e){return i.subscribeToMore({document:f.d,variables:{chatId:e},updateQuery:function(e,t){var a=t.subscriptionData;if(!a.data)return e;var n=a.data.newMessage;return console.log(n),{currentDirect:Object(d.a)({},e.currentDirect,{direct:Object(d.a)({},e.currentDirect.direct,{messages:[].concat(Object(u.a)(e.currentDirect.direct.messages),[n])})})}}})},subscribeToDeleteMessage:function(e){return i.subscribeToMore({document:f.b,variables:{chatId:e},updateQuery:function(e,t){var a=t.subscriptionData;if(!a.data)return e;var n=a.data.deleteMessage,r=e.currentDirect.direct.messages.filter((function(e){return e.id!==n.id}));return{currentDirect:Object(d.a)({},e.currentDirect,{direct:Object(d.a)({},e.currentDirect.direct,{messages:r})})}}})},subscribeToDeleteDirect:function(e){return i.subscribeToMore({document:f.a,variables:{chatId:e},updateQuery:function(t,a){var n=a.subscriptionData;return n.data&&n.data.deleteDirect.id===e?{currentDirect:Object(d.a)({},t.currentDirect,{direct:null})}:t}})},subscribeToUserTyping:function(e){return i.subscribeToMore({document:f.f,variables:{chatId:e},updateQuery:function(e,t){var a=t.subscriptionData;if(!a.data)return e;var n=a.data.userTyping;return j.setUser(n),e}})}})};t.default=function(e){var t=Object(c.b)(e.location).p;return r.a.createElement(H,{userId:t})}}}]);
//# sourceMappingURL=4.8bfa37ce.chunk.js.map